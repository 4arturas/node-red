[
    {
        "id": "a48639831b79bc53",
        "type": "tab",
        "label": "Langchain email workflow",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "5f6eebf04085ab9f",
        "type": "tab",
        "label": "Langchain research-agent",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0885b58486b6cfde",
        "type": "tab",
        "label": "Langchain shallow agent",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "a18fd0a91e07848d",
        "type": "tab",
        "label": "Langchain Tools",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "d9c88a0a246ec309",
        "type": "tab",
        "label": "JTBD",
        "disabled": true,
        "info": "Jobs To Be Done",
        "env": []
    },
    {
        "id": "b70b82bf8d00eb8a",
        "type": "tab",
        "label": "While Ex.",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "f03d232b4fcc4b3e",
        "type": "tab",
        "label": "HttpServer React",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "7184d5a8972f1fe0",
        "type": "tab",
        "label": "websocket",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "a6828adb58c9e145",
        "type": "tab",
        "label": "Function from file example",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "35a4f5ffd108afaa",
        "type": "tab",
        "label": "Herro",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "1d45200c9172f37f",
        "type": "tab",
        "label": "Story Building System",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "5451c5648a7ae7eb",
        "type": "tab",
        "label": "Sycn-Async",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "050b98cdec0fb136",
        "type": "tab",
        "label": "Wait for all Threads",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c080735c3b2e661f",
        "type": "group",
        "z": "35a4f5ffd108afaa",
        "name": "HERO'S STEPS CARDS",
        "style": {
            "label": true
        },
        "nodes": [
            "6232921449696c56",
            "1f343e6bb8519a2a",
            "9e75bf06577706e9",
            "b2ca9f43bddaa235",
            "31062ff062e78a4c",
            "956c40cef8e47e16",
            "9c2190e83394516c",
            "b039c4e842373e09",
            "4ec78c120bf42a3a",
            "7ec885efd16abb92",
            "1617e8e2bb86329c",
            "08ef5b1f843038b6",
            "32b82980b91dd3de",
            "2e2873a7e8944fdb",
            "bb01eee731d3a898"
        ],
        "x": 34,
        "y": 439,
        "w": 1412,
        "h": 562
    },
    {
        "id": "00862118b435a1a7",
        "type": "group",
        "z": "35a4f5ffd108afaa",
        "name": "10 READERS'S STEPS CARDS",
        "style": {
            "label": true
        },
        "nodes": [
            "4e4ab2c54b9fa073",
            "347d2ac42e821b50",
            "eb5b0fd191b9821a",
            "f529fc5432ae8155",
            "ab29fb87ea4c06f9",
            "7ad1a0c99ee13c67",
            "2661ded7866de731",
            "7824525e71dd688d",
            "f3182786fe1f2a17",
            "bc861751a1b19d27"
        ],
        "x": 34,
        "y": 1259,
        "w": 1262,
        "h": 402
    },
    {
        "id": "87285eca5226e916",
        "type": "group",
        "z": "35a4f5ffd108afaa",
        "name": "2 LEVEL CARDS",
        "style": {
            "label": true
        },
        "nodes": [
            "4d3e0d5042a1385f",
            "624534cad709b4a2"
        ],
        "x": 454,
        "y": 1519,
        "w": 522,
        "h": 82
    },
    {
        "id": "9b29753bae23ff6b",
        "type": "group",
        "z": "35a4f5ffd108afaa",
        "name": "3 CHARACTER CARDS",
        "style": {
            "label": true
        },
        "nodes": [
            "32173120e2685e90",
            "9e45477dfac653d7",
            "1e0a9ff4a3ef4b56",
            "3381474b63847bed"
        ],
        "x": 14,
        "y": 1039,
        "w": 592,
        "h": 142
    },
    {
        "id": "33fb1e68903c32d8",
        "type": "group",
        "z": "35a4f5ffd108afaa",
        "name": "ASSETS",
        "style": {
            "label": true
        },
        "nodes": [
            "25741aebae9499a1",
            "68531779796741a5",
            "3edc5a908bee516c",
            "e106990e59bdd880",
            "b4cdc2c98b547f95",
            "64bace815e13bcac",
            "958fa39261f90af4",
            "6cf696a89b208cd9",
            "f3010bb0dc0867cf",
            "3e46630bcdad778f",
            "54e631b8713f7276",
            "7c4e3bdfb934f2b1"
        ],
        "x": 24,
        "y": 99,
        "w": 792,
        "h": 302
    },
    {
        "id": "d3bab26f8ac33880",
        "type": "junction",
        "z": "5451c5648a7ae7eb",
        "x": 440,
        "y": 320,
        "wires": [
            [
                "7a9dcc421561c59b",
                "9493456b59dc7fd4",
                "22e1177b811c8e84"
            ]
        ]
    },
    {
        "id": "4703b9b1133a8a85",
        "type": "junction",
        "z": "5451c5648a7ae7eb",
        "x": 680,
        "y": 320,
        "wires": [
            [
                "7879dc596cf24518"
            ]
        ]
    },
    {
        "id": "3bac0584b8df8ef3",
        "type": "junction",
        "z": "050b98cdec0fb136",
        "x": 680,
        "y": 500,
        "wires": [
            [
                "1d2c0e0ad8db2121",
                "4fea8efc486e60b5",
                "dbb12a0d022402c1"
            ]
        ]
    },
    {
        "id": "f0b48f4542db6b9b",
        "type": "junction",
        "z": "050b98cdec0fb136",
        "x": 920,
        "y": 500,
        "wires": [
            [
                "606e8561e6607d49"
            ]
        ]
    },
    {
        "id": "b79df368d7aaac79",
        "type": "websocket-listener",
        "path": "/ws/machine",
        "wholemsg": "false"
    },
    {
        "id": "33535f303afacccb",
        "type": "websocket-client",
        "path": "ws://127.0.0.1:1880/ws/machine",
        "tls": "",
        "wholemsg": "false",
        "hb": "0",
        "subprotocol": ""
    },
    {
        "id": "65fccb54d6cf3d7f",
        "type": "websocket-listener",
        "path": "/ws/react",
        "wholemsg": "false"
    },
    {
        "id": "cc2050a953749795",
        "type": "openaiApiKey",
        "name": ""
    },
    {
        "id": "8a9b6c5d4e3f2a10",
        "type": "websocket-listener",
        "path": "/ws/shallow-agent",
        "wholemsg": "false"
    },
    {
        "id": "054df86263375fbb",
        "type": "inject",
        "z": "a48639831b79bc53",
        "name": "Inject: Car Blown Up",
        "props": [
            {
                "p": "emailContent",
                "v": "My car has blown up!",
                "vt": "str"
            },
            {
                "p": "senderEmail",
                "v": "test@test.com",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "c507538da8d97a30"
            ]
        ]
    },
    {
        "id": "ca5545580823485f",
        "type": "inject",
        "z": "a48639831b79bc53",
        "name": "Inject: Hello",
        "props": [
            {
                "p": "emailContent",
                "v": "Hello! How are you?",
                "vt": "str"
            },
            {
                "p": "senderEmail",
                "v": "test1@test.com",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 240,
        "wires": [
            [
                "c507538da8d97a30"
            ]
        ]
    },
    {
        "id": "c507538da8d97a30",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "read_email",
        "func": "return msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 140,
        "wires": [
            [
                "8cf88a5015b19e40"
            ]
        ]
    },
    {
        "id": "8cf88a5015b19e40",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "classify_intent",
        "func": "const { ChatOllama } = global.get('lcOllama');\nconst { z } = global.get('zod');\nconst { Tavily } = global.get('lcTavily');\n\nconst EmailClassificationSchema = z.object({\n  intent: z.enum(['question', 'bug', 'billing', 'feature', 'complex']),\n  urgency: z.enum(['low', 'medium', 'high', 'critical']),\n  topic: z.string(),\n  summary: z.string(),\n});\n\nconst llm = new ChatOllama({ model: \"llama3.2:3b\", temperature: 0 });\nconst structuredLlm = llm.withStructuredOutput(EmailClassificationSchema);\n\n(async () => {\n    try {\n        const state = {\n            emailContent: msg.emailContent || \"\",\n            senderEmail: msg.senderEmail || \"unknown@test.com\"\n        };\n\n        const classificationPrompt = `\n        Analyze this customer email and classify it:\n        \n        Email: ${state.emailContent}\n        From: ${state.senderEmail}\n        Provide classification, including intent, urgency, topic, and summary.\n        `;\n\n        const classification = await structuredLlm.invoke(classificationPrompt);\n\n        msg.state = {\n            ...state,\n            classification\n        };\n        \n        node.send([msg, msg]);\n    } catch (e) {\n        node.error(e);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 220,
        "wires": [
            [
                "21398b7313621f89",
                "cfc24a0584b11bd2"
            ]
        ]
    },
    {
        "id": "21398b7313621f89",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "bug_tracking",
        "func": "msg.topic = \"ticket_state\";\nconst ticketId = `BUG_${Math.random().toString(36).substr(2, 9).toUpperCase()}`;\nmsg.payload = { ticketId: ticketId };\nreturn msg;",
        "outputs": 1,
        "x": 650,
        "y": 160,
        "wires": [
            [
                "d7c5f88515f704cb"
            ]
        ]
    },
    {
        "id": "cfc24a0584b11bd2",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "search_documentation",
        "func": "msg.topic = \"search_state\";\nconst classification = msg.state.classification;\n\nmsg.payload = {\n    searchResults: [\n      `Documentation on ${classification.topic}`,\n      `Standard procedure for ${classification.intent} requests`\n    ]\n};\nreturn msg;",
        "outputs": 1,
        "x": 680,
        "y": 280,
        "wires": [
            [
                "d7c5f88515f704cb"
            ]
        ]
    },
    {
        "id": "d7c5f88515f704cb",
        "type": "join",
        "z": "a48639831b79bc53",
        "name": "Join State",
        "mode": "manual",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "count": "2",
        "x": 900,
        "y": 220,
        "wires": [
            [
                "992806acddcfb95d"
            ]
        ]
    },
    {
        "id": "992806acddcfb95d",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "write_response",
        "func": "const { ChatOllama } = global.get('lcOllama');\nconst llm = new ChatOllama({ model: \"llama3.2:3b\", temperature: 0.7 });\n\n(async () => {\n    const state = msg.state;\n    const classification = state.classification;\n    const contextSections = msg.payload.search_state.searchResults;\n    const ticketInfo = msg.payload.ticket_state.ticketId;\n    \n    const draftPrompt = `\n    Draft a response to this customer email:\n    ${state.emailContent}\n    \n    Email intent: ${classification.intent}\n    Urgency level: ${classification.urgency}\n    \n    ${contextSections.join('\\n\\n')}\n    \n    Guidelines:\n    - Be professional and helpful\\\n    - Address their specific concern\n    - Use the provided documentation when relevant\n    - Be brief\n    `;\n\n    try {\n        const response = await llm.invoke(draftPrompt);\n        const needsReview = ['high', 'critical'].includes(classification.urgency) || classification.intent === 'complex';\n        \n        msg.payload = {\n            draftResponse: response.content,\n            target: needsReview ? \"human_review\" : \"send_reply\"\n        };\n        \n        node.send(msg);\n    } catch (e) {\n        node.error(e);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 300,
        "wires": [
            [
                "615f61abecd0d81d"
            ]
        ]
    },
    {
        "id": "615f61abecd0d81d",
        "type": "switch",
        "z": "a48639831b79bc53",
        "name": "Review Switch",
        "property": "payload.target",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "human_review",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "send_reply",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1060,
        "y": 380,
        "wires": [
            [
                "09449c27557bff4d"
            ],
            [
                "a08f172bf3358ffd"
            ]
        ]
    },
    {
        "id": "09449c27557bff4d",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "human_review",
        "func": "const approved = Math.random() > 0.2 ? \"approved\" : \"not_approved\";\nmsg.payload.humanDecision = approved;\n\nif (approved === \"approved\") {\n    node.status({fill:\"green\", shape:\"dot\", text:\"Mock: Approved\"});\n} else {\n    node.status({fill:\"red\", shape:\"ring\", text:\"Mock: Rejected\"});\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 400,
        "wires": [
            [
                "09162c4a84b4aacc"
            ]
        ]
    },
    {
        "id": "09162c4a84b4aacc",
        "type": "switch",
        "z": "a48639831b79bc53",
        "name": "Decision Switch",
        "property": "payload.humanDecision",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "not_approved",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "approved",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1500,
        "y": 460,
        "wires": [
            [
                "162c744e98edacd8"
            ],
            [
                "a08f172bf3358ffd"
            ]
        ]
    },
    {
        "id": "a08f172bf3358ffd",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "send_reply",
        "func": "const preview = (msg.payload.draftResponse || \"\").substring(0, 60) + \"...\";\nnode.warn(\"Sending Email Reply: \" + preview);\nreturn msg;",
        "outputs": 1,
        "x": 1730,
        "y": 660,
        "wires": [
            [
                "162c744e98edacd8"
            ]
        ]
    },
    {
        "id": "162c744e98edacd8",
        "type": "debug",
        "z": "a48639831b79bc53",
        "name": "Final Draft",
        "active": true,
        "complete": "payload",
        "x": 1910,
        "y": 440,
        "wires": []
    },
    {
        "id": "research-agent-trigger",
        "type": "inject",
        "z": "5f6eebf04085ab9f",
        "name": "Start Research",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "What is artificial intelligence?",
        "payloadType": "str",
        "x": 100,
        "y": 140,
        "wires": [
            [
                "initialize-state"
            ]
        ]
    },
    {
        "id": "initialize-state",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Initialize State",
        "func": "// Initialize the state similar to createInitialState() in JS\nmsg.state = {\n    messages: [{\n        type: \"human\",\n        content: msg.payload,\n        timestamp: new Date().toISOString()\n    }],\n    todos: [],\n    files: {},\n    searchHistory: [],\n    iteration: 0,\n    maxIterations: 10\n};\n\n// Add the original question to files\nmsg.state.files[\"question.txt\"] = {\n    content: msg.payload,\n    createdAt: new Date().toISOString(),\n    modifiedAt: new Date().toISOString()\n};\n\n// Prepare question.txt for file output\nmsg.payload = msg.payload;\n\n// Add initial todo for the main research task\nmsg.state.todos.push({\n    id: Date.now().toString(),\n    content: `Research the question: ${msg.payload}`,\n    status: \"in_progress\",\n    createdAt: new Date().toISOString()\n});\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 160,
        "y": 200,
        "wires": [
            [
                "question-file-out",
                "build-prompt-and-select-tool"
            ]
        ]
    },
    {
        "id": "question-file-out",
        "type": "file",
        "z": "5f6eebf04085ab9f",
        "name": "Save question.txt",
        "filename": "question.txt",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 370,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "build-prompt-and-select-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Build Prompt & Select Tool",
        "func": "// Build prompt similar to buildPrompt() in JS\nconst state = msg.state;\n\nconst messages = state.messages.map(m =>\n    `${m.type}: ${m.content}`\n).join(\"\\n\");\n\nconst todos = state.todos.map(t =>\n    `- ${t.content} (${t.status})`\n).join(\"\\n\");\n\nconst availableFiles = Object.keys(state.files).join(\", \");\n\nmsg.payload = `You are an expert researcher. Your job is to conduct thorough research, and then write a polished report.\n\nThe first thing you should do is to write the original user question to \\`question.txt\\` so you have a record of it.\n\nUse the research-agent to conduct deep research. It will respond to your questions/topics with a detailed answer.\n\nWhen you think you enough information to write a final report, write it to \\`final_report.md\\`\n\nYou can call the critique-agent to get a critique of the final report. After that (if needed) you can do more research and edit the \\`final_report.md\\`\nYou can do this however many times you want until are you satisfied with the result.\n\nOnly edit the file once at a time (if you call this tool in parallel, there may be conflicts).\n\nHere are instructions for writing the final report:\n\n<report_instructions>\n\nCRITICAL: Make sure the answer is written in the same language as the human messages! If you make a todo plan - you should note in the plan what language the report should be in so you dont forget!\nNote: the language the report should be in is the language the QUESTION is in, not the language/country that the question is ABOUT.\n\nPlease create a detailed answer to the overall research brief that:\n1. Is well-organized with proper headings (# for title, ## for sections, ### for subsections)\n2. Includes specific facts and insights from the research\n3. References relevant sources using [Title](URL) format\n4. Provides a balanced, thorough analysis. Be as comprehensive as possible, and include all information that is relevant to the overall research question. People are using you for deep research and will expect detailed answers.\n5. Includes a \"Sources\" section at the end with all referenced links\n\nYou can structure your report in a number of different ways. Here are some examples:\n\nTo answer a question that asks you to compare two things, you might structure your report like this:\n1/ intro\n2/ overview of topic A\n3/ overview of topic B\n4/ comparison between A and B\n5/ conclusion\n\nTo answer a question that asks you to return a list of things, you might only need a single section which is the entire list.\n1/ list of things or table of things\nOr, you could choose to make each item in the list a separate section in the report. When asked for lists, you don't need an introduction or conclusion.\n1/ item 1\n2/ item 2\n3/ item 3\n\nTo answer a question that asks you to summarize a topic, give a report, or give an overview, you might structure your report like this:\n1/ overview of topic\n2/ concept 1\n3/ concept 2\n4/ concept 3\n5/ conclusion\n\nIf you think you can answer the question with a single section, you can do that too!\n1/ answer\n\nREMEMBER: Section is a VERY fluid and loose concept. You can structure your report however you think is best, including in ways that are not listed above!\nMake sure that your sections are cohesive, and make sense for the reader.\n\nFor each section of the report, do the following:\n- Use simple, clear language\n- Use ## for section title (Markdown format) for each section of the report\n- Do NOT ever refer to yourself as the writer of the report. This should be a professional report without any self-referential language.\n- Do not say what you are doing in the report. Just write the report without any commentary from yourself.\n- Each section should be as long as necessary to deeply answer the question with the information you have gathered. It is expected that sections will be fairly long and verbose. You are writing a deep research report, and users will expect a thorough answer.\n- Use bullet points to list out information when appropriate, but by default, write in paragraph form.\n\nREMEMBER:\nThe brief and research may be in English, but you need to translate this information to the right language when writing the final answer.\nMake sure the final answer report is in the SAME language as the human messages in the message history.\n\nFormat the report in clear markdown with proper structure and include source references where appropriate.\n\n<Citation Rules>\n- Assign each unique URL a single citation number in your text\n- End with ### Sources that lists each source with corresponding numbers\n- IMPORTANT: Number sources sequentially without gaps (1,2,3,4...) in the final list regardless of which sources you choose\n- Each source should be a separate line item in a list, so that in markdown it is rendered as a list.\n- Example format:\n  [1] Source Title: URL\n  [2] Source Title: URL\n- Citations are extremely important. Make sure to include these, and pay a lot of attention to getting these right. Users will often use these citations to look into more information.\n</Citation Rules>\n\nYou have access to a few tools.\n\n## \\`internet_search\\`\n\nUse this to run an internet search for a given query. You can specify the number of results, the topic, and whether raw content should be included.\n\nCurrent conversation:\n${messages}\n\nCurrent todos:\n${todos || \"No todos yet\"}\n\nAvailable files: ${availableFiles || \"No files yet\"}\n\nBased on the user's research request, choose the most appropriate tool to advance the research.\nThe user wants to research: ${state.messages[0]?.content || 'unknown topic'}\n\nSelect a tool and provide the necessary parameters.`;\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 260,
        "wires": [
            [
                "llm-tool-selector"
            ]
        ]
    },
    {
        "id": "llm-tool-selector",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "LLM Tool Selector",
        "func": "// Simulate LLM tool selection with structured output\n// In a real implementation, this would use an LLM with structured output\n\n// For now, we'll simulate the tool selection based on the prompt\nconst prompt = msg.payload;\nconst state = msg.state;\n\n// Simple logic to determine which tool to use based on the prompt\nlet tool = \"search_web\"; // Default\nlet parameters = {};\nlet reasoning = \"Default tool selection\";\n\n// If we have enough search results and need to write a report\nif (state.searchHistory.length > 2 && state.todos.some(t => t.status === \"completed\")) {\n    tool = \"write_file\";\n    parameters = { filePath: \"final_report.md\", content: \"\" };\n    reasoning = \"Creating final report based on research\";\n} else if (prompt.toLowerCase().includes(\"search\") || prompt.toLowerCase().includes(\"research\")) {\n    // Extract query from prompt\n    const queryMatch = prompt.match(/research:\\s*(.+)/i);\n    const query = queryMatch ? queryMatch[1] : state.messages[0]?.content || \"general research\";\n    \n    tool = \"search_web\";\n    parameters = { query: query };\n    reasoning = \"Searching the web for research information\";\n} else if (prompt.toLowerCase().includes(\"todo\")) {\n    tool = \"create_todo\";\n    parameters = { content: \"Research task\" };\n    reasoning = \"Creating a research todo\";\n} else {\n    tool = \"search_web\";\n    parameters = { query: state.messages[0]?.content || \"general research\" };\n    reasoning = \"Default search for research information\";\n}\n\nmsg.toolAction = {\n    tool: tool,\n    reasoning: reasoning,\n    parameters: parameters\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 440,
        "wires": [
            [
                "tool-router"
            ]
        ]
    },
    {
        "id": "tool-router",
        "type": "switch",
        "z": "5f6eebf04085ab9f",
        "name": "Route to Tool",
        "property": "toolAction.tool",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "search_web",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "write_file",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "read_file",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "edit_file",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "create_todo",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "update_todo",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "research_topic",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 8,
        "x": 530,
        "y": 320,
        "wires": [
            [
                "search-web-tool"
            ],
            [
                "write-file-tool"
            ],
            [
                "read-file-tool"
            ],
            [
                "edit-file-tool"
            ],
            [
                "create-todo-tool"
            ],
            [
                "update-todo-tool"
            ],
            [
                "research-topic-tool"
            ],
            [
                "default-tool-handler"
            ]
        ]
    },
    {
        "id": "search-web-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Search Web Tool",
        "func": "const { TavilySearch } = global.get('lcTavily');\nconst TAVILY_API_KEY = global.get('TAVILY_API_KEY');\n\n// Create search tool instance\nconst searchTool = new TavilySearch({\n    maxResults: 5,\n    tavilyApiKey: TAVILY_API_KEY,\n    includeRawContent: false,\n    topic: \"general\"\n});\n\nnode.status({fill:\"yellow\", shape:\"dot\", text:\"üîç Searching...\"});\n\n(async () => {\n    try {\n        const query = msg.toolAction.parameters.query || msg.state.messages[0]?.content || \"general research\";\n        \n        // Perform the search\n        const results = await searchTool.invoke({ query: query });\n        \n        // Update state with search results\n        msg.state.searchHistory = msg.state.searchHistory || [];\n        msg.state.searchHistory.push({\n            query: query,\n            results: results,\n            timestamp: new Date().toISOString()\n        });\n        \n        // Add result to messages\n        msg.state.messages.push({\n            type: \"ai\",\n            content: `Search results for '${query}': ${JSON.stringify(results, null, 2)}`,\n            timestamp: new Date().toISOString()\n        });\n        \n        msg.payload = results;\n        \n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Search complete\"});\n        node.send(msg);\n    } catch (error) {\n        msg.payload = { error: `Search failed: ${error.message}` };\n        \n        // Add error to messages\n        msg.state.messages.push({\n            type: \"ai\",\n            content: `Search error: ${error.message}`,\n            timestamp: new Date().toISOString()\n        });\n        \n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Search failed\"});\n        node.error(error);\n        node.send(msg);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 60,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "write-file-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Write File Tool",
        "func": "node.status({fill:\"blue\", shape:\"dot\", text:\"üìù Writing file...\"});\n\ntry {\n    const { filePath, content } = msg.toolAction.parameters;\n    \n    // Update state\n    msg.state.files[filePath] = {\n        content: content,\n        createdAt: msg.state.files[filePath]?.createdAt || new Date().toISOString(),\n        modifiedAt: new Date().toISOString()\n    };\n    \n    // Special handling for todo.json\n    if (filePath === 'todo.json') {\n        try {\n            msg.state.todos = JSON.parse(content);\n        } catch (parseError) {\n            console.error('Failed to parse todo.json:', parseError);\n        }\n    }\n    \n    // Add result to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Successfully wrote to file: ${filePath}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    msg.payload = { success: true, path: filePath };\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ File written\"});\n    \n    return msg;\n} catch (error) {\n    msg.payload = { error: `Write file failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Write file error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Write failed\"});\n    node.error(error);\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 140,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "read-file-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Read File Tool",
        "func": "node.status({fill:\"blue\", shape:\"dot\", text:\"üìñ Reading file...\"});\n\ntry {\n    const { filePath } = msg.toolAction.parameters;\n    \n    let content;\n    let error;\n    \n    // Try to get from state first\n    if (msg.state.files[filePath]) {\n        content = msg.state.files[filePath].content;\n    } else {\n        error = `File ${filePath} not found in memory`;\n    }\n    \n    if (error) {\n        msg.payload = { error: error };\n        \n        // Add error to messages\n        msg.state.messages.push({\n            type: \"ai\",\n            content: `Read file error: ${error}`,\n            timestamp: new Date().toISOString()\n        });\n        \n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Read failed\"});\n    } else {\n        msg.payload = { content: content };\n        \n        // Add result to messages\n        msg.state.messages.push({\n            type: \"ai\",\n            content: `File content: ${content.substring(0, 200)}...`,\n            timestamp: new Date().toISOString()\n        });\n        \n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ File read\"});\n    }\n    \n    return msg;\n} catch (error) {\n    msg.payload = { error: `Read file failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Read file error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Read failed\"});\n    node.error(error);\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 220,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "edit-file-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Edit File Tool",
        "func": "node.status({fill:\"blue\", shape:\"dot\", text:\"‚úèÔ∏è Editing file...\"});\n\ntry {\n    const { filePath, oldContent, newContent } = msg.toolAction.parameters;\n    \n    // Get current file content\n    let currentContent;\n    if (msg.state.files[filePath]) {\n        currentContent = msg.state.files[filePath].content;\n    } else {\n        msg.payload = { error: `File ${filePath} not found` };\n        \n        // Add error to messages\n        msg.state.messages.push({\n            type: \"ai\",\n            content: `Edit file error: File ${filePath} not found`,\n            timestamp: new Date().toISOString()\n        });\n        \n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå File not found\"});\n        return msg;\n    }\n    \n    // Replace old content with new content\n    const updatedContent = currentContent.replace(oldContent, newContent);\n    \n    // Update state\n    msg.state.files[filePath] = {\n        content: updatedContent,\n        createdAt: msg.state.files[filePath].createdAt,\n        modifiedAt: new Date().toISOString()\n    };\n    \n    // Add result to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Successfully edited file: ${filePath}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    msg.payload = { success: true, path: filePath };\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ File edited\"});\n    \n    return msg;\n} catch (error) {\n    msg.payload = { error: `Edit file failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Edit file error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Edit failed\"});\n    node.error(error);\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 300,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "create-todo-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Create Todo Tool",
        "func": "node.status({fill:\"orange\", shape:\"dot\", text:\"üìã Creating todo...\"});\n\ntry {\n    const { content, status = \"pending\" } = msg.toolAction.parameters;\n    \n    const todo = {\n        id: Date.now().toString(),\n        content: content,\n        status: status,\n        createdAt: new Date().toISOString()\n    };\n    \n    // Add to state\n    msg.state.todos.push(todo);\n    \n    // Add result to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Created todo: ${content}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    msg.payload = todo;\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Todo created\"});\n    \n    return msg;\n} catch (error) {\n    msg.payload = { error: `Create todo failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Create todo error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Create failed\"});\n    node.error(error);\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 380,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "update-todo-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Update Todo Tool",
        "func": "node.status({fill:\"orange\", shape:\"dot\", text:\"üìã Updating todo...\"});\n\ntry {\n    const { id, status } = msg.toolAction.parameters;\n    \n    // Find and update the todo\n    const todoIndex = msg.state.todos.findIndex(t => t.id === id);\n    \n    if (todoIndex === -1) {\n        msg.payload = { error: `Todo with id ${id} not found` };\n        \n        // Add error to messages\n        msg.state.messages.push({\n            type: \"ai\",\n            content: `Update todo error: Todo with id ${id} not found`,\n            timestamp: new Date().toISOString()\n        });\n        \n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Todo not found\"});\n        return msg;\n    }\n    \n    // Update the todo\n    msg.state.todos[todoIndex].status = status;\n    msg.state.todos[todoIndex].updatedAt = new Date().toISOString();\n    \n    const updatedTodo = msg.state.todos[todoIndex];\n    \n    // Add result to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Updated todo: ${updatedTodo.content} to status: ${status}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    msg.payload = updatedTodo;\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Todo updated\"});\n    \n    return msg;\n} catch (error) {\n    msg.payload = { error: `Update todo failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Update todo error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Update failed\"});\n    node.error(error);\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 460,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "research-topic-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Research Topic Tool",
        "func": "node.status({fill:\"purple\", shape:\"dot\", text:\"üî¨ Researching topic...\"});\n\ntry {\n    const { topic, depth = \"general\" } = msg.toolAction.parameters;\n    \n    // For now, just do a search on the topic\n    // In a full implementation, this might involve more complex research\n    \n    msg.toolAction = {\n        tool: \"search_web\",\n        reasoning: `Researching topic: ${topic}`,\n        parameters: { query: topic }\n    };\n    \n    // Add result to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Starting research on topic: ${topic}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    msg.payload = `Beginning research on: ${topic}`;\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Research started\"});\n    \n    // Route back to search tool\n    return msg;\n} catch (error) {\n    msg.payload = { error: `Research topic failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Research topic error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Research failed\"});\n    node.error(error);\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 540,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "default-tool-handler",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Default Tool Handler",
        "func": "node.status({fill:\"gray\", shape:\"dot\", text:\"‚ùì Unknown tool\"});\n\nmsg.payload = { error: `Unknown tool: ${msg.toolAction.tool}` };\n\n// Add error to messages\nmsg.state.messages.push({\n    type: \"ai\",\n    content: `Unknown tool error: ${msg.toolAction.tool}`,\n    timestamp: new Date().toISOString()\n});\n\nnode.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Unknown tool\"});\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 620,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "check-continue-condition",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Check Continue Condition",
        "func": "node.status({fill:\"blue\", shape:\"dot\", text:\"üîÑ Checking continuation...\"});\n\n// Increment iteration counter\nmsg.state.iteration = (msg.state.iteration || 0) + 1;\n\n// Check if we should continue or stop\nconst shouldContinue = msg.state.iteration < msg.state.maxIterations;\n\n// Check if we have enough information to create a final report\nconst completedTodos = msg.state.todos.filter(t => t.status === \"completed\").length;\nconst hasSearchResults = msg.state.searchHistory.length > 0;\nconst hasQuestionFile = !!msg.state.files[\"question.txt\"];\n\nconst shouldCreateReport = (completedTodos > 0 && hasSearchResults && hasQuestionFile) || \n                          (msg.state.searchHistory.length > 2); // If we have substantial search results\n\nmsg.shouldContinue = shouldContinue && !shouldCreateReport;\nmsg.shouldCreateReport = shouldCreateReport;\n\nif (shouldCreateReport) {\n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Ready to create report\"});\n} else if (!shouldContinue) {\n    node.status({fill:\"yellow\", shape:\"dot\", text:\"‚èπÔ∏è Max iterations reached\"});\n} else {\n    node.status({fill:\"blue\", shape:\"dot\", text:\"üîÑ Continuing iteration\"});\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1150,
        "y": 300,
        "wires": [
            [
                "continue-decision"
            ]
        ]
    },
    {
        "id": "continue-decision",
        "type": "switch",
        "z": "5f6eebf04085ab9f",
        "name": "Continue Decision",
        "property": "shouldCreateReport",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1270,
        "y": 380,
        "wires": [
            [
                "generate-final-report"
            ],
            [
                "continue-loop-check"
            ]
        ]
    },
    {
        "id": "continue-loop-check",
        "type": "switch",
        "z": "5f6eebf04085ab9f",
        "name": "Continue Loop?",
        "property": "shouldContinue",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1360,
        "y": 460,
        "wires": [
            [
                "77988e4ab192c193"
            ],
            [
                "959777cf9e31b547"
            ]
        ]
    },
    {
        "id": "generate-final-report",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Generate Final Report",
        "func": "node.status({fill:\"green\", shape:\"dot\", text:\"üìù Generating report...\"});\n\ntry {\n    const state = msg.state;\n    \n    // Get the original question\n    let question = \"Unknown question\";\n    if (state.files[\"question.txt\"]) {\n        question = state.files[\"question.txt\"].content;\n    }\n    \n    let report = `# Research Report\\n\\n`;\n    report += `## Question\\n${question}\\n\\n`;\n    report += `## Sources and Findings\\n`;\n    \n    if (state.searchHistory.length === 0) {\n        report += `No search results were obtained during the research process.\\n\\n`;\n    } else {\n        // Process search results and format with citations\n        let sourceCounter = 1;\n        const sources = [];\n        \n        for (const search of state.searchHistory) {\n            report += `### Search Query: ${search.query}\\n`;\n            \n            if (search.results && !search.results.error) {\n                if (Array.isArray(search.results.results)) {\n                    for (const result of search.results.results) {\n                        // Add to sources list\n                        sources.push({ id: sourceCounter, title: result.title, url: result.url });\n                        \n                        // Add citation in the text\n                        report += `- [${result.title}][${sourceCounter}]\\n`;\n                        if (result.content) {\n                            report += `  - ${result.content.substring(0, 200)}...\\n\\n`;\n                        }\n                        \n                        sourceCounter++;\n                    }\n                } else {\n                    // Handle case where results are in a different format\n                    report += `Results: ${JSON.stringify(search.results, null, 2)}\\n\\n`;\n                }\n            } else {\n                // Handle error case\n                report += `Search error: ${search.results?.error || 'Unknown error'}\\n\\n`;\n            }\n        }\n        \n        // Add sources section at the end\n        if (sources.length > 0) {\n            report += `\\n### Sources\\n`;\n            for (const source of sources) {\n                report += `[${source.id}] ${source.title}: ${source.url}\\n`;\n            }\n        }\n    }\n    \n    report += `\\n## Summary\\n`;\n    if (state.searchHistory.length > 0) {\n        report += `Based on the research conducted, here are the key findings...\\n`;\n    } else {\n        report += `The research process did not yield any results, possibly due to API issues or connectivity problems.\\n`;\n    }\n    \n    // Add report to state\n    state.files[\"final_report.md\"] = {\n        content: report,\n        createdAt: new Date().toISOString(),\n        modifiedAt: new Date().toISOString()\n    };\n    \n    // Update main todo to completed\n    const mainTodo = state.todos.find(t => t.content.includes(question));\n    if (mainTodo) {\n        mainTodo.status = \"completed\";\n        mainTodo.updatedAt = new Date().toISOString();\n    }\n    \n    // Add result to messages\n    state.messages.push({\n        type: \"ai\",\n        content: `Final report generated with ${state.searchHistory.length} search results`,\n        timestamp: new Date().toISOString()\n    });\n    \n    msg.payload = report;\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Report generated\"});\n    \n    return msg;\n} catch (error) {\n    msg.payload = { error: `Report generation failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Report generation error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Report gen failed\"});\n    node.error(error);\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 320,
        "wires": [
            [
                "write-final-report"
            ]
        ]
    },
    {
        "id": "write-final-report",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Write Final Report",
        "func": "node.status({fill:\"blue\", shape:\"dot\", text:\"üíæ Writing final report...\"});\n\ntry {\n    const reportContent = msg.payload.content || msg.payload;\n    const filePath = \"final_report.md\";\n    \n    // Update state\n    msg.state.files[filePath] = {\n        content: reportContent,\n        createdAt: msg.state.files[filePath]?.createdAt || new Date().toISOString(),\n        modifiedAt: new Date().toISOString()\n    };\n    \n    // Add result to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Final report written to ${filePath}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    // Prepare for file output (send just the content)\n    msg.payload = reportContent;\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Report saved\"});\n    \n    return msg;\n} catch (error) {\n    msg.payload = { error: `Write report failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Write report error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Write failed\"});\n    node.error(error);\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1730,
        "y": 320,
        "wires": [
            [
                "final-report-file-out",
                "521bcc5df3b99439"
            ]
        ]
    },
    {
        "id": "final-output",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Final Output",
        "func": "node.status({fill:\"green\", shape:\"dot\", text:\"üéâ Research complete\"});\n\n// Prepare final result\nmsg.payload = {\n    finalReport: msg.state.files[\"final_report.md\"]?.content || null,\n    todos: msg.state.todos,\n    files: Object.keys(msg.state.files),\n    searchHistory: msg.state.searchHistory,\n    iterationCount: msg.state.iteration\n};\n\n// Add completion message to state\nmsg.state.messages.push({\n    type: \"system\",\n    content: `Research completed after ${msg.state.iteration} iterations`,\n    timestamp: new Date().toISOString()\n});\n\nnode.done(null, msg);\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 860,
        "wires": [
            [
                "debug-output"
            ]
        ]
    },
    {
        "id": "debug-output",
        "type": "debug",
        "z": "5f6eebf04085ab9f",
        "name": "Debug Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 860,
        "wires": []
    },
    {
        "id": "77988e4ab192c193",
        "type": "link out",
        "z": "5f6eebf04085ab9f",
        "name": "Build Prompt & Select Tool Link Out",
        "mode": "link",
        "links": [
            "2ef20357a461d84b"
        ],
        "x": 1515,
        "y": 440,
        "wires": []
    },
    {
        "id": "2ef20357a461d84b",
        "type": "link in",
        "z": "5f6eebf04085ab9f",
        "name": "Build Prompt & Select Tool Link In",
        "links": [
            "77988e4ab192c193"
        ],
        "x": 85,
        "y": 300,
        "wires": [
            [
                "build-prompt-and-select-tool"
            ]
        ]
    },
    {
        "id": "4246e54586a24ebf",
        "type": "link in",
        "z": "5f6eebf04085ab9f",
        "name": "Final Output In",
        "links": [
            "959777cf9e31b547",
            "521bcc5df3b99439"
        ],
        "x": 655,
        "y": 860,
        "wires": [
            [
                "final-output"
            ]
        ]
    },
    {
        "id": "959777cf9e31b547",
        "type": "link out",
        "z": "5f6eebf04085ab9f",
        "name": "Final Output Out",
        "mode": "link",
        "links": [
            "4246e54586a24ebf"
        ],
        "x": 1515,
        "y": 480,
        "wires": []
    },
    {
        "id": "final-report-file-out",
        "type": "file",
        "z": "5f6eebf04085ab9f",
        "name": "Save final_report.md",
        "filename": "final_report.md",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1880,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "521bcc5df3b99439",
        "type": "link out",
        "z": "5f6eebf04085ab9f",
        "name": "Final Output Out",
        "mode": "link",
        "links": [
            "4246e54586a24ebf"
        ],
        "x": 1855,
        "y": 380,
        "wires": []
    },
    {
        "id": "741a40fcd008f1ab",
        "type": "websocket in",
        "z": "0885b58486b6cfde",
        "name": "",
        "server": "8a9b6c5d4e3f2a10",
        "client": "",
        "x": 320,
        "y": 840,
        "wires": [
            [
                "9360260cefcd707c"
            ]
        ]
    },
    {
        "id": "321390c65b95421a",
        "type": "inject",
        "z": "0885b58486b6cfde",
        "name": "Search Query: get_weather",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "What is the weather like in New York?",
        "payloadType": "str",
        "x": 300,
        "y": 760,
        "wires": [
            [
                "9360260cefcd707c"
            ]
        ]
    },
    {
        "id": "9360260cefcd707c",
        "type": "function",
        "z": "0885b58486b6cfde",
        "name": "ü§ñ Router Agent",
        "func": "node.status({fill:\"blue\", shape:\"dot\", text:\"ü§ñ Analyzing...\"});\n\nconst { ChatOllama } = global.get('lcOllama');\nconst { z } = global.get('zod');\n\n// Tool Constants\nconst SEARCH_WEB = \"search_web\";\nconst CALCULATE = \"calculate\";\nconst GET_WEATHER = \"get_weather\";\n\nconst ToolSchema = z.object({\n    tool: z.enum([SEARCH_WEB, CALCULATE, GET_WEATHER]),\n    reasoning: z.string().describe(\"Brief explanation of why this tool was chosen\"),\n    parameters: z.union([\n        z.object({ query: z.string().describe(\"Search query for web search\") }),\n        z.object({ expression: z.string().describe(\"Mathematical expression to calculate\") }),\n        z.object({ city: z.string().describe(\"City name for weather information\") })\n    ]).describe(\"Parameters for the tool call\")\n});\n\nconst llm = new ChatOllama({ model: \"qwen2.5:7b\", temperature: 0 });\nconst structuredLlm = llm.withStructuredOutput(ToolSchema);\n\n(async () => {\n    try {\n        const query = msg.payload || msg.query || \"\";\n        \n        // Create a message array for the LLM\n        const messages = [\n            {\n                role: \"user\",\n                content: `Based on the user's input, choose the most appropriate tool to help them.\\n\\nUser input: ${query}\\n\\nChoose a tool and provide the necessary parameters.`\n            }\n        ];\n\n        const classification = await structuredLlm.invoke(messages);\n\n        msg.state = {\n            query: query,\n            classification\n        };\n        \n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Tool selected: \" + classification.tool});\n        node.send(msg);\n    } catch (e) {\n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Error\"});\n        node.error(e);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 700,
        "wires": [
            [
                "48cda544a6b7ed33"
            ]
        ]
    },
    {
        "id": "48cda544a6b7ed33",
        "type": "switch",
        "z": "0885b58486b6cfde",
        "name": "üîÄ Route to Tool",
        "property": "state.classification.tool",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "search_web",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "calculate",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "get_weather",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 950,
        "y": 700,
        "wires": [
            [
                "607e2b208b80a6ea"
            ],
            [
                "6c4c7f0fcfb1fa52"
            ],
            [
                "c01a48b447cbeecd"
            ]
        ]
    },
    {
        "id": "607e2b208b80a6ea",
        "type": "function",
        "z": "0885b58486b6cfde",
        "name": "üîç search_web",
        "func": "node.status({fill:\"yellow\", shape:\"dot\", text:\"üîç Searching...\"});\n\nconst { TavilySearch } = global.get('lcTavily');\nconst TAVILY_API_KEY = global.get('TAVILY_API_KEY');\n\nconst searchTool = new TavilySearch({\n    maxResults: 5,\n    tavilyApiKey: TAVILY_API_KEY,\n    includeRawContent: false,\n    topic: \"general\"\n});\n\n(async () => {\n    try {\n        const query = msg.state.classification.parameters.query || msg.state.query;\n        const results = await searchTool.invoke({ query: query });\n        \n        msg.payload = results;\n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Search complete\"});\n        node.send(msg);\n    } catch (error) {\n        msg.payload = { error: `Search failed: ${error.message}` };\n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Search failed\"});\n        node.error(error);\n        node.send(msg);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 620,
        "wires": [
            [
                "df331ccf0b1c9fe1"
            ]
        ]
    },
    {
        "id": "6c4c7f0fcfb1fa52",
        "type": "function",
        "z": "0885b58486b6cfde",
        "name": "üßÆ calculate",
        "func": "node.status({fill:\"orange\", shape:\"dot\", text:\"üßÆ Calculating...\"});\n\n(async () => {\n    try {\n        const expression = msg.state.classification.parameters.expression || msg.state.query;\n        // Simple calculator - only basic operations\n        const sanitized = expression.replace(/[^0-9+\\-*/().\\s]/g, '');\n        // Using Function constructor for safe evaluation (in a real app, use a proper expression parser)\n        const result = Function('\"use strict\"; return (' + sanitized + ')')();\n        \n        msg.payload = { result: result };\n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Calculation done\"});\n        node.send(msg);\n    } catch (error) {\n        msg.payload = { error: `Calculation failed: ${error.message}` };\n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Calc failed\"});\n        node.error(error);\n        node.send(msg);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 700,
        "wires": [
            [
                "df331ccf0b1c9fe1"
            ]
        ]
    },
    {
        "id": "c01a48b447cbeecd",
        "type": "function",
        "z": "0885b58486b6cfde",
        "name": "üå§Ô∏è get_weather",
        "func": "node.status({fill:\"lightblue\", shape:\"dot\", text:\"üå§Ô∏è Checking weather...\"});\n\n(async () => {\n    try {\n        const city = msg.state.classification.parameters.city || msg.state.query;\n        \n        // Simulated weather tool (in a real implementation, connect to a weather API)\n        const weatherData = {\n            \"new york\": { temperature: \"18¬∞C\", condition: \"Cloudy\" },\n            \"london\": { temperature: \"12¬∞C\", condition: \"Rainy\" },\n            \"tokyo\": { temperature: \"22¬∞C\", condition: \"Sunny\" },\n            \"paris\": { temperature: \"15¬∞C\", condition: \"Partly cloudy\" }\n        };\n\n        const lowerCity = city.toLowerCase();\n        if (weatherData[lowerCity]) {\n            msg.payload = weatherData[lowerCity];\n        } else {\n            msg.payload = {\n                temperature: \"Unknown\",\n                condition: \"Weather data not available for \" + city\n            };\n        }\n        \n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Weather data ready\"});\n        node.send(msg);\n    } catch (error) {\n        msg.payload = { error: `Weather lookup failed: ${error.message}` };\n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Weather failed\"});\n        node.error(error);\n        node.send(msg);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 780,
        "wires": [
            [
                "df331ccf0b1c9fe1"
            ]
        ]
    },
    {
        "id": "df331ccf0b1c9fe1",
        "type": "function",
        "z": "0885b58486b6cfde",
        "name": "üí¨ format_response",
        "func": "node.status({fill:\"purple\", shape:\"dot\", text:\"üí¨ Formatting response...\"});\n\nconst { ChatOllama } = global.get('lcOllama');\nconst llm = new ChatOllama({ model: \"qwen2.5:7b\", temperature: 0.7 });\n\n(async () => {\n    const input = msg.state.query;\n    const toolUsed = msg.state.classification.tool;\n    const toolResult = msg.payload;\n    \n    if (toolResult.error) {\n        msg.payload = `I encountered an error while processing your request: ${toolResult.error}`;\n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Error in response\"});\n        node.send(msg);\n        return null;\n    }\n\n    // Generate a human-readable response based on the tool result\n    let response;\n    switch (toolUsed) {\n        case \"search_web\":\n            if (toolResult.results && toolResult.results.length > 0) {\n                const topResult = toolResult.results[0];\n                response = `I found this information: ${topResult.content.substring(0, 200)}... [from ${topResult.url}]`;\n            } else {\n                response = \"I couldn't find relevant information for your query.\";\n            }\n            break;\n        case \"calculate\":\n            response = `The result of the calculation is: ${toolResult.result}`;\n            break;\n        case \"get_weather\":\n            response = `The weather in ${msg.state.classification.parameters.city || input} is ${toolResult.temperature}, ${toolResult.condition.toLowerCase()}.`;\n            break;\n        default:\n            response = `Processed your request with ${toolUsed}. Result: ${JSON.stringify(toolResult)}`;\n    }\n    \n    // Use the LLM to refine the response\n    try {\n        const messages = [\n            {\n                role: \"user\",\n                content: `Format this response in a friendly way: ${response}`\n            }\n        ];\n        \n        const refinedResponse = await llm.invoke(messages);\n        // Check if refinedResponse is an object with content property (AIMessage)\n        if (refinedResponse && typeof refinedResponse === 'object' && refinedResponse.content) {\n            msg.payload = refinedResponse.content;\n        } else {\n            msg.payload = refinedResponse;\n        }\n        \n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Response formatted\"});\n    } catch (e) {\n        // If LLM formatting fails, use the original response\n        msg.payload = response;\n        node.status({fill:\"yellow\", shape:\"dot\", text:\"‚ö†Ô∏è Response formatted (no LLM)\"});\n    }\n    \n    node.send(msg);\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1540,
        "y": 700,
        "wires": [
            [
                "0629608d8f8b07ca",
                "e24407ce63649b29"
            ]
        ]
    },
    {
        "id": "0629608d8f8b07ca",
        "type": "debug",
        "z": "0885b58486b6cfde",
        "name": "üì§ Shallow Agent Response",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1840,
        "y": 740,
        "wires": []
    },
    {
        "id": "57de150a4f2a8dd1",
        "type": "inject",
        "z": "0885b58486b6cfde",
        "name": "Search Query: search_web",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Search for the latest news about artificial intelligence",
        "payloadType": "str",
        "x": 310,
        "y": 600,
        "wires": [
            [
                "9360260cefcd707c"
            ]
        ]
    },
    {
        "id": "2580e2e3dc333e4d",
        "type": "inject",
        "z": "0885b58486b6cfde",
        "name": "Search Query: calculate",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "five times five equals?",
        "payloadType": "str",
        "x": 320,
        "y": 680,
        "wires": [
            [
                "9360260cefcd707c"
            ]
        ]
    },
    {
        "id": "72e4a51207e3d9ac",
        "type": "file in",
        "z": "0885b58486b6cfde",
        "name": "",
        "filename": ".node-red/projects/node-red/react/shallow-agent.html",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 900,
        "y": 360,
        "wires": [
            [
                "6b0935d950c12827"
            ]
        ]
    },
    {
        "id": "506651486bb31a0c",
        "type": "http in",
        "z": "0885b58486b6cfde",
        "name": "",
        "url": "/show-shallow-agent",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 530,
        "y": 360,
        "wires": [
            [
                "72e4a51207e3d9ac"
            ]
        ]
    },
    {
        "id": "6b0935d950c12827",
        "type": "http response",
        "z": "0885b58486b6cfde",
        "name": "",
        "x": 1230,
        "y": 360,
        "wires": []
    },
    {
        "id": "e24407ce63649b29",
        "type": "websocket out",
        "z": "0885b58486b6cfde",
        "name": "",
        "server": "8a9b6c5d4e3f2a10",
        "client": "",
        "x": 1790,
        "y": 660,
        "wires": []
    },
    {
        "id": "d00af331777b95a2",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "Router Agent",
        "func": "const { ChatOllama } = global.get('lcOllama');\nconst { z } = global.get('zod');\n\n// Tool Constants\nconst SEARCH_WEB = \"search_web\";\nconst TELL_JOKE = \"tell_joke\";\nconst GET_WEATHER = \"get_weather\";\nconst CONVERT_CURRENCY = \"convert_currency\";\nconst DEBUG_CODE = \"debug_code\";\nconst SUMMARIZE_TEXT = \"summarize_text\";\nconst CALCULATE_MATH = \"calculate_math\";\nconst GET_STOCK = \"get_stock_price\";\nconst TRANSLATE = \"translate_text\";\n\nconst ToolSchema = z.object({\n    tool: z.enum([\n        SEARCH_WEB,\n        TELL_JOKE,\n        GET_WEATHER,\n        CONVERT_CURRENCY,\n        DEBUG_CODE,\n        SUMMARIZE_TEXT,\n        CALCULATE_MATH,\n        GET_STOCK,\n        TRANSLATE\n    ]),\n    reasoning: z.string().describe(\"Brief explanation of why this tool was chosen\")\n})\n\nconst llm = new ChatOllama({ model: \"qwen2.5:7b\", temperature: 0 });\nconst structuredLlm = llm.withStructuredOutput(ToolSchema);\n\n(async () => {\n    try {\n        const state = {\n            query: msg.query || \"\",            \n        };\n\n        const classification = await structuredLlm.invoke(state.query);\n\n        msg.state = {\n            ...state,\n            classification\n        };\n        node.send(msg);\n    } catch (e) {\n        node.error(e);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 420,
        "wires": [
            [
                "7c99601a26a767a8"
            ]
        ]
    },
    {
        "id": "7c99601a26a767a8",
        "type": "switch",
        "z": "a18fd0a91e07848d",
        "name": "Route to Tool",
        "property": "state.classification.tool",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "search_web",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "tell_joke",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "get_weather",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "convert_currency",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "summarize_text",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "calculate_math",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "get_stock_price",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "translate_text",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 8,
        "x": 840,
        "y": 420,
        "wires": [
            [
                "cc48e66e78d92b55"
            ],
            [
                "bcfe456e8a0db1e6"
            ],
            [
                "d96cc42e06af1f99"
            ],
            [
                "58d61aa5986d18bc"
            ],
            [
                "77b34ba6d5c27199"
            ],
            [
                "ab8f81b47ca31371"
            ],
            [
                "4e53110b74586e39"
            ],
            [
                "85f2b10ff0e6dd85"
            ]
        ]
    },
    {
        "id": "ab8f81b47ca31371",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "calculate_math",
        "func": "console.log(\"math\"); return msg;",
        "outputs": 1,
        "x": 1100,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "4e53110b74586e39",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "get_stock_price",
        "func": "console.log(\"stocks\"); return msg;",
        "outputs": 1,
        "x": 1100,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "85f2b10ff0e6dd85",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "translate_text",
        "func": "console.log(\"translate\"); return msg;",
        "outputs": 1,
        "x": 1100,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "32bd0623cb76e261",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "tell_joke",
        "props": [
            {
                "p": "query",
                "v": "Tell me a joke about a programmer",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 320,
        "y": 320,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "1e2ce84e6d9258df",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "search_web",
        "props": [
            {
                "p": "query",
                "v": "Latest AI news 2025",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 310,
        "y": 240,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "9d1abad15636d13b",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "get_weather",
        "props": [
            {
                "p": "query",
                "v": "Weather in London",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 310,
        "y": 420,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "1548cc54bb8c2f22",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "convert_currency",
        "props": [
            {
                "p": "query",
                "v": "50 USD to EUR",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 300,
        "y": 500,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "7bb944ca4d0e4ce4",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "summarize_text",
        "props": [
            {
                "p": "query",
                "v": "Summarize the history of the moon",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 300,
        "y": 580,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "c202cb3ad0f5a367",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "calculate_math",
        "props": [
            {
                "p": "query",
                "v": "What is 256 times 12?",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 300,
        "y": 660,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "d48cec575e0e4f44",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "get_stock_price",
        "props": [
            {
                "p": "query",
                "v": "What is the price of Tesla?",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 300,
        "y": 720,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "cc48e66e78d92b55",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "search_web",
        "func": "console.log(\"search_web\"); return msg;",
        "outputs": 1,
        "x": 1090,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "bcfe456e8a0db1e6",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "tell_joke",
        "func": "console.log(\"tell_joke\"); return msg;",
        "outputs": 1,
        "x": 1080,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "d96cc42e06af1f99",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "get_weather",
        "func": "console.log(\"get_weather\"); return msg;",
        "outputs": 1,
        "x": 1090,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "58d61aa5986d18bc",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "convert_currency",
        "func": "console.log(\"convert_currency\"); return msg;",
        "outputs": 1,
        "x": 1110,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "77b34ba6d5c27199",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "summarize_text",
        "func": "console.log(\"summarize_text\"); return msg;",
        "outputs": 1,
        "x": 1100,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "5e0ddaade57f14fe",
        "type": "inject",
        "z": "d9c88a0a246ec309",
        "name": "Situacija",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 260,
        "wires": [
            [
                "8341a933b165eceb"
            ]
        ]
    },
    {
        "id": "8341a933b165eceb",
        "type": "change",
        "z": "d9c88a0a246ec309",
        "name": "Motyvacija",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 260,
        "wires": [
            [
                "886151dd6f39346c"
            ]
        ]
    },
    {
        "id": "886151dd6f39346c",
        "type": "debug",
        "z": "d9c88a0a246ec309",
        "name": "Rezultatas",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 670,
        "y": 260,
        "wires": []
    },
    {
        "id": "69688b15eb0d1015",
        "type": "inject",
        "z": "d9c88a0a246ec309",
        "name": "When...",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 230,
        "y": 400,
        "wires": [
            [
                "213ae8abae4ea3b3"
            ]
        ]
    },
    {
        "id": "213ae8abae4ea3b3",
        "type": "switch",
        "z": "d9c88a0a246ec309",
        "name": "I want to...",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 450,
        "y": 400,
        "wires": [
            [
                "1106b568bf2064d0"
            ]
        ]
    },
    {
        "id": "1106b568bf2064d0",
        "type": "debug",
        "z": "d9c88a0a246ec309",
        "name": "So I can...",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 680,
        "y": 400,
        "wires": []
    },
    {
        "id": "eb86f27a56533232",
        "type": "inject",
        "z": "d9c88a0a246ec309",
        "name": "Situation",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 320,
        "wires": [
            [
                "0def639bf5173b3d"
            ]
        ]
    },
    {
        "id": "0def639bf5173b3d",
        "type": "change",
        "z": "d9c88a0a246ec309",
        "name": "Motivation",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 320,
        "wires": [
            [
                "43819c375eb57831"
            ]
        ]
    },
    {
        "id": "43819c375eb57831",
        "type": "debug",
        "z": "d9c88a0a246ec309",
        "name": "Expected outcome",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 320,
        "wires": []
    },
    {
        "id": "9804ae9eb68137ee",
        "type": "inject",
        "z": "b70b82bf8d00eb8a",
        "name": "ctx = 0",
        "props": [
            {
                "p": "ctx",
                "v": "0",
                "vt": "num"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 410,
        "y": 280,
        "wires": [
            [
                "b82bdc1deb8ef509"
            ]
        ]
    },
    {
        "id": "b82bdc1deb8ef509",
        "type": "change",
        "z": "b70b82bf8d00eb8a",
        "name": "ctx++",
        "rules": [
            {
                "t": "set",
                "p": "ctx",
                "pt": "msg",
                "to": "ctx+1",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 360,
        "wires": [
            [
                "7855f2d23e2157f5",
                "7a6d9d05e5d9bf8a"
            ]
        ]
    },
    {
        "id": "7855f2d23e2157f5",
        "type": "debug",
        "z": "b70b82bf8d00eb8a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "ctx",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 860,
        "y": 280,
        "wires": []
    },
    {
        "id": "7a6d9d05e5d9bf8a",
        "type": "switch",
        "z": "b70b82bf8d00eb8a",
        "name": "while ( ctx < 10 )",
        "property": "ctx",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "10",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 640,
        "y": 220,
        "wires": [
            [
                "b82bdc1deb8ef509"
            ]
        ]
    },
    {
        "id": "db0c792680c91dc6",
        "type": "inject",
        "z": "b70b82bf8d00eb8a",
        "name": "[1,2,3,4,5,6]",
        "props": [
            {
                "p": "payload.array",
                "v": "[1,2,3,4,5,6]",
                "vt": "json"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 370,
        "y": 520,
        "wires": [
            [
                "65d3bdb48885b420"
            ]
        ]
    },
    {
        "id": "65d3bdb48885b420",
        "type": "function",
        "z": "b70b82bf8d00eb8a",
        "name": "Pop item from the array",
        "func": "const val = msg.payload.array.pop();\n//console.log(val);\nmsg.payload = {\n    ...msg.payload,\n    'val': val\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 520,
        "wires": [
            [
                "48a2f59561eb8d74"
            ]
        ]
    },
    {
        "id": "8da682fac1a35894",
        "type": "switch",
        "z": "b70b82bf8d00eb8a",
        "name": "",
        "property": "payload.array.length",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 830,
        "y": 620,
        "wires": [
            [
                "65d3bdb48885b420"
            ],
            [
                "23fd320f9c895f4c"
            ]
        ]
    },
    {
        "id": "23fd320f9c895f4c",
        "type": "debug",
        "z": "b70b82bf8d00eb8a",
        "name": "debug 15",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 740,
        "wires": []
    },
    {
        "id": "48a2f59561eb8d74",
        "type": "function",
        "z": "b70b82bf8d00eb8a",
        "name": "Print value",
        "func": "console.log( 'val', msg.payload.val );\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 520,
        "wires": [
            [
                "8da682fac1a35894",
                "a467bbb1688a0f53"
            ]
        ]
    },
    {
        "id": "a467bbb1688a0f53",
        "type": "debug",
        "z": "b70b82bf8d00eb8a",
        "name": "debug 16",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload.val",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1120,
        "y": 460,
        "wires": []
    },
    {
        "id": "59ff2a1.fa600d4",
        "type": "http in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "url": "/react",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 40,
        "wires": [
            [
                "7e73aef5e421cf29"
            ]
        ]
    },
    {
        "id": "266c286f.d993d8",
        "type": "http response",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "x": 1050,
        "y": 240,
        "wires": []
    },
    {
        "id": "7e73aef5e421cf29",
        "type": "file in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "filename": ".node-red/projects/node-red/react/index.html",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 610,
        "y": 40,
        "wires": [
            [
                "266c286f.d993d8"
            ]
        ]
    },
    {
        "id": "68572dadaaea1467",
        "type": "file in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "filename": ".node-red/projects/node-red/react/test.js",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 600,
        "y": 120,
        "wires": [
            [
                "266c286f.d993d8"
            ]
        ]
    },
    {
        "id": "77ac86f8d9cda0e5",
        "type": "http in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "url": "/react/test.js",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 120,
        "wires": [
            [
                "68572dadaaea1467"
            ]
        ]
    },
    {
        "id": "f5280916e3560f07",
        "type": "file in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "filename": ".node-red/projects/node-red/react/ImageModal.js",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 620,
        "y": 200,
        "wires": [
            [
                "266c286f.d993d8"
            ]
        ]
    },
    {
        "id": "5fdb6b26612b3512",
        "type": "http in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "url": "/react/ImageModal.js",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 200,
        "wires": [
            [
                "f5280916e3560f07"
            ]
        ]
    },
    {
        "id": "8d9a7d7eef29e155",
        "type": "http in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "url": "/react/WebSocketTest.js",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 280,
        "wires": [
            [
                "aba8749fd67bf0c3"
            ]
        ]
    },
    {
        "id": "aba8749fd67bf0c3",
        "type": "file in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "filename": ".node-red/projects/node-red/react/WebSocketTest.js",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 630,
        "y": 280,
        "wires": [
            [
                "266c286f.d993d8"
            ]
        ]
    },
    {
        "id": "ce6adba5081d840f",
        "type": "websocket out",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "server": "65fccb54d6cf3d7f",
        "client": "",
        "x": 1100,
        "y": 700,
        "wires": []
    },
    {
        "id": "c3bca1cfd22180d1",
        "type": "inject",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Hello",
        "payloadType": "str",
        "x": 1090,
        "y": 600,
        "wires": [
            [
                "ce6adba5081d840f"
            ]
        ]
    },
    {
        "id": "2a63a69f0a893163",
        "type": "websocket in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "server": "65fccb54d6cf3d7f",
        "client": "",
        "x": 110,
        "y": 520,
        "wires": [
            [
                "7b32b19d64d48a84"
            ]
        ]
    },
    {
        "id": "8e34fbd988384994",
        "type": "debug",
        "z": "f03d232b4fcc4b3e",
        "name": "otherwise",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 560,
        "y": 740,
        "wires": []
    },
    {
        "id": "866c93fbcc3ce222",
        "type": "http in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "url": "/react/Traverse.js",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 360,
        "wires": [
            [
                "c7975da2f90be921"
            ]
        ]
    },
    {
        "id": "c7975da2f90be921",
        "type": "file in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "filename": ".node-red/projects/node-red/react/Traverse.js",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 610,
        "y": 360,
        "wires": [
            [
                "266c286f.d993d8"
            ]
        ]
    },
    {
        "id": "8384341326434dfa",
        "type": "http in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "url": "/react/P27.js",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 440,
        "wires": [
            [
                "b085d72ffa8c6b0b"
            ]
        ]
    },
    {
        "id": "b085d72ffa8c6b0b",
        "type": "file in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "filename": ".node-red/projects/node-red/react/P27.js",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 600,
        "y": 440,
        "wires": [
            [
                "266c286f.d993d8"
            ]
        ]
    },
    {
        "id": "15e54e6e2251c4f9",
        "type": "switch",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "property": "payload.action",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 210,
        "y": 660,
        "wires": [
            [
                "0648de1adc9bb5ce"
            ],
            [
                "9bd6cc45287fc9e6"
            ],
            [
                "2f7ffb0a5faef15c"
            ],
            [
                "8e34fbd988384994"
            ]
        ]
    },
    {
        "id": "7b32b19d64d48a84",
        "type": "json",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": true,
        "x": 170,
        "y": 580,
        "wires": [
            [
                "15e54e6e2251c4f9"
            ]
        ]
    },
    {
        "id": "0648de1adc9bb5ce",
        "type": "function",
        "z": "f03d232b4fcc4b3e",
        "name": "insert",
        "func": "const jSonFromFrontend = msg.payload.data;\n\nconst jSon1 = [\n    { \"clien_id\": 1, \"amount\": jSonFromFrontend.traceId },\n    { \"clien_id\": 2, \"amount\": 3 },\n    { \"clien_id\": 3, \"amount\": 3 }\n];\n\nconst jSon2 = jSon1;\n\nconst jSonP27 = jSon1;\n\nconst jSonResponse = {\n    action: 0,\n    jSon1: jSon1,\n    jSon2: jSon2,\n    jSon3: jSonP27,\n};\nmsg.payload = jSonResponse;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 560,
        "wires": [
            [
                "ce6adba5081d840f"
            ]
        ]
    },
    {
        "id": "9bd6cc45287fc9e6",
        "type": "function",
        "z": "f03d232b4fcc4b3e",
        "name": "refresh",
        "func": "\nconst jSon1 = [\n    { \"clien_id\": 1, \"amount\": 3 },\n    { \"clien_id\": 2, \"amount\": 3 },\n    { \"clien_id\": 3, \"amount\": 3 }\n];\n\nconst jSon2 = jSon1;\n\nconst jSonP27 = jSon1;\n\nconst jSonResponse = {\n    action: 0,\n    jSon1: jSon1,\n    jSon2: jSon2,\n    jSon3: jSonP27,\n};\nmsg.payload = jSonResponse;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 620,
        "wires": [
            [
                "ce6adba5081d840f"
            ]
        ]
    },
    {
        "id": "2f7ffb0a5faef15c",
        "type": "function",
        "z": "f03d232b4fcc4b3e",
        "name": "delete",
        "func": "\nconst jSon1 = [\n    { \"clien_id\": 1, \"amount\": 7 },\n    { \"clien_id\": 2, \"amount\": 8 },\n    { \"clien_id\": 3, \"amount\": 9 }\n];\n\nconst jSon2 = jSon1;\n\nconst jSonP27 = jSon1;\n\nconst jSonResponse = {\n    action: 0,\n    jSon1: jSon1,\n    jSon2: jSon2,\n    jSon3: jSonP27,\n};\nmsg.payload = jSonResponse;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 680,
        "wires": [
            [
                "ce6adba5081d840f"
            ]
        ]
    },
    {
        "id": "83e0257de19abd28",
        "type": "http in",
        "z": "7184d5a8972f1fe0",
        "name": "",
        "url": "/web",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 380,
        "y": 360,
        "wires": [
            [
                "da7d2b952a3c8df0"
            ]
        ]
    },
    {
        "id": "8cf3deb298512f66",
        "type": "http response",
        "z": "7184d5a8972f1fe0",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1030,
        "y": 360,
        "wires": []
    },
    {
        "id": "6248cd7fd679aa6e",
        "type": "template",
        "z": "7184d5a8972f1fe0",
        "name": "HTML",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Title</title>\n    <script>\n        {{{payload.websocket}}}\n    </script>\n</head>\n<body>\nHello\n</body>\n</html>",
        "output": "str",
        "x": 850,
        "y": 360,
        "wires": [
            [
                "8cf3deb298512f66"
            ]
        ]
    },
    {
        "id": "d42f9d0712bcedbb",
        "type": "websocket in",
        "z": "7184d5a8972f1fe0",
        "name": "",
        "server": "b79df368d7aaac79",
        "client": "",
        "x": 420,
        "y": 520,
        "wires": [
            [
                "dbf524f28cfd16cf"
            ]
        ]
    },
    {
        "id": "dbf524f28cfd16cf",
        "type": "debug",
        "z": "7184d5a8972f1fe0",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 520,
        "wires": []
    },
    {
        "id": "aaf7e06cd66dfdea",
        "type": "websocket out",
        "z": "7184d5a8972f1fe0",
        "name": "",
        "server": "b79df368d7aaac79",
        "client": "",
        "x": 650,
        "y": 580,
        "wires": []
    },
    {
        "id": "58f3d52ede958831",
        "type": "inject",
        "z": "7184d5a8972f1fe0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 450,
        "y": 580,
        "wires": [
            [
                "aaf7e06cd66dfdea"
            ]
        ]
    },
    {
        "id": "da7d2b952a3c8df0",
        "type": "template",
        "z": "7184d5a8972f1fe0",
        "name": "",
        "field": "payload.websocket",
        "fieldType": "msg",
        "format": "javascript",
        "syntax": "mustache",
        "template": "const ws = new WebSocket('ws://127.0.0.1:1880/ws/machine');\nws.onmessage = function (e) {\n    console.log(e);\n}\nws.onopen = function () {\n    console.log('A client connected!');\n    ws.send('A client connected');\n}",
        "output": "str",
        "x": 640,
        "y": 360,
        "wires": [
            [
                "6248cd7fd679aa6e"
            ]
        ]
    },
    {
        "id": "2b5433c167f34753",
        "type": "file in",
        "z": "a6828adb58c9e145",
        "name": "",
        "filename": ".node-red/test.js",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 520,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "1b165353165d655c",
        "type": "debug",
        "z": "a6828adb58c9e145",
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1040,
        "y": 240,
        "wires": []
    },
    {
        "id": "062954a5539c3bb2",
        "type": "inject",
        "z": "a6828adb58c9e145",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 240,
        "wires": [
            [
                "4bf000224b3781e9",
                "ca0f3c96b1cb87eb"
            ]
        ]
    },
    {
        "id": "7dec678a28fa7e37",
        "type": "function",
        "z": "a6828adb58c9e145",
        "name": "function 4",
        "func": "\nvar func = new Function(\"return \" + msg.payload)();\nconst num = func();\nconsole.log( num );\n//fn.x = 10;\nmsg.payload = num;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 180,
        "wires": [
            [
                "1b165353165d655c"
            ]
        ]
    },
    {
        "id": "4bf000224b3781e9",
        "type": "template",
        "z": "a6828adb58c9e145",
        "name": "function without parameters",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "function test()\n{\n    return 5;\n}",
        "output": "str",
        "x": 500,
        "y": 180,
        "wires": [
            [
                "7dec678a28fa7e37"
            ]
        ]
    },
    {
        "id": "ca0f3c96b1cb87eb",
        "type": "template",
        "z": "a6828adb58c9e145",
        "name": "function with parameters",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "function test(a)\n{\n    return a + a;\n}",
        "output": "str",
        "x": 490,
        "y": 320,
        "wires": [
            [
                "5d43e2110c584d64"
            ]
        ]
    },
    {
        "id": "5d43e2110c584d64",
        "type": "function",
        "z": "a6828adb58c9e145",
        "name": "function 5",
        "func": "var func = new Function(\"return \" + msg.payload)();\nconst num = func(3);\nmsg.payload = num;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 320,
        "wires": [
            [
                "1b165353165d655c"
            ]
        ]
    },
    {
        "id": "6232921449696c56",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Ordinary World",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 140,
        "y": 960,
        "wires": [
            [
                "1f343e6bb8519a2a"
            ]
        ],
        "info": "# Ordinary world\n\nWho is the hero? What is world like at the beginning?\n\nthe hero is still in his familiar environment‚Äì Neo is an unsatisfied hacker looking for an answer;"
    },
    {
        "id": "1f343e6bb8519a2a",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Call to Action",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 880,
        "wires": [
            [
                "9e75bf06577706e9"
            ]
        ],
        "info": "# Call to action\n\n... Laks the balance? Who is the Messanger?\n\nsomething happens to change the balance ‚Äì He follows the \"white rabbit\";"
    },
    {
        "id": "9e75bf06577706e9",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Refusal of the Call",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 800,
        "wires": [
            [
                "b2ca9f43bddaa235"
            ]
        ],
        "info": "# Refusal of the call\n\nWhat is he fear? What happens to change his mind?\n\nthe hero is hesitant‚Äì He should climb the roof but he's afraid;"
    },
    {
        "id": "b2ca9f43bddaa235",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Meeting the Mentor",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 740,
        "wires": [
            [
                "31062ff062e78a4c"
            ]
        ],
        "info": "# Meeting the mentor\n\nWho guides the hero? How does the mentor help him?\n\nhe meets a mentor who guides him ‚Äì He sees Morpheus and he's offered the two pills;"
    },
    {
        "id": "31062ff062e78a4c",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Crossing the First Threshold",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 660,
        "wires": [
            [
                "956c40cef8e47e16"
            ]
        ],
        "info": "# Crossing the first threshold\n\n... he lose? What is he hoping to gain?\n\nhe finally decides to enter the new world ‚Äì He chooses the right pill and the real action begins!"
    },
    {
        "id": "956c40cef8e47e16",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Trials",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 600,
        "wires": [
            [
                "9c2190e83394516c"
            ]
        ],
        "info": "# Trials\n\n... he learning? How is he doing in the world?"
    },
    {
        "id": "9c2190e83394516c",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Allies",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 540,
        "wires": [
            [
                "b039c4e842373e09"
            ]
        ],
        "info": "# Allies\n\n.. ey? How do they complete the hero?"
    },
    {
        "id": "b039c4e842373e09",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Enemies",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 480,
        "wires": [
            [
                "4ec78c120bf42a3a"
            ]
        ],
        "info": "# Enemies\n\nWho/What is he fighting? Are the enemies similar to the hero?"
    },
    {
        "id": "4ec78c120bf42a3a",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Fulfillment",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 500,
        "wires": [
            [
                "7ec885efd16abb92"
            ]
        ],
        "info": "# Fulfillment\n\n... completed. Hero ready. What has he learnt/loss?"
    },
    {
        "id": "7ec885efd16abb92",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "To the Inner Cave",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 540,
        "wires": [
            [
                "1617e8e2bb86329c"
            ]
        ],
        "info": "# To the inner cave\n\n... face? How is he getting ready for the ordeal?"
    },
    {
        "id": "1617e8e2bb86329c",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "The Ordeal",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 600,
        "wires": [
            [
                "08ef5b1f843038b6"
            ]
        ],
        "info": "# The Ordeal\n\n... face-off with the enemy. How does it go?"
    },
    {
        "id": "08ef5b1f843038b6",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Reward",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1180,
        "y": 660,
        "wires": [
            [
                "32b82980b91dd3de"
            ]
        ],
        "info": "# Reward\n\nWhat does he gain? How has he changed?"
    },
    {
        "id": "32b82980b91dd3de",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "The Road Back",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 720,
        "wires": [
            [
                "2e2873a7e8944fdb"
            ]
        ],
        "info": "# The Road Back\n\n... What consequences does he have to face?"
    },
    {
        "id": "2e2873a7e8944fdb",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Resurection",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "bb01eee731d3a898"
            ]
        ],
        "info": "# Resurection\n\n... the last trial? How he is purified by that?"
    },
    {
        "id": "bb01eee731d3a898",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Conclusion",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 860,
        "wires": [
            []
        ],
        "info": "# Conclusion\n\n... the consequences of the Journey?"
    },
    {
        "id": "4e4ab2c54b9fa073",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "Prologue",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 1620,
        "wires": [
            [
                "347d2ac42e821b50"
            ]
        ],
        "info": "To tell something before beginning?"
    },
    {
        "id": "347d2ac42e821b50",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "TheSet-Up",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 1540,
        "wires": [
            [
                "eb5b0fd191b9821a"
            ]
        ],
        "info": "...ce the characters and give the preliminary info."
    },
    {
        "id": "eb5b0fd191b9821a",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "The Ctalyst",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 1480,
        "wires": [
            [
                "f529fc5432ae8155"
            ]
        ],
        "info": "...ting incident that makes the plot move on."
    },
    {
        "id": "f529fc5432ae8155",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "The Rising Action",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1420,
        "wires": [
            [
                "ab29fb87ea4c06f9"
            ]
        ],
        "info": "ACT TWO: Introduce changes, enemies, new characters."
    },
    {
        "id": "ab29fb87ea4c06f9",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "The Mid-Point",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 1360,
        "wires": [
            [
                "7ad1a0c99ee13c67"
            ]
        ],
        "info": "... turning point half way through."
    },
    {
        "id": "7ad1a0c99ee13c67",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "The Crisis",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 1300,
        "wires": [
            [
                "2661ded7866de731"
            ]
        ],
        "info": "The \"all is lost\" moment."
    },
    {
        "id": "2661ded7866de731",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "The Climax",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 1380,
        "wires": [
            [
                "7824525e71dd688d"
            ]
        ],
        "info": "... the most exciting moment, the keystone."
    },
    {
        "id": "7824525e71dd688d",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "The Solution",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 1540,
        "wires": [
            [
                "f3182786fe1f2a17"
            ]
        ],
        "info": "ACT THREE: The stakes are higher and the conflicts are solved."
    },
    {
        "id": "f3182786fe1f2a17",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "Epilogue",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1210,
        "y": 1600,
        "wires": [
            []
        ],
        "info": "To tell something after the end."
    },
    {
        "id": "4d3e0d5042a1385f",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "87285eca5226e916",
        "name": "Order of the events",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 1560,
        "wires": [
            []
        ],
        "info": "How do you want to tell your story? In which order?"
    },
    {
        "id": "624534cad709b4a2",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "87285eca5226e916",
        "name": "Conflicts Evolution",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 1560,
        "wires": [
            []
        ],
        "info": "The development of external or internal movements."
    },
    {
        "id": "bc861751a1b19d27",
        "type": "comment",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "",
        "info": " - Which part of the story should I tell at the beginning?\n - Which part of which character is the event that catalyses the whole plot?\n - When do I want the audience to reach its most emotional moment?",
        "x": 210,
        "y": 1360,
        "wires": []
    },
    {
        "id": "32173120e2685e90",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "9b29753bae23ff6b",
        "name": "Hero #1",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 100,
        "y": 1140,
        "wires": [
            []
        ],
        "info": "Write on this row what happens to the main charcter."
    },
    {
        "id": "9e45477dfac653d7",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "9b29753bae23ff6b",
        "name": "Hero #2",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 1140,
        "wires": [
            []
        ],
        "info": "Write on this row what happens to the 2nd main charcter."
    },
    {
        "id": "1e0a9ff4a3ef4b56",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "9b29753bae23ff6b",
        "name": "Narrator",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 1140,
        "wires": [
            []
        ],
        "info": "Does he have his own story? (Or use this card as a 3rd Hero)"
    },
    {
        "id": "3381474b63847bed",
        "type": "comment",
        "z": "35a4f5ffd108afaa",
        "g": "9b29753bae23ff6b",
        "name": "",
        "info": "Although most stories have just one hero, you will have three **CHARACTERS** cards. By placing them on the left of your **HERO‚ÄôS** STEPS cards, you will be able to manage the development of three different characters.",
        "x": 270,
        "y": 1080,
        "wires": []
    },
    {
        "id": "25741aebae9499a1",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Heroes",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 140,
        "wires": [
            [
                "68531779796741a5"
            ]
        ],
        "info": "...m. What are they needs? What are they weaknesses?"
    },
    {
        "id": "68531779796741a5",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Allies",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 140,
        "wires": [
            [
                "3edc5a908bee516c"
            ]
        ],
        "info": "Do the have a side story you need to refer to?"
    },
    {
        "id": "3edc5a908bee516c",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Enemies",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 140,
        "wires": [
            [
                "b4cdc2c98b547f95"
            ]
        ],
        "info": "...? Do the have a side story you need to refer to?"
    },
    {
        "id": "e106990e59bdd880",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "function 6",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 140,
        "wires": [
            [
                "25741aebae9499a1"
            ]
        ],
        "info": "Place the Asset cards wherever you want."
    },
    {
        "id": "b4cdc2c98b547f95",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Narrator",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 130,
        "y": 260,
        "wires": [
            [
                "64bace815e13bcac"
            ]
        ],
        "info": "Who is the Narrator? Does he have his own story?"
    },
    {
        "id": "64bace815e13bcac",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "SubPlot #1",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 260,
        "wires": [
            [
                "958fa39261f90af4"
            ]
        ],
        "info": "Is there a side story you need to refer to?"
    },
    {
        "id": "958fa39261f90af4",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "SubPlot #2",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 260,
        "wires": [
            [
                "6cf696a89b208cd9"
            ]
        ],
        "info": "Is there a side story you need to refer to?"
    },
    {
        "id": "6cf696a89b208cd9",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Concept and Theme",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 260,
        "wires": [
            [
                "f3010bb0dc0867cf"
            ]
        ],
        "info": "What is the general idea of your story?"
    },
    {
        "id": "f3010bb0dc0867cf",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Form",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 100,
        "y": 360,
        "wires": [
            [
                "3e46630bcdad778f"
            ]
        ],
        "info": "Which techniques/styles are you using?"
    },
    {
        "id": "3e46630bcdad778f",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "MoodBoard",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 240,
        "y": 360,
        "wires": [
            [
                "54e631b8713f7276"
            ]
        ],
        "info": "..a some inspirational pictures around this card."
    },
    {
        "id": "54e631b8713f7276",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Space",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 360,
        "wires": [
            [
                "7c4e3bdfb934f2b1"
            ]
        ],
        "info": "...d of the story like? Add drawings, pics, maps!"
    },
    {
        "id": "7c4e3bdfb934f2b1",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "\"Magical\" Objects",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 360,
        "wires": [
            []
        ],
        "info": "... important objects? How do the propel the story?"
    },
    {
        "id": "aa8901bd31893658",
        "type": "comment",
        "z": "35a4f5ffd108afaa",
        "name": "https://www.fabuladeck.com/",
        "info": "[Fabuladec](https://www.fabuladeck.com/)",
        "x": 160,
        "y": 40,
        "wires": []
    },
    {
        "id": "10ecc36acd18b528",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you  know why you need a story?",
        "func": "msg.payload = 'https://thumbs.dreamstime.com/b/knowledge-icon-vector-sign-symbol-isolated-white-backgrou-background-your-web-mobile-app-design-logo-concept-133746781.jpg'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 240,
        "wires": [
            [
                "18ad6b73a137a3e9",
                "17eb20feaa270a42"
            ]
        ]
    },
    {
        "id": "18ad6b73a137a3e9",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you know where to find your story?",
        "func": "msg.payload = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT9iii7x-Nl4Lr2vhKMAIuU_7Ihvufz7IpHkTQHF8JjIDgQ24s7DYixP5U-2U-nbhnbm5U&usqp=CAU'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 300,
        "wires": [
            [
                "6805cc5038232aba",
                "f10ac68bb098d0b6"
            ]
        ]
    },
    {
        "id": "6805cc5038232aba",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you know your role in the story?",
        "func": "msg.payload = 'https://www.shutterstock.com/shutterstock/photos/1468802948/display_1500/stock-vector-superhero-line-icon-hero-symbol-color-superman-mockup-super-dad-template-vector-illustration-1468802948.jpg'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 360,
        "wires": [
            [
                "dc49740613b266c8",
                "04778b9e1033e275"
            ]
        ]
    },
    {
        "id": "dc49740613b266c8",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you know what your story needs to do?",
        "func": "msg.payload = 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Function_machine2.svg/1200px-Function_machine2.svg.png'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 420,
        "wires": [
            [
                "4ecee58dcc75b3dd",
                "6a8667d08c39de68"
            ]
        ]
    },
    {
        "id": "4ecee58dcc75b3dd",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you know how to plan your story?",
        "func": "msg.payload = 'https://www.shutterstock.com/image-vector/hierarchy-icon-isolated-structure-line-260nw-776432704.jpg';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 480,
        "wires": [
            [
                "b7b4cc80c8e04e98",
                "5381079e5ec44a5b"
            ]
        ]
    },
    {
        "id": "b7b4cc80c8e04e98",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you know how to tell your story?",
        "func": "msg.payload = 'https://thumbs.dreamstime.com/b/creative-fashion-style-logo-design-vector-sign-lettering-hanger-symbol-logotype-calligraphy-creative-fashion-style-logo-148836793.jpg'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 540,
        "wires": [
            [
                "6b79b7565b6f052a",
                "8bd57055a53e7f11"
            ]
        ]
    },
    {
        "id": "6b79b7565b6f052a",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you know how to share your story?",
        "func": "msg.payload = 'https://cdn-icons-png.flaticon.com/128/1693/1693056.png';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 600,
        "wires": [
            [
                "34aad3df3238250c",
                "30cccb3dc02a54d3"
            ]
        ]
    },
    {
        "id": "30cccb3dc02a54d3",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Recipe",
        "func": "msg.payload = 'https://cdn-icons-png.flaticon.com/512/2388/2388956.png';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 700,
        "wires": [
            [
                "1a20954030d41d00"
            ]
        ],
        "info": "Stories can change the world. See which problems you can solve by combining different story tactics."
    },
    {
        "id": "f10ac68bb098d0b6",
        "type": "image viewer",
        "z": "1d45200c9172f37f",
        "name": "Explore",
        "width": "60",
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 780,
        "y": 140,
        "wires": [
            []
        ],
        "info": "Stories help us navigate confusing, unknown and changing situations. Make a map for you way ahead."
    },
    {
        "id": "cde43a7535dcf280",
        "type": "inject",
        "z": "1d45200c9172f37f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 100,
        "y": 160,
        "wires": [
            [
                "10ecc36acd18b528"
            ]
        ]
    },
    {
        "id": "17eb20feaa270a42",
        "type": "image viewer",
        "z": "1d45200c9172f37f",
        "name": "Concept",
        "width": "60",
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 680,
        "y": 60,
        "wires": [
            []
        ],
        "info": "Stories shape how we see ourselves and the wold around us. Frame your work as an epic adventure."
    },
    {
        "id": "04778b9e1033e275",
        "type": "image viewer",
        "z": "1d45200c9172f37f",
        "name": "Character",
        "width": "60",
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 860,
        "y": 220,
        "wires": [
            []
        ],
        "info": "Stories connect us to other people. Show us why we can trust you."
    },
    {
        "id": "6a8667d08c39de68",
        "type": "image viewer",
        "z": "1d45200c9172f37f",
        "name": "Function",
        "width": "60",
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 940,
        "y": 300,
        "wires": [
            []
        ],
        "info": "Stories are more effective than facts or opinions by themselves. Put your stories to work."
    },
    {
        "id": "5381079e5ec44a5b",
        "type": "image viewer",
        "z": "1d45200c9172f37f",
        "name": "Structure",
        "width": "60",
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 1020,
        "y": 400,
        "wires": [
            []
        ],
        "info": "Stories carry us along thanks to a fiew basic patterns. Make your ideas flaw in a story-ish way."
    },
    {
        "id": "8bd57055a53e7f11",
        "type": "image viewer",
        "z": "1d45200c9172f37f",
        "name": "Style",
        "width": "60",
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 1090,
        "y": 500,
        "wires": [
            []
        ],
        "info": "Storries carry useful information. Make sure people remember yours."
    },
    {
        "id": "34aad3df3238250c",
        "type": "image viewer",
        "z": "1d45200c9172f37f",
        "name": "Organise",
        "width": "60",
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 1180,
        "y": 580,
        "wires": [
            []
        ],
        "info": "Stories work, so long as you use them well. Plan how you should tell yours."
    },
    {
        "id": "1a20954030d41d00",
        "type": "image viewer",
        "z": "1d45200c9172f37f",
        "name": "Receipe",
        "width": "60",
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 1260,
        "y": 680,
        "wires": [
            []
        ],
        "info": "Stories can change the world. See which problems you can solve by combining different story tactics."
    },
    {
        "id": "2cfca6c0f1e77435",
        "type": "inject",
        "z": "5451c5648a7ae7eb",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 340,
        "y": 320,
        "wires": [
            [
                "d3bab26f8ac33880"
            ]
        ]
    },
    {
        "id": "7a9dcc421561c59b",
        "type": "function",
        "z": "5451c5648a7ae7eb",
        "name": "Thread 1",
        "func": "this.status({ fill: \"green\", shape: \"dot\", text: \"connected\" });\n//node.status({ fill: \"green\", shape: \"ring\", text: \"done\" });\nreturn {\"t1\": \"t1\"};",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 220,
        "wires": [
            [
                "4703b9b1133a8a85"
            ]
        ]
    },
    {
        "id": "9493456b59dc7fd4",
        "type": "function",
        "z": "5451c5648a7ae7eb",
        "name": "Thread 2",
        "func": "node.status({ fill: \"green\", shape: \"ring\", text: \"done\" });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 320,
        "wires": [
            [
                "4703b9b1133a8a85"
            ]
        ]
    },
    {
        "id": "22e1177b811c8e84",
        "type": "function",
        "z": "5451c5648a7ae7eb",
        "name": "Thread 3",
        "func": "function sleep(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nnode.status({ fill: \"red\", shape: \"ring\", text: \"disconnected\" });\nawait sleep(1000);\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"connected\" });\nawait sleep(1000);\n\nnode.status({ text: \"Just text status\" });\nawait sleep(1000);\n//node.status({});   // to clear the status\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 420,
        "wires": [
            [
                "4703b9b1133a8a85"
            ]
        ]
    },
    {
        "id": "7879dc596cf24518",
        "type": "function",
        "z": "5451c5648a7ae7eb",
        "name": "Wait for all Threads",
        "func": "node.status({ fill: \"green\", shape: \"ring\", text: \"done\" });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "a662866adf899949",
        "type": "comment",
        "z": "5451c5648a7ae7eb",
        "name": "https://nodered.org/blog/2019/08/16/going-async",
        "info": "",
        "x": 500,
        "y": 100,
        "wires": []
    },
    {
        "id": "04e996ecc22bfb1b",
        "type": "comment",
        "z": "5451c5648a7ae7eb",
        "name": "https://nodered.org/docs/user-guide/writing-functions",
        "info": "",
        "x": 610,
        "y": 520,
        "wires": []
    },
    {
        "id": "fbce8910d509b1f3",
        "type": "inject",
        "z": "050b98cdec0fb136",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 580,
        "y": 500,
        "wires": [
            [
                "3bac0584b8df8ef3"
            ]
        ]
    },
    {
        "id": "1d2c0e0ad8db2121",
        "type": "function",
        "z": "050b98cdec0fb136",
        "name": "Thread 1",
        "func": "node.status({ fill: \"green\", shape: \"dot\", text: \"connected\" });\nmsg.topic = \"thread1\";\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 400,
        "wires": [
            [
                "f0b48f4542db6b9b"
            ]
        ]
    },
    {
        "id": "4fea8efc486e60b5",
        "type": "function",
        "z": "050b98cdec0fb136",
        "name": "Thread 2",
        "func": "node.status({ fill: \"green\", shape: \"ring\", text: \"done\" });\nmsg.topic = \"thread2\";\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 500,
        "wires": [
            [
                "f0b48f4542db6b9b"
            ]
        ]
    },
    {
        "id": "dbb12a0d022402c1",
        "type": "function",
        "z": "050b98cdec0fb136",
        "name": "Thread 3",
        "func": "function sleep(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nnode.status({ fill: \"red\", shape: \"ring\", text: \"disconnected\" });\nawait sleep(1000);\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"connected\" });\nawait sleep(1000);\n\nnode.status({ text: \"Just text status\" });\nawait sleep(1000);\n\nmsg.topic = \"thread3\";\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 600,
        "wires": [
            [
                "f0b48f4542db6b9b"
            ]
        ]
    },
    {
        "id": "606e8561e6607d49",
        "type": "join",
        "z": "050b98cdec0fb136",
        "name": "Wait for all Threads",
        "mode": "manual",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "useparts": true,
        "count": "3",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1050,
        "y": 500,
        "wires": [
            [
                "27442d39302431a5"
            ]
        ]
    },
    {
        "id": "27442d39302431a5",
        "type": "debug",
        "z": "050b98cdec0fb136",
        "name": "Combined Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1270,
        "y": 500,
        "wires": []
    }
]