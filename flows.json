[
    {
        "id": "a48639831b79bc53",
        "type": "tab",
        "label": "Langchain email workflow",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "5f6eebf04085ab9f",
        "type": "tab",
        "label": "Langchain research-agent",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0885b58486b6cfde",
        "type": "tab",
        "label": "Langchain shallow agent",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "a18fd0a91e07848d",
        "type": "tab",
        "label": "Langchain Tools",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "9ee40a31254c5a6a",
        "type": "tab",
        "label": "LLM todo",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "067e10d1acb5ae55",
        "type": "tab",
        "label": "LLM Research Assistant",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "d9c88a0a246ec309",
        "type": "tab",
        "label": "JTBD",
        "disabled": true,
        "info": "Jobs To Be Done",
        "env": []
    },
    {
        "id": "b70b82bf8d00eb8a",
        "type": "tab",
        "label": "While Ex.",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "f03d232b4fcc4b3e",
        "type": "tab",
        "label": "HttpServer React",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "7184d5a8972f1fe0",
        "type": "tab",
        "label": "websocket",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "a6828adb58c9e145",
        "type": "tab",
        "label": "Function from file example",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "35a4f5ffd108afaa",
        "type": "tab",
        "label": "Herro",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "1d45200c9172f37f",
        "type": "tab",
        "label": "Story Building System",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "5451c5648a7ae7eb",
        "type": "tab",
        "label": "Sycn-Async",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "050b98cdec0fb136",
        "type": "tab",
        "label": "Wait for all Threads",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "debd584ef029526b",
        "type": "tab",
        "label": "Copilot",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "95ea89fbd4e794bd",
        "type": "tab",
        "label": "Test DR",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "5da98edae7a210d0",
        "type": "tab",
        "label": "Interactive console input",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "691e8727dfaad640",
        "type": "tab",
        "label": "Deep Research",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c080735c3b2e661f",
        "type": "group",
        "z": "35a4f5ffd108afaa",
        "name": "HERO'S STEPS CARDS",
        "style": {
            "label": true
        },
        "nodes": [
            "6232921449696c56",
            "1f343e6bb8519a2a",
            "9e75bf06577706e9",
            "b2ca9f43bddaa235",
            "31062ff062e78a4c",
            "956c40cef8e47e16",
            "9c2190e83394516c",
            "b039c4e842373e09",
            "4ec78c120bf42a3a",
            "7ec885efd16abb92",
            "1617e8e2bb86329c",
            "08ef5b1f843038b6",
            "32b82980b91dd3de",
            "2e2873a7e8944fdb",
            "bb01eee731d3a898"
        ],
        "x": 34,
        "y": 439,
        "w": 1412,
        "h": 562
    },
    {
        "id": "00862118b435a1a7",
        "type": "group",
        "z": "35a4f5ffd108afaa",
        "name": "10 READERS'S STEPS CARDS",
        "style": {
            "label": true
        },
        "nodes": [
            "4e4ab2c54b9fa073",
            "347d2ac42e821b50",
            "eb5b0fd191b9821a",
            "f529fc5432ae8155",
            "ab29fb87ea4c06f9",
            "7ad1a0c99ee13c67",
            "2661ded7866de731",
            "7824525e71dd688d",
            "f3182786fe1f2a17",
            "bc861751a1b19d27"
        ],
        "x": 34,
        "y": 1259,
        "w": 1262,
        "h": 402
    },
    {
        "id": "87285eca5226e916",
        "type": "group",
        "z": "35a4f5ffd108afaa",
        "name": "2 LEVEL CARDS",
        "style": {
            "label": true
        },
        "nodes": [
            "4d3e0d5042a1385f",
            "624534cad709b4a2"
        ],
        "x": 454,
        "y": 1519,
        "w": 522,
        "h": 82
    },
    {
        "id": "9b29753bae23ff6b",
        "type": "group",
        "z": "35a4f5ffd108afaa",
        "name": "3 CHARACTER CARDS",
        "style": {
            "label": true
        },
        "nodes": [
            "32173120e2685e90",
            "9e45477dfac653d7",
            "1e0a9ff4a3ef4b56",
            "3381474b63847bed"
        ],
        "x": 14,
        "y": 1039,
        "w": 592,
        "h": 142
    },
    {
        "id": "33fb1e68903c32d8",
        "type": "group",
        "z": "35a4f5ffd108afaa",
        "name": "ASSETS",
        "style": {
            "label": true
        },
        "nodes": [
            "25741aebae9499a1",
            "68531779796741a5",
            "3edc5a908bee516c",
            "e106990e59bdd880",
            "b4cdc2c98b547f95",
            "64bace815e13bcac",
            "958fa39261f90af4",
            "6cf696a89b208cd9",
            "f3010bb0dc0867cf",
            "3e46630bcdad778f",
            "54e631b8713f7276",
            "7c4e3bdfb934f2b1"
        ],
        "x": 24,
        "y": 99,
        "w": 792,
        "h": 302
    },
    {
        "id": "386155bf4cb25dcc",
        "type": "group",
        "z": "9ee40a31254c5a6a",
        "name": "Work on Task",
        "style": {
            "label": true,
            "fill": "#ffbfbf",
            "fill-opacity": "0.2"
        },
        "nodes": [
            "af92c236426f30e1",
            "a03243f9f4ced371",
            "57b404056be20e97",
            "9a53b08aff574db6",
            "d707fbdf4168c6e9",
            "f86d798b98c1f791",
            "26a3990f8c090c8e",
            "d899c9620964f91a",
            "1a50cf2a0b424f29",
            "699dc0641af943f1"
        ],
        "x": 674,
        "y": 139,
        "w": 722,
        "h": 502
    },
    {
        "id": "c6e47ecd49d89909",
        "type": "group",
        "z": "95ea89fbd4e794bd",
        "name": "Clarification Stage",
        "style": {
            "label": true
        },
        "nodes": [
            "bc46f6d8c2d0458d",
            "9907219b25e66484",
            "09160d1ad63d5294",
            "99f39e8b147faa21",
            "050d6463c944477a",
            "f77ece145312e5ce",
            "03da7db91a34ebde",
            "a1e167c0b88c507b",
            "0a6c9f7210e9f4e7"
        ],
        "x": 354,
        "y": 19,
        "w": 1532,
        "h": 182
    },
    {
        "id": "61e9d40ae4ed73c3",
        "type": "group",
        "z": "95ea89fbd4e794bd",
        "name": "Brief Create Stage",
        "style": {
            "label": true
        },
        "nodes": [
            "a0ea78801fc87328",
            "c48b03fc96c92bfc",
            "70ca190b6917284f"
        ],
        "x": 1334,
        "y": 259,
        "w": 252,
        "h": 202
    },
    {
        "id": "e37ab38944e89543",
        "type": "group",
        "z": "691e8727dfaad640",
        "name": "Clarify Stage",
        "style": {
            "label": true
        },
        "nodes": [
            "5b82c838b6f89e97",
            "0b1d9c53be80ec13",
            "1e439042ab46cfda",
            "889ce1eabb89b997",
            "85c344f627c79d37",
            "dd40650fd866a58d",
            "fce0f1d065a8b548",
            "c754e41cbcc1b7b2",
            "9ed4365548e0afac"
        ],
        "x": 434,
        "y": 99,
        "w": 1312,
        "h": 222
    },
    {
        "id": "7d28253b765b8e27",
        "type": "group",
        "z": "691e8727dfaad640",
        "name": "Brief Write Stage",
        "style": {
            "label": true
        },
        "nodes": [
            "51a182e1d7ed9d1d",
            "d018a22df72f545e",
            "352d89f6fa3e5170"
        ],
        "x": 1494,
        "y": 359,
        "w": 252,
        "h": 202
    },
    {
        "id": "d3bab26f8ac33880",
        "type": "junction",
        "z": "5451c5648a7ae7eb",
        "x": 440,
        "y": 320,
        "wires": [
            [
                "7a9dcc421561c59b",
                "9493456b59dc7fd4",
                "22e1177b811c8e84"
            ]
        ]
    },
    {
        "id": "4703b9b1133a8a85",
        "type": "junction",
        "z": "5451c5648a7ae7eb",
        "x": 680,
        "y": 320,
        "wires": [
            [
                "7879dc596cf24518"
            ]
        ]
    },
    {
        "id": "3bac0584b8df8ef3",
        "type": "junction",
        "z": "050b98cdec0fb136",
        "x": 680,
        "y": 500,
        "wires": [
            [
                "1d2c0e0ad8db2121",
                "4fea8efc486e60b5",
                "dbb12a0d022402c1"
            ]
        ]
    },
    {
        "id": "f0b48f4542db6b9b",
        "type": "junction",
        "z": "050b98cdec0fb136",
        "x": 920,
        "y": 500,
        "wires": [
            [
                "606e8561e6607d49"
            ]
        ]
    },
    {
        "id": "b79df368d7aaac79",
        "type": "websocket-listener",
        "path": "/ws/machine",
        "wholemsg": "false"
    },
    {
        "id": "33535f303afacccb",
        "type": "websocket-client",
        "path": "ws://127.0.0.1:1880/ws/machine",
        "tls": "",
        "wholemsg": "false",
        "hb": "0",
        "subprotocol": ""
    },
    {
        "id": "65fccb54d6cf3d7f",
        "type": "websocket-listener",
        "path": "/ws/react",
        "wholemsg": "false"
    },
    {
        "id": "8a9b6c5d4e3f2a10",
        "type": "websocket-listener",
        "path": "/ws/deep-research",
        "wholemsg": "false"
    },
    {
        "id": "054df86263375fbb",
        "type": "inject",
        "z": "a48639831b79bc53",
        "name": "Inject: Car Blown Up",
        "props": [
            {
                "p": "emailContent",
                "v": "My car has blown up!",
                "vt": "str"
            },
            {
                "p": "senderEmail",
                "v": "test@test.com",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "c507538da8d97a30"
            ]
        ]
    },
    {
        "id": "ca5545580823485f",
        "type": "inject",
        "z": "a48639831b79bc53",
        "name": "Inject: Hello",
        "props": [
            {
                "p": "emailContent",
                "v": "Hello! How are you?",
                "vt": "str"
            },
            {
                "p": "senderEmail",
                "v": "test1@test.com",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 240,
        "wires": [
            [
                "c507538da8d97a30"
            ]
        ]
    },
    {
        "id": "c507538da8d97a30",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "read_email",
        "func": "return msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 140,
        "wires": [
            [
                "8cf88a5015b19e40"
            ]
        ]
    },
    {
        "id": "8cf88a5015b19e40",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "classify_intent",
        "func": "const { ChatOllama } = global.get('lcOllama');\nconst { z } = global.get('zod');\nconst { Tavily } = global.get('lcTavily');\n\nconst EmailClassificationSchema = z.object({\n  intent: z.enum(['question', 'bug', 'billing', 'feature', 'complex']),\n  urgency: z.enum(['low', 'medium', 'high', 'critical']),\n  topic: z.string(),\n  summary: z.string(),\n});\n\nconst llm = new ChatOllama({ model: \"llama3.2:3b\", temperature: 0 });\nconst structuredLlm = llm.withStructuredOutput(EmailClassificationSchema);\n\n(async () => {\n    try {\n        const state = {\n            emailContent: msg.emailContent || \"\",\n            senderEmail: msg.senderEmail || \"unknown@test.com\"\n        };\n\n        const classificationPrompt = `\n        Analyze this customer email and classify it:\n        \n        Email: ${state.emailContent}\n        From: ${state.senderEmail}\n        Provide classification, including intent, urgency, topic, and summary.\n        `;\n\n        const classification = await structuredLlm.invoke(classificationPrompt);\n\n        msg.state = {\n            ...state,\n            classification\n        };\n        \n        node.send([msg, msg]);\n    } catch (e) {\n        node.error(e);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 220,
        "wires": [
            [
                "21398b7313621f89",
                "cfc24a0584b11bd2"
            ]
        ]
    },
    {
        "id": "21398b7313621f89",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "bug_tracking",
        "func": "msg.topic = \"ticket_state\";\nconst ticketId = `BUG_${Math.random().toString(36).substr(2, 9).toUpperCase()}`;\nmsg.payload = { ticketId: ticketId };\nreturn msg;",
        "outputs": 1,
        "x": 650,
        "y": 160,
        "wires": [
            [
                "d7c5f88515f704cb"
            ]
        ]
    },
    {
        "id": "cfc24a0584b11bd2",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "search_documentation",
        "func": "msg.topic = \"search_state\";\nconst classification = msg.state.classification;\n\nmsg.payload = {\n    searchResults: [\n      `Documentation on ${classification.topic}`,\n      `Standard procedure for ${classification.intent} requests`\n    ]\n};\nreturn msg;",
        "outputs": 1,
        "x": 680,
        "y": 280,
        "wires": [
            [
                "d7c5f88515f704cb"
            ]
        ]
    },
    {
        "id": "d7c5f88515f704cb",
        "type": "join",
        "z": "a48639831b79bc53",
        "name": "Join State",
        "mode": "manual",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "count": "2",
        "x": 900,
        "y": 220,
        "wires": [
            [
                "992806acddcfb95d"
            ]
        ]
    },
    {
        "id": "992806acddcfb95d",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "write_response",
        "func": "const { ChatOllama } = global.get('lcOllama');\nconst llm = new ChatOllama({ model: \"llama3.2:3b\", temperature: 0.7 });\n\n(async () => {\n    const state = msg.state;\n    const classification = state.classification;\n    const contextSections = msg.payload.search_state.searchResults;\n    const ticketInfo = msg.payload.ticket_state.ticketId;\n    \n    const draftPrompt = `\n    Draft a response to this customer email:\n    ${state.emailContent}\n    \n    Email intent: ${classification.intent}\n    Urgency level: ${classification.urgency}\n    \n    ${contextSections.join('\\n\\n')}\n    \n    Guidelines:\n    - Be professional and helpful\\\n    - Address their specific concern\n    - Use the provided documentation when relevant\n    - Be brief\n    `;\n\n    try {\n        const response = await llm.invoke(draftPrompt);\n        const needsReview = ['high', 'critical'].includes(classification.urgency) || classification.intent === 'complex';\n        \n        msg.payload = {\n            draftResponse: response.content,\n            target: needsReview ? \"human_review\" : \"send_reply\"\n        };\n        \n        node.send(msg);\n    } catch (e) {\n        node.error(e);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 300,
        "wires": [
            [
                "615f61abecd0d81d"
            ]
        ]
    },
    {
        "id": "615f61abecd0d81d",
        "type": "switch",
        "z": "a48639831b79bc53",
        "name": "Review Switch",
        "property": "payload.target",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "human_review",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "send_reply",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1060,
        "y": 380,
        "wires": [
            [
                "09449c27557bff4d"
            ],
            [
                "a08f172bf3358ffd"
            ]
        ]
    },
    {
        "id": "09449c27557bff4d",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "human_review",
        "func": "const approved = Math.random() > 0.2 ? \"approved\" : \"not_approved\";\nmsg.payload.humanDecision = approved;\n\nif (approved === \"approved\") {\n    node.status({fill:\"green\", shape:\"dot\", text:\"Mock: Approved\"});\n} else {\n    node.status({fill:\"red\", shape:\"ring\", text:\"Mock: Rejected\"});\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 400,
        "wires": [
            [
                "09162c4a84b4aacc"
            ]
        ]
    },
    {
        "id": "09162c4a84b4aacc",
        "type": "switch",
        "z": "a48639831b79bc53",
        "name": "Decision Switch",
        "property": "payload.humanDecision",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "not_approved",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "approved",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1500,
        "y": 460,
        "wires": [
            [
                "162c744e98edacd8"
            ],
            [
                "a08f172bf3358ffd"
            ]
        ]
    },
    {
        "id": "a08f172bf3358ffd",
        "type": "function",
        "z": "a48639831b79bc53",
        "name": "send_reply",
        "func": "const preview = (msg.payload.draftResponse || \"\").substring(0, 60) + \"...\";\nnode.warn(\"Sending Email Reply: \" + preview);\nreturn msg;",
        "outputs": 1,
        "x": 1730,
        "y": 660,
        "wires": [
            [
                "162c744e98edacd8"
            ]
        ]
    },
    {
        "id": "162c744e98edacd8",
        "type": "debug",
        "z": "a48639831b79bc53",
        "name": "Final Draft",
        "active": true,
        "complete": "payload",
        "x": 1910,
        "y": 440,
        "wires": []
    },
    {
        "id": "research-agent-trigger",
        "type": "inject",
        "z": "5f6eebf04085ab9f",
        "name": "Start Research",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "What is artificial intelligence?",
        "payloadType": "str",
        "x": 120,
        "y": 140,
        "wires": [
            [
                "create-todo-json"
            ]
        ]
    },
    {
        "id": "create-todo-json",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Create todo.json",
        "func": "// Store the original payload for later use\nmsg.originalPayload = msg.payload;\n\n// Create initial todo.json structure based on the research query\nconst researchQuery = msg.payload;\n\n// Create initial tasks based on the research workflow\nconst initialTasks = {\n    tasks: [\n        {\n            id: 1,\n            title: \"Research initial question\",\n            description: `Start researching the initial question: ${researchQuery}`,\n            details: \"Initialize the research process and set up the initial state\",\n            testStrategy: \"Verify that the research process has started correctly\",\n            priority: \"high\",\n            dependencies: [],\n            status: \"pending\",\n            subtasks: [],\n            updatedAt: new Date().toISOString()\n        },\n        {\n            id: 2,\n            title: \"Search for relevant information\",\n            description: `Perform web searches to gather relevant information on: ${researchQuery}`,\n            details: \"Use search tools to gather relevant information on the topic\",\n            testStrategy: \"Verify that search results are being collected\",\n            priority: \"high\",\n            dependencies: [1],\n            status: \"pending\",\n            subtasks: [],\n            updatedAt: new Date().toISOString()\n        },\n        {\n            id: 3,\n            title: \"Analyze search results\",\n            description: \"Analyze the search results and extract key information\",\n            details: \"Process and analyze the collected search results\",\n            testStrategy: \"Verify that key information is extracted from search results\",\n            priority: \"medium\",\n            dependencies: [2],\n            status: \"pending\",\n            subtasks: [],\n            updatedAt: new Date().toISOString()\n        },\n        {\n            id: 4,\n            title: \"Create initial report draft\",\n            description: \"Create an initial draft of the research report\",\n            details: \"Compile the gathered information into a draft report\",\n            testStrategy: \"Verify that the draft report contains all gathered information\",\n            priority: \"medium\",\n            dependencies: [3],\n            status: \"pending\",\n            subtasks: [],\n            updatedAt: new Date().toISOString()\n        },\n        {\n            id: 5,\n            title: \"Review and refine report\",\n            description: \"Review the draft report and refine it based on additional research\",\n            details: \"Review the draft and make necessary improvements\",\n            testStrategy: \"Verify that the report is comprehensive and well-structured\",\n            priority: \"low\",\n            dependencies: [4],\n            status: \"pending\",\n            subtasks: [],\n            updatedAt: new Date().toISOString()\n        },\n        {\n            id: 6,\n            title: \"Finalize research report\",\n            description: \"Finalize the research report and save it to file\",\n            details: \"Complete the report and save it to final_report.md\",\n            testStrategy: \"Verify that the final report is saved correctly\",\n            priority: \"high\",\n            dependencies: [5],\n            status: \"pending\",\n            subtasks: [],\n            updatedAt: new Date().toISOString()\n        }\n    ]\n};\n\nmsg.payload = JSON.stringify(initialTasks, null, 2);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 150,
        "y": 200,
        "wires": [
            [
                "save-initial-todo-json"
            ]
        ]
    },
    {
        "id": "save-initial-todo-json",
        "type": "file",
        "z": "5f6eebf04085ab9f",
        "name": "Save todo.json",
        "filename": "todo.json",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 160,
        "y": 260,
        "wires": [
            [
                "load-tasks"
            ]
        ]
    },
    {
        "id": "load-tasks",
        "type": "file in",
        "z": "5f6eebf04085ab9f",
        "name": "Load Tasks from todo.json",
        "filename": "todo.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 160,
        "y": 320,
        "wires": [
            [
                "initialize-state-with-tasks"
            ]
        ]
    },
    {
        "id": "initialize-state-with-tasks",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Initialize State with Tasks",
        "func": "// Parse the tasks from todo.json\nlet tasks = [];\ntry {\n    tasks = JSON.parse(msg.payload).tasks || [];\n} catch (e) {\n    console.error('Error parsing tasks:', e);\n    tasks = [];\n}\n\n// Get the original payload that was stored\nconst originalPayload = msg.originalPayload || \"Research query\";\n\n// Initialize the state similar to createInitialState() in JS\nmsg.state = {\n    messages: [{\n        type: \"human\",\n        content: originalPayload,\n        timestamp: new Date().toISOString()\n    }],\n    todos: tasks, // Use tasks from todo.json\n    files: {},\n    searchHistory: [],\n    iteration: 0,\n    maxIterations: 10\n};\n\n// Add the original question to files\nmsg.state.files[\"question.txt\"] = {\n    content: originalPayload,\n    createdAt: new Date().toISOString(),\n    modifiedAt: new Date().toISOString()\n};\n\n// Prepare question.txt for file output\nmsg.payload = originalPayload;\n\n// Update the first task to in_progress\nif (msg.state.todos.length > 0) {\n    msg.state.todos[0].status = \"in_progress\";\n    msg.state.todos[0].updatedAt = new Date().toISOString();\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 380,
        "wires": [
            [
                "question-file-out",
                "build-prompt-and-select-tool"
            ]
        ]
    },
    {
        "id": "question-file-out",
        "type": "file",
        "z": "5f6eebf04085ab9f",
        "name": "Save question.txt",
        "filename": "question.txt",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 470,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "build-prompt-and-select-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Build Prompt & Select Tool",
        "func": "// Build prompt similar to buildPrompt() in JS\nconst state = msg.state;\n\nconst messages = state.messages.map(m =>\n    `${m.type}: ${m.content}`\n).join(\"\\n\");\n\nconst todos = state.todos.map(t =>\n    `- ${t.content} (${t.status})`\n).join(\"\\n\");\n\nconst availableFiles = Object.keys(state.files).join(\", \");\n\nmsg.payload = `You are an expert researcher. Your job is to conduct thorough research, and then write a polished report.\n\nThe first thing you should do is to write the original user question to \\`question.txt\\` so you have a record of it.\n\nUse the research-agent to conduct deep research. It will respond to your questions/topics with a detailed answer.\n\nWhen you think you enough information to write a final report, write it to \\`final_report.md\\`\n\nYou can call the critique-agent to get a critique of the final report. After that (if needed) you can do more research and edit the \\`final_report.md\\`\nYou can do this however many times you want until are you satisfied with the result.\n\nOnly edit the file once at a time (if you call this tool in parallel, there may be conflicts).\n\nHere are instructions for writing the final report:\n\n<report_instructions>\n\nCRITICAL: Make sure the answer is written in the same language as the human messages! If you make a todo plan - you should note in the plan what language the report should be in so you dont forget!\nNote: the language the report should be in is the language the QUESTION is in, not the language/country that the question is ABOUT.\n\nPlease create a detailed answer to the overall research brief that:\n1. Is well-organized with proper headings (# for title, ## for sections, ### for subsections)\n2. Includes specific facts and insights from the research\n3. References relevant sources using [Title](URL) format\n4. Provides a balanced, thorough analysis. Be as comprehensive as possible, and include all information that is relevant to the overall research question. People are using you for deep research and will expect detailed answers.\n5. Includes a \"Sources\" section at the end with all referenced links\n\nYou can structure your report in a number of different ways. Here are some examples:\n\nTo answer a question that asks you to compare two things, you might structure your report like this:\n1/ intro\n2/ overview of topic A\n3/ overview of topic B\n4/ comparison between A and B\n5/ conclusion\n\nTo answer a question that asks you to return a list of things, you might only need a single section which is the entire list.\n1/ list of things or table of things\nOr, you could choose to make each item in the list a separate section in the report. When asked for lists, you don't need an introduction or conclusion.\n1/ item 1\n2/ item 2\n3/ item 3\n\nTo answer a question that asks you to summarize a topic, give a report, or give an overview, you might structure your report like this:\n1/ overview of topic\n2/ concept 1\n3/ concept 2\n4/ concept 3\n5/ conclusion\n\nIf you think you can answer the question with a single section, you can do that too!\n1/ answer\n\nREMEMBER: Section is a VERY fluid and loose concept. You can structure your report however you think is best, including in ways that are not listed above!\nMake sure that your sections are cohesive, and make sense for the reader.\n\nFor each section of the report, do the following:\n- Use simple, clear language\n- Use ## for section title (Markdown format) for each section of the report\n- Do NOT ever refer to yourself as the writer of the report. This should be a professional report without any self-referential language.\n- Do not say what you are doing in the report. Just write the report without any commentary from yourself.\n- Each section should be as long as necessary to deeply answer the question with the information you have gathered. It is expected that sections will be fairly long and verbose. You are writing a deep research report, and users will expect a thorough answer.\n- Use bullet points to list out information when appropriate, but by default, write in paragraph form.\n\nREMEMBER:\nThe brief and research may be in English, but you need to translate this information to the right language when writing the final answer.\nMake sure the final answer report is in the SAME language as the human messages in the message history.\n\nFormat the report in clear markdown with proper structure and include source references where appropriate.\n\n<Citation Rules>\n- Assign each unique URL a single citation number in your text\n- End with ### Sources that lists each source with corresponding numbers\n- IMPORTANT: Number sources sequentially without gaps (1,2,3,4...) in the final list regardless of which sources you choose\n- Each source should be a separate line item in a list, so that in markdown it is rendered as a list.\n- Example format:\n  [1] Source Title: URL\n  [2] Source Title: URL\n- Citations are extremely important. Make sure to include these, and pay a lot of attention to getting these right. Users will often use these citations to look into more information.\n</Citation Rules>\n\nYou have access to a few tools.\n\n## \\`internet_search\\`\n\nUse this to run an internet search for a given query. You can specify the number of results, the topic, and whether raw content should be included.\n\nCurrent conversation:\n${messages}\n\nCurrent todos:\n${todos || \"No todos yet\"}\n\nAvailable files: ${availableFiles || \"No files yet\"}\n\nBased on the user's research request, choose the most appropriate tool to advance the research.\nThe user wants to research: ${state.messages[0]?.content || 'unknown topic'}\n\nSelect a tool and provide the necessary parameters.`;\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 240,
        "y": 560,
        "wires": [
            [
                "llm-tool-selector"
            ]
        ]
    },
    {
        "id": "llm-tool-selector",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "LLM Tool Selector",
        "func": "// Simulate LLM tool selection with structured output\n// In a real implementation, this would use an LLM with structured output\n\n// For now, we'll simulate the tool selection based on the prompt\nconst prompt = msg.payload;\nconst state = msg.state;\n\n// Simple logic to determine which tool to use based on the prompt\nlet tool = \"search_web\"; // Default\nlet parameters = {};\nlet reasoning = \"Default tool selection\";\n\n// If we have enough search results and need to write a report\nif (state.searchHistory.length > 2 && state.todos.some(t => t.status === \"completed\")) {\n    tool = \"write_file\";\n    parameters = { filePath: \"final_report.md\", content: \"\" };\n    reasoning = \"Creating final report based on research\";\n} else if (prompt.toLowerCase().includes(\"search\") || prompt.toLowerCase().includes(\"research\")) {\n    // Extract query from prompt\n    const queryMatch = prompt.match(/research:\\s*(.+)/i);\n    const query = queryMatch ? queryMatch[1] : state.messages[0]?.content || \"general research\";\n    \n    tool = \"search_web\";\n    parameters = { query: query };\n    reasoning = \"Searching the web for research information\";\n} else if (prompt.toLowerCase().includes(\"todo\")) {\n    tool = \"create_todo\";\n    parameters = { content: \"Research task\" };\n    reasoning = \"Creating a research todo\";\n} else {\n    tool = \"search_web\";\n    parameters = { query: state.messages[0]?.content || \"general research\" };\n    reasoning = \"Default search for research information\";\n}\n\nmsg.toolAction = {\n    tool: tool,\n    reasoning: reasoning,\n    parameters: parameters\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 440,
        "wires": [
            [
                "tool-router"
            ]
        ]
    },
    {
        "id": "tool-router",
        "type": "switch",
        "z": "5f6eebf04085ab9f",
        "name": "Route to Tool",
        "property": "toolAction.tool",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "search_web",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "write_file",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "read_file",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "edit_file",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "create_todo",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "update_todo",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "research_topic",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 8,
        "x": 550,
        "y": 320,
        "wires": [
            [
                "search-web-tool"
            ],
            [
                "write-file-tool"
            ],
            [
                "read-file-tool"
            ],
            [
                "edit-file-tool"
            ],
            [
                "create-todo-tool"
            ],
            [
                "update-todo-tool"
            ],
            [
                "research-topic-tool"
            ],
            [
                "default-tool-handler"
            ]
        ]
    },
    {
        "id": "search-web-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Search Web Tool",
        "func": "const { TavilySearch } = global.get('lcTavily');\nconst TAVILY_API_KEY = global.get('TAVILY_API_KEY');\n\n// Create search tool instance\nconst searchTool = new TavilySearch({\n    maxResults: 5,\n    tavilyApiKey: TAVILY_API_KEY,\n    includeRawContent: false,\n    topic: \"general\"\n});\n\nnode.status({fill:\"yellow\", shape:\"dot\", text:\"üîç Searching...\"});\n\n(async () => {\n    try {\n        const query = msg.toolAction.parameters.query || msg.state.messages[0]?.content || \"general research\";\n        \n        // Perform the search\n        const results = await searchTool.invoke({ query: query });\n        \n        // Update state with search results\n        msg.state.searchHistory = msg.state.searchHistory || [];\n        msg.state.searchHistory.push({\n            query: query,\n            results: results,\n            timestamp: new Date().toISOString()\n        });\n        \n        // Add result to messages\n        msg.state.messages.push({\n            type: \"ai\",\n            content: `Search results for '${query}': ${JSON.stringify(results, null, 2)}`,\n            timestamp: new Date().toISOString()\n        });\n        \n        msg.payload = results;\n        \n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Search complete\"});\n        node.send(msg);\n    } catch (error) {\n        msg.payload = { error: `Search failed: ${error.message}` };\n        \n        // Add error to messages\n        msg.state.messages.push({\n            type: \"ai\",\n            content: `Search error: ${error.message}`,\n            timestamp: new Date().toISOString()\n        });\n        \n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Search failed\"});\n        node.error(error);\n        node.send(msg);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 60,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "write-file-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Write File Tool",
        "func": "node.status({fill:\"blue\", shape:\"dot\", text:\"üìù Writing file...\"});\n\ntry {\n    const { filePath, content } = msg.toolAction.parameters;\n    \n    // Update state\n    msg.state.files[filePath] = {\n        content: content,\n        createdAt: msg.state.files[filePath]?.createdAt || new Date().toISOString(),\n        modifiedAt: new Date().toISOString()\n    };\n    \n    // Special handling for todo.json and task.json\n    if (filePath === 'todo.json' || filePath === 'task.json') {\n        try {\n            const parsedContent = JSON.parse(content);\n            if (parsedContent.tasks) {\n                msg.state.todos = parsedContent.tasks;\n            } else {\n                msg.state.todos = parsedContent;\n            }\n        } catch (parseError) {\n            console.error('Failed to parse todo/task file:', parseError);\n        }\n    }\n    \n    // Add result to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Successfully wrote to file: ${filePath}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    msg.payload = { success: true, path: filePath };\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ File written\"});\n    \n    return msg;\n} catch (error) {\n    msg.payload = { error: `Write file failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Write file error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Write failed\"});\n    node.error(error);\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 140,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "read-file-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Read File Tool",
        "func": "node.status({fill:\"blue\", shape:\"dot\", text:\"üìñ Reading file...\"});\n\ntry {\n    const { filePath } = msg.toolAction.parameters;\n    \n    let content;\n    let error;\n    \n    // Try to get from state first\n    if (msg.state.files[filePath]) {\n        content = msg.state.files[filePath].content;\n    } else {\n        error = `File ${filePath} not found in memory`;\n    }\n    \n    if (error) {\n        msg.payload = { error: error };\n        \n        // Add error to messages\n        msg.state.messages.push({\n            type: \"ai\",\n            content: `Read file error: ${error}`,\n            timestamp: new Date().toISOString()\n        });\n        \n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Read failed\"});\n    } else {\n        msg.payload = { content: content };\n        \n        // Add result to messages\n        msg.state.messages.push({\n            type: \"ai\",\n            content: `File content: ${content.substring(0, 200)}...`,\n            timestamp: new Date().toISOString()\n        });\n        \n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ File read\"});\n    }\n    \n    return msg;\n} catch (error) {\n    msg.payload = { error: `Read file failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Read file error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Read failed\"});\n    node.error(error);\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 220,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "edit-file-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Edit File Tool",
        "func": "node.status({fill:\"blue\", shape:\"dot\", text:\"‚úèÔ∏è Editing file...\"});\n\ntry {\n    const { filePath, oldContent, newContent } = msg.toolAction.parameters;\n    \n    // Get current file content\n    let currentContent;\n    if (msg.state.files[filePath]) {\n        currentContent = msg.state.files[filePath].content;\n    } else {\n        msg.payload = { error: `File ${filePath} not found` };\n        \n        // Add error to messages\n        msg.state.messages.push({\n            type: \"ai\",\n            content: `Edit file error: File ${filePath} not found`,\n            timestamp: new Date().toISOString()\n        });\n        \n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå File not found\"});\n        return msg;\n    }\n    \n    // Replace old content with new content\n    const updatedContent = currentContent.replace(oldContent, newContent);\n    \n    // Update state\n    msg.state.files[filePath] = {\n        content: updatedContent,\n        createdAt: msg.state.files[filePath].createdAt,\n        modifiedAt: new Date().toISOString()\n    };\n    \n    // Add result to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Successfully edited file: ${filePath}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    msg.payload = { success: true, path: filePath };\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ File edited\"});\n    \n    return msg;\n} catch (error) {\n    msg.payload = { error: `Edit file failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Edit file error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Edit failed\"});\n    node.error(error);\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 300,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "create-todo-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Create Todo Tool",
        "func": "node.status({fill:\"orange\", shape:\"dot\", text:\"üìã Creating todo...\"});\n\ntry {\n    const { content, status = \"pending\" } = msg.toolAction.parameters;\n    \n    const todo = {\n        id: Date.now(),\n        title: content,\n        description: content,\n        details: content,\n        testStrategy: \"Default test strategy\",\n        priority: \"medium\",\n        dependencies: [],\n        status: status,\n        subtasks: [],\n        updatedAt: new Date().toISOString()\n    };\n    \n    // Add to state\n    msg.state.todos.push(todo);\n    \n    // Add result to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Created todo: ${content}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    // Save updated tasks to task.json file\n    const tasksData = { tasks: msg.state.todos };\n    msg.payload = JSON.stringify(tasksData, null, 2);\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Todo created\"});\n    \n    // Send to file output node to save to task.json\n    return [null, msg];\n} catch (error) {\n    msg.payload = { error: `Create todo failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Create todo error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Create failed\"});\n    node.error(error);\n    return [msg, null];\n}",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 380,
        "wires": [
            [
                "check-continue-condition"
            ],
            [
                "a664f7f616f8a853"
            ]
        ]
    },
    {
        "id": "update-todo-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Update Todo Tool",
        "func": "node.status({fill:\"orange\", shape:\"dot\", text:\"üìã Updating todo...\"});\n\ntry {\n    const { id, status } = msg.toolAction.parameters;\n    \n    // Find and update the todo\n    const todoIndex = msg.state.todos.findIndex(t => t.id === id);\n    \n    if (todoIndex === -1) {\n        msg.payload = { error: `Todo with id ${id} not found` };\n        \n        // Add error to messages\n        msg.state.messages.push({\n            type: \"ai\",\n            content: `Update todo error: Todo with id ${id} not found`,\n            timestamp: new Date().toISOString()\n        });\n        \n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Todo not found\"});\n        return [msg, null];\n    }\n    \n    // Update the todo\n    msg.state.todos[todoIndex].status = status;\n    msg.state.todos[todoIndex].updatedAt = new Date().toISOString();\n    \n    const updatedTodo = msg.state.todos[todoIndex];\n    \n    // Add result to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Updated todo: ${updatedTodo.title || updatedTodo.content} to status: ${status}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    // Save updated tasks to task.json file\n    const tasksData = { tasks: msg.state.todos };\n    msg.payload = JSON.stringify(tasksData, null, 2);\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Todo updated\"});\n    \n    // Send to file output node to save to task.json\n    return [null, msg];\n} catch (error) {\n    msg.payload = { error: `Update todo failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Update todo error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Update failed\"});\n    node.error(error);\n    return [msg, null];\n}",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 460,
        "wires": [
            [
                "check-continue-condition"
            ],
            [
                "a664f7f616f8a853"
            ]
        ]
    },
    {
        "id": "research-topic-tool",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Research Topic Tool",
        "func": "node.status({fill:\"purple\", shape:\"dot\", text:\"üî¨ Researching topic...\"});\n\ntry {\n    const { topic, depth = \"general\" } = msg.toolAction.parameters;\n    \n    // For now, just do a search on the topic\n    // In a full implementation, this might involve more complex research\n    \n    msg.toolAction = {\n        tool: \"search_web\",\n        reasoning: `Researching topic: ${topic}`,\n        parameters: { query: topic }\n    };\n    \n    // Add result to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Starting research on topic: ${topic}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    msg.payload = `Beginning research on: ${topic}`;\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Research started\"});\n    \n    // Route back to search tool\n    return msg;\n} catch (error) {\n    msg.payload = { error: `Research topic failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Research topic error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Research failed\"});\n    node.error(error);\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 540,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "default-tool-handler",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Default Tool Handler",
        "func": "node.status({fill:\"gray\", shape:\"dot\", text:\"‚ùì Unknown tool\"});\n\nmsg.payload = { error: `Unknown tool: ${msg.toolAction.tool}` };\n\n// Add error to messages\nmsg.state.messages.push({\n    type: \"ai\",\n    content: `Unknown tool error: ${msg.toolAction.tool}`,\n    timestamp: new Date().toISOString()\n});\n\nnode.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Unknown tool\"});\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 620,
        "wires": [
            [
                "check-continue-condition"
            ]
        ]
    },
    {
        "id": "check-continue-condition",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Check Continue Condition",
        "func": "node.status({fill:\"blue\", shape:\"dot\", text:\"üîÑ Checking continuation...\"});\n\n// Increment iteration counter\nmsg.state.iteration = (msg.state.iteration || 0) + 1;\n\n// Check if we should continue or stop\nconst shouldContinue = msg.state.iteration < msg.state.maxIterations;\n\n// Check if we have enough information to create a final report\nconst completedTodos = msg.state.todos.filter(t => t.status === \"completed\").length;\nconst hasSearchResults = msg.state.searchHistory.length > 0;\nconst hasQuestionFile = !!msg.state.files[\"question.txt\"];\n\nconst shouldCreateReport = (completedTodos > 0 && hasSearchResults && hasQuestionFile) || \n                          (msg.state.searchHistory.length > 2); // If we have substantial search results\n\nmsg.shouldContinue = shouldContinue && !shouldCreateReport;\nmsg.shouldCreateReport = shouldCreateReport;\n\nif (shouldCreateReport) {\n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Ready to create report\"});\n} else if (!shouldContinue) {\n    node.status({fill:\"yellow\", shape:\"dot\", text:\"‚èπÔ∏è Max iterations reached\"});\n} else {\n    node.status({fill:\"blue\", shape:\"dot\", text:\"üîÑ Continuing iteration\"});\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 300,
        "wires": [
            [
                "continue-decision"
            ]
        ]
    },
    {
        "id": "continue-decision",
        "type": "switch",
        "z": "5f6eebf04085ab9f",
        "name": "Continue Decision",
        "property": "shouldCreateReport",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1290,
        "y": 380,
        "wires": [
            [
                "generate-final-report"
            ],
            [
                "continue-loop-check"
            ]
        ]
    },
    {
        "id": "continue-loop-check",
        "type": "switch",
        "z": "5f6eebf04085ab9f",
        "name": "Continue Loop?",
        "property": "shouldContinue",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1380,
        "y": 460,
        "wires": [
            [
                "77988e4ab192c193"
            ],
            [
                "959777cf9e31b547"
            ]
        ]
    },
    {
        "id": "generate-final-report",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Generate Final Report",
        "func": "node.status({fill:\"green\", shape:\"dot\", text:\"üìù Generating report...\"});\n\ntry {\n    const state = msg.state;\n    \n    // Get the original question\n    let question = \"Unknown question\";\n    if (state.files[\"question.txt\"]) {\n        question = state.files[\"question.txt\"].content;\n    }\n    \n    let report = `# Research Report\\n\\n`;\n    report += `## Question\\n${question}\\n\\n`;\n    report += `## Sources and Findings\\n`;\n    \n    if (state.searchHistory.length === 0) {\n        report += `No search results were obtained during the research process.\\n\\n`;\n    } else {\n        // Process search results and format with citations\n        let sourceCounter = 1;\n        const sources = [];\n        \n        for (const search of state.searchHistory) {\n            report += `### Search Query: ${search.query}\\n`;\n            \n            if (search.results && !search.results.error) {\n                if (Array.isArray(search.results.results)) {\n                    for (const result of search.results.results) {\n                        // Add to sources list\n                        sources.push({ id: sourceCounter, title: result.title, url: result.url });\n                        \n                        // Add citation in the text\n                        report += `- [${result.title}][${sourceCounter}]\\n`;\n                        if (result.content) {\n                            report += `  - ${result.content.substring(0, 200)}...\\n\\n`;\n                        }\n                        \n                        sourceCounter++;\n                    }\n                } else {\n                    // Handle case where results are in a different format\n                    report += `Results: ${JSON.stringify(search.results, null, 2)}\\n\\n`;\n                }\n            } else {\n                // Handle error case\n                report += `Search error: ${search.results?.error || 'Unknown error'}\\n\\n`;\n            }\n        }\n        \n        // Add sources section at the end\n        if (sources.length > 0) {\n            report += `\\n### Sources\\n`;\n            for (const source of sources) {\n                report += `[${source.id}] ${source.title}: ${source.url}\\n`;\n            }\n        }\n    }\n    \n    report += `\\n## Summary\\n`;\n    if (state.searchHistory.length > 0) {\n        report += `Based on the research conducted, here are the key findings...\\n`;\n    } else {\n        report += `The research process did not yield any results, possibly due to API issues or connectivity problems.\\n`;\n    }\n    \n    // Add report to state\n    state.files[\"final_report.md\"] = {\n        content: report,\n        createdAt: new Date().toISOString(),\n        modifiedAt: new Date().toISOString()\n    };\n    \n    // Update relevant tasks to completed\n    for (let todo of state.todos) {\n        if (todo.title && (todo.title.includes(\"Research\") || \n                          todo.title.includes(\"Search\") || \n                          todo.title.includes(\"Analyze\") || \n                          todo.title.includes(\"Create initial report\") || \n                          todo.title.includes(\"Review and refine\"))) {\n            todo.status = \"completed\";\n            todo.updatedAt = new Date().toISOString();\n        }\n    }\n    \n    // Add result to messages\n    state.messages.push({\n        type: \"ai\",\n        content: `Final report generated with ${state.searchHistory.length} search results`,\n        timestamp: new Date().toISOString()\n    });\n    \n    msg.payload = report;\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Report generated\"});\n    \n    return msg;\n} catch (error) {\n    msg.payload = { error: `Report generation failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Report generation error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Report gen failed\"});\n    node.error(error);\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1520,
        "y": 320,
        "wires": [
            [
                "write-final-report"
            ]
        ]
    },
    {
        "id": "write-final-report",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Write Final Report",
        "func": "node.status({fill:\"blue\", shape:\"dot\", text:\"üíæ Writing final report...\"});\n\ntry {\n    const reportContent = msg.payload.content || msg.payload;\n    const filePath = \"final_report.md\";\n    \n    // Update state\n    msg.state.files[filePath] = {\n        content: reportContent,\n        createdAt: msg.state.files[filePath]?.createdAt || new Date().toISOString(),\n        modifiedAt: new Date().toISOString()\n    };\n    \n    // Add result to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Final report written to ${filePath}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    // Update the final task to completed\n    if (msg.state.todos.length > 0) {\n        const finalTask = msg.state.todos.find(t => t.title && t.title.includes(\"Finalize research report\"));\n        if (finalTask) {\n            finalTask.status = \"completed\";\n            finalTask.updatedAt = new Date().toISOString();\n        }\n    }\n    \n    // Create message for saving the report file\n    const reportMsg = { payload: reportContent, state: msg.state };\n    \n    // Create message for saving tasks to task.json\n    const tasksData = { tasks: msg.state.todos };\n    const taskMsg = { payload: JSON.stringify(tasksData, null, 2), state: msg.state };\n    \n    node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Report saved\"});\n    \n    return [reportMsg, taskMsg];\n} catch (error) {\n    msg.payload = { error: `Write report failed: ${error.message}` };\n    \n    // Add error to messages\n    msg.state.messages.push({\n        type: \"ai\",\n        content: `Write report error: ${error.message}`,\n        timestamp: new Date().toISOString()\n    });\n    \n    node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Write failed\"});\n    node.error(error);\n    return [msg, null];\n}",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 380,
        "wires": [
            [
                "final-report-file-out"
            ],
            [
                "3771cdcabb40d050",
                "521bcc5df3b99439"
            ]
        ]
    },
    {
        "id": "final-output",
        "type": "function",
        "z": "5f6eebf04085ab9f",
        "name": "Final Output",
        "func": "node.status({fill:\"green\", shape:\"dot\", text:\"üéâ Research complete\"});\n\n// Prepare final result\nmsg.payload = {\n    finalReport: msg.state.files[\"final_report.md\"]?.content || null,\n    todos: msg.state.todos,\n    files: Object.keys(msg.state.files),\n    searchHistory: msg.state.searchHistory,\n    iterationCount: msg.state.iteration\n};\n\n// Add completion message to state\nmsg.state.messages.push({\n    type: \"system\",\n    content: `Research completed after ${msg.state.iteration} iterations`,\n    timestamp: new Date().toISOString()\n});\n\n// Save final tasks to task.json file\nconst tasksData = { tasks: msg.state.todos };\nmsg.payload = JSON.stringify(tasksData, null, 2);\n\nnode.done(null, msg);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 860,
        "wires": [
            [
                "debug-output"
            ],
            [
                "save-final-tasks"
            ]
        ]
    },
    {
        "id": "save-final-tasks",
        "type": "file",
        "z": "5f6eebf04085ab9f",
        "name": "Save final tasks to task.json",
        "filename": "task.json",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1060,
        "y": 900,
        "wires": [
            []
        ]
    },
    {
        "id": "debug-output",
        "type": "debug",
        "z": "5f6eebf04085ab9f",
        "name": "Debug Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 820,
        "wires": []
    },
    {
        "id": "77988e4ab192c193",
        "type": "link out",
        "z": "5f6eebf04085ab9f",
        "name": "Build Prompt & Select Tool Link Out",
        "mode": "link",
        "links": [
            "2ef20357a461d84b"
        ],
        "x": 1535,
        "y": 440,
        "wires": []
    },
    {
        "id": "2ef20357a461d84b",
        "type": "link in",
        "z": "5f6eebf04085ab9f",
        "name": "Build Prompt & Select Tool Link In",
        "links": [
            "77988e4ab192c193"
        ],
        "x": 125,
        "y": 400,
        "wires": [
            [
                "build-prompt-and-select-tool"
            ]
        ]
    },
    {
        "id": "4246e54586a24ebf",
        "type": "link in",
        "z": "5f6eebf04085ab9f",
        "name": "Final Output In",
        "links": [
            "959777cf9e31b547",
            "521bcc5df3b99439"
        ],
        "x": 675,
        "y": 860,
        "wires": [
            [
                "final-output"
            ]
        ]
    },
    {
        "id": "959777cf9e31b547",
        "type": "link out",
        "z": "5f6eebf04085ab9f",
        "name": "Final Output Out",
        "mode": "link",
        "links": [
            "4246e54586a24ebf"
        ],
        "x": 1535,
        "y": 480,
        "wires": []
    },
    {
        "id": "save-tasks-to-file",
        "type": "file",
        "z": "5f6eebf04085ab9f",
        "name": "Save tasks to task.json",
        "filename": "task.json",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1840,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "final-report-file-out",
        "type": "file",
        "z": "5f6eebf04085ab9f",
        "name": "Save final_report.md",
        "filename": "final_report.md",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1940,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "521bcc5df3b99439",
        "type": "link out",
        "z": "5f6eebf04085ab9f",
        "name": "Final Output Out",
        "mode": "link",
        "links": [
            "4246e54586a24ebf"
        ],
        "x": 1865,
        "y": 460,
        "wires": []
    },
    {
        "id": "527485438c230c8e",
        "type": "link in",
        "z": "5f6eebf04085ab9f",
        "name": "Save tasks to task.json IN",
        "links": [
            "a664f7f616f8a853",
            "3771cdcabb40d050"
        ],
        "x": 1695,
        "y": 800,
        "wires": [
            [
                "save-tasks-to-file"
            ]
        ]
    },
    {
        "id": "a664f7f616f8a853",
        "type": "link out",
        "z": "5f6eebf04085ab9f",
        "name": "Save tasks to task.json OUT",
        "mode": "link",
        "links": [
            "527485438c230c8e"
        ],
        "x": 1135,
        "y": 640,
        "wires": []
    },
    {
        "id": "3771cdcabb40d050",
        "type": "link out",
        "z": "5f6eebf04085ab9f",
        "name": "Save tasks to task.json OUT",
        "mode": "link",
        "links": [
            "527485438c230c8e"
        ],
        "x": 1865,
        "y": 320,
        "wires": []
    },
    {
        "id": "741a40fcd008f1ab",
        "type": "websocket in",
        "z": "0885b58486b6cfde",
        "name": "",
        "server": "8a9b6c5d4e3f2a10",
        "client": "",
        "x": 320,
        "y": 840,
        "wires": [
            [
                "9360260cefcd707c"
            ]
        ]
    },
    {
        "id": "321390c65b95421a",
        "type": "inject",
        "z": "0885b58486b6cfde",
        "name": "Search Query: get_weather",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "What is the weather like in New York?",
        "payloadType": "str",
        "x": 300,
        "y": 760,
        "wires": [
            [
                "9360260cefcd707c"
            ]
        ]
    },
    {
        "id": "9360260cefcd707c",
        "type": "function",
        "z": "0885b58486b6cfde",
        "name": "ü§ñ Router Agent",
        "func": "node.status({fill:\"blue\", shape:\"dot\", text:\"ü§ñ Analyzing...\"});\n\nconst { ChatOllama } = global.get('lcOllama');\nconst { z } = global.get('zod');\n\n// Tool Constants\nconst SEARCH_WEB = \"search_web\";\nconst CALCULATE = \"calculate\";\nconst GET_WEATHER = \"get_weather\";\n\nconst ToolSchema = z.object({\n    tool: z.enum([SEARCH_WEB, CALCULATE, GET_WEATHER]),\n    reasoning: z.string().describe(\"Brief explanation of why this tool was chosen\"),\n    parameters: z.union([\n        z.object({ query: z.string().describe(\"Search query for web search\") }),\n        z.object({ expression: z.string().describe(\"Mathematical expression to calculate\") }),\n        z.object({ city: z.string().describe(\"City name for weather information\") })\n    ]).describe(\"Parameters for the tool call\")\n});\n\nconst llm = new ChatOllama({ model: \"qwen2.5:7b\", temperature: 0 });\nconst structuredLlm = llm.withStructuredOutput(ToolSchema);\n\n(async () => {\n    try {\n        const query = msg.payload || msg.query || \"\";\n        \n        // Create a message array for the LLM\n        const messages = [\n            {\n                role: \"user\",\n                content: `Based on the user's input, choose the most appropriate tool to help them.\\n\\nUser input: ${query}\\n\\nChoose a tool and provide the necessary parameters.`\n            }\n        ];\n\n        const classification = await structuredLlm.invoke(messages);\n\n        msg.state = {\n            query: query,\n            classification\n        };\n        \n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Tool selected: \" + classification.tool});\n        node.send(msg);\n    } catch (e) {\n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Error\"});\n        node.error(e);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 700,
        "wires": [
            [
                "48cda544a6b7ed33"
            ]
        ]
    },
    {
        "id": "48cda544a6b7ed33",
        "type": "switch",
        "z": "0885b58486b6cfde",
        "name": "üîÄ Route to Tool",
        "property": "state.classification.tool",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "search_web",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "calculate",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "get_weather",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 950,
        "y": 700,
        "wires": [
            [
                "607e2b208b80a6ea"
            ],
            [
                "6c4c7f0fcfb1fa52"
            ],
            [
                "c01a48b447cbeecd"
            ]
        ]
    },
    {
        "id": "607e2b208b80a6ea",
        "type": "function",
        "z": "0885b58486b6cfde",
        "name": "üîç search_web",
        "func": "node.status({fill:\"yellow\", shape:\"dot\", text:\"üîç Searching...\"});\n\nconst { TavilySearch } = global.get('lcTavily');\nconst TAVILY_API_KEY = global.get('TAVILY_API_KEY');\n\nconst searchTool = new TavilySearch({\n    maxResults: 5,\n    tavilyApiKey: TAVILY_API_KEY,\n    includeRawContent: false,\n    topic: \"general\"\n});\n\n(async () => {\n    try {\n        const query = msg.state.classification.parameters.query || msg.state.query;\n        const results = await searchTool.invoke({ query: query });\n        \n        msg.payload = results;\n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Search complete\"});\n        node.send(msg);\n    } catch (error) {\n        msg.payload = { error: `Search failed: ${error.message}` };\n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Search failed\"});\n        node.error(error);\n        node.send(msg);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 620,
        "wires": [
            [
                "df331ccf0b1c9fe1"
            ]
        ]
    },
    {
        "id": "6c4c7f0fcfb1fa52",
        "type": "function",
        "z": "0885b58486b6cfde",
        "name": "üßÆ calculate",
        "func": "node.status({fill:\"orange\", shape:\"dot\", text:\"üßÆ Calculating...\"});\n\n(async () => {\n    try {\n        const expression = msg.state.classification.parameters.expression || msg.state.query;\n        // Simple calculator - only basic operations\n        const sanitized = expression.replace(/[^0-9+\\-*/().\\s]/g, '');\n        // Using Function constructor for safe evaluation (in a real app, use a proper expression parser)\n        const result = Function('\"use strict\"; return (' + sanitized + ')')();\n        \n        msg.payload = { result: result };\n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Calculation done\"});\n        node.send(msg);\n    } catch (error) {\n        msg.payload = { error: `Calculation failed: ${error.message}` };\n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Calc failed\"});\n        node.error(error);\n        node.send(msg);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 700,
        "wires": [
            [
                "df331ccf0b1c9fe1"
            ]
        ]
    },
    {
        "id": "c01a48b447cbeecd",
        "type": "function",
        "z": "0885b58486b6cfde",
        "name": "üå§Ô∏è get_weather",
        "func": "node.status({fill:\"lightblue\", shape:\"dot\", text:\"üå§Ô∏è Checking weather...\"});\n\n(async () => {\n    try {\n        const city = msg.state.classification.parameters.city || msg.state.query;\n        \n        // Simulated weather tool (in a real implementation, connect to a weather API)\n        const weatherData = {\n            \"new york\": { temperature: \"18¬∞C\", condition: \"Cloudy\" },\n            \"london\": { temperature: \"12¬∞C\", condition: \"Rainy\" },\n            \"tokyo\": { temperature: \"22¬∞C\", condition: \"Sunny\" },\n            \"paris\": { temperature: \"15¬∞C\", condition: \"Partly cloudy\" }\n        };\n\n        const lowerCity = city.toLowerCase();\n        if (weatherData[lowerCity]) {\n            msg.payload = weatherData[lowerCity];\n        } else {\n            msg.payload = {\n                temperature: \"Unknown\",\n                condition: \"Weather data not available for \" + city\n            };\n        }\n        \n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Weather data ready\"});\n        node.send(msg);\n    } catch (error) {\n        msg.payload = { error: `Weather lookup failed: ${error.message}` };\n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Weather failed\"});\n        node.error(error);\n        node.send(msg);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 780,
        "wires": [
            [
                "df331ccf0b1c9fe1"
            ]
        ]
    },
    {
        "id": "df331ccf0b1c9fe1",
        "type": "function",
        "z": "0885b58486b6cfde",
        "name": "üí¨ format_response",
        "func": "node.status({fill:\"purple\", shape:\"dot\", text:\"üí¨ Formatting response...\"});\n\nconst { ChatOllama } = global.get('lcOllama');\nconst llm = new ChatOllama({ model: \"qwen2.5:7b\", temperature: 0.7 });\n\n(async () => {\n    const input = msg.state.query;\n    const toolUsed = msg.state.classification.tool;\n    const toolResult = msg.payload;\n    \n    if (toolResult.error) {\n        msg.payload = `I encountered an error while processing your request: ${toolResult.error}`;\n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Error in response\"});\n        node.send(msg);\n        return null;\n    }\n\n    // Generate a human-readable response based on the tool result\n    let response;\n    switch (toolUsed) {\n        case \"search_web\":\n            if (toolResult.results && toolResult.results.length > 0) {\n                const topResult = toolResult.results[0];\n                response = `I found this information: ${topResult.content.substring(0, 200)}... [from ${topResult.url}]`;\n            } else {\n                response = \"I couldn't find relevant information for your query.\";\n            }\n            break;\n        case \"calculate\":\n            response = `The result of the calculation is: ${toolResult.result}`;\n            break;\n        case \"get_weather\":\n            response = `The weather in ${msg.state.classification.parameters.city || input} is ${toolResult.temperature}, ${toolResult.condition.toLowerCase()}.`;\n            break;\n        default:\n            response = `Processed your request with ${toolUsed}. Result: ${JSON.stringify(toolResult)}`;\n    }\n    \n    // Use the LLM to refine the response\n    try {\n        const messages = [\n            {\n                role: \"user\",\n                content: `Format this response in a friendly way: ${response}`\n            }\n        ];\n        \n        const refinedResponse = await llm.invoke(messages);\n        // Check if refinedResponse is an object with content property (AIMessage)\n        if (refinedResponse && typeof refinedResponse === 'object' && refinedResponse.content) {\n            msg.payload = refinedResponse.content;\n        } else {\n            msg.payload = refinedResponse;\n        }\n        \n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Response formatted\"});\n    } catch (e) {\n        // If LLM formatting fails, use the original response\n        msg.payload = response;\n        node.status({fill:\"yellow\", shape:\"dot\", text:\"‚ö†Ô∏è Response formatted (no LLM)\"});\n    }\n    \n    node.send(msg);\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1540,
        "y": 700,
        "wires": [
            [
                "0629608d8f8b07ca",
                "e24407ce63649b29"
            ]
        ]
    },
    {
        "id": "0629608d8f8b07ca",
        "type": "debug",
        "z": "0885b58486b6cfde",
        "name": "üì§ Shallow Agent Response",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1840,
        "y": 740,
        "wires": []
    },
    {
        "id": "57de150a4f2a8dd1",
        "type": "inject",
        "z": "0885b58486b6cfde",
        "name": "Search Query: search_web",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Search for the latest news about artificial intelligence",
        "payloadType": "str",
        "x": 310,
        "y": 600,
        "wires": [
            [
                "9360260cefcd707c"
            ]
        ]
    },
    {
        "id": "2580e2e3dc333e4d",
        "type": "inject",
        "z": "0885b58486b6cfde",
        "name": "Search Query: calculate",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "five times five equals?",
        "payloadType": "str",
        "x": 320,
        "y": 680,
        "wires": [
            [
                "9360260cefcd707c"
            ]
        ]
    },
    {
        "id": "72e4a51207e3d9ac",
        "type": "file in",
        "z": "0885b58486b6cfde",
        "name": "",
        "filename": ".node-red/projects/node-red/react/shallow-agent.html",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 900,
        "y": 360,
        "wires": [
            [
                "6b0935d950c12827"
            ]
        ]
    },
    {
        "id": "506651486bb31a0c",
        "type": "http in",
        "z": "0885b58486b6cfde",
        "name": "",
        "url": "/show-shallow-agent",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 530,
        "y": 360,
        "wires": [
            [
                "72e4a51207e3d9ac"
            ]
        ]
    },
    {
        "id": "6b0935d950c12827",
        "type": "http response",
        "z": "0885b58486b6cfde",
        "name": "",
        "x": 1230,
        "y": 360,
        "wires": []
    },
    {
        "id": "e24407ce63649b29",
        "type": "websocket out",
        "z": "0885b58486b6cfde",
        "name": "",
        "server": "8a9b6c5d4e3f2a10",
        "client": "",
        "x": 1800,
        "y": 660,
        "wires": []
    },
    {
        "id": "d00af331777b95a2",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "Router Agent",
        "func": "const { ChatOllama } = global.get('lcOllama');\nconst { z } = global.get('zod');\n\n// Tool Constants\nconst SEARCH_WEB = \"search_web\";\nconst TELL_JOKE = \"tell_joke\";\nconst GET_WEATHER = \"get_weather\";\nconst CONVERT_CURRENCY = \"convert_currency\";\nconst DEBUG_CODE = \"debug_code\";\nconst SUMMARIZE_TEXT = \"summarize_text\";\nconst CALCULATE_MATH = \"calculate_math\";\nconst GET_STOCK = \"get_stock_price\";\nconst TRANSLATE = \"translate_text\";\n\nconst ToolSchema = z.object({\n    tool: z.enum([\n        SEARCH_WEB,\n        TELL_JOKE,\n        GET_WEATHER,\n        CONVERT_CURRENCY,\n        DEBUG_CODE,\n        SUMMARIZE_TEXT,\n        CALCULATE_MATH,\n        GET_STOCK,\n        TRANSLATE\n    ]),\n    reasoning: z.string().describe(\"Brief explanation of why this tool was chosen\")\n})\n\nconst llm = new ChatOllama({ model: \"qwen2.5:7b\", temperature: 0 });\nconst structuredLlm = llm.withStructuredOutput(ToolSchema);\n\n(async () => {\n    try {\n        const state = {\n            query: msg.query || \"\",            \n        };\n\n        const classification = await structuredLlm.invoke(state.query);\n\n        msg.state = {\n            ...state,\n            classification\n        };\n        node.send(msg);\n    } catch (e) {\n        node.error(e);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 420,
        "wires": [
            [
                "7c99601a26a767a8"
            ]
        ]
    },
    {
        "id": "7c99601a26a767a8",
        "type": "switch",
        "z": "a18fd0a91e07848d",
        "name": "Route to Tool",
        "property": "state.classification.tool",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "search_web",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "tell_joke",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "get_weather",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "convert_currency",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "summarize_text",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "calculate_math",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "get_stock_price",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "translate_text",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 8,
        "x": 840,
        "y": 420,
        "wires": [
            [
                "cc48e66e78d92b55"
            ],
            [
                "bcfe456e8a0db1e6"
            ],
            [
                "d96cc42e06af1f99"
            ],
            [
                "58d61aa5986d18bc"
            ],
            [
                "77b34ba6d5c27199"
            ],
            [
                "ab8f81b47ca31371"
            ],
            [
                "4e53110b74586e39"
            ],
            [
                "85f2b10ff0e6dd85"
            ]
        ]
    },
    {
        "id": "ab8f81b47ca31371",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "calculate_math",
        "func": "console.log(\"math\"); return msg;",
        "outputs": 1,
        "x": 1100,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "4e53110b74586e39",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "get_stock_price",
        "func": "console.log(\"stocks\"); return msg;",
        "outputs": 1,
        "x": 1100,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "85f2b10ff0e6dd85",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "translate_text",
        "func": "console.log(\"translate\"); return msg;",
        "outputs": 1,
        "x": 1100,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "32bd0623cb76e261",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "tell_joke",
        "props": [
            {
                "p": "query",
                "v": "Tell me a joke about a programmer",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 320,
        "y": 320,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "1e2ce84e6d9258df",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "search_web",
        "props": [
            {
                "p": "query",
                "v": "Latest AI news 2025",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 310,
        "y": 240,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "9d1abad15636d13b",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "get_weather",
        "props": [
            {
                "p": "query",
                "v": "Weather in London",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 310,
        "y": 420,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "1548cc54bb8c2f22",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "convert_currency",
        "props": [
            {
                "p": "query",
                "v": "50 USD to EUR",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 300,
        "y": 500,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "7bb944ca4d0e4ce4",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "summarize_text",
        "props": [
            {
                "p": "query",
                "v": "Summarize the history of the moon",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 300,
        "y": 580,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "c202cb3ad0f5a367",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "calculate_math",
        "props": [
            {
                "p": "query",
                "v": "What is 256 times 12?",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 300,
        "y": 660,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "d48cec575e0e4f44",
        "type": "inject",
        "z": "a18fd0a91e07848d",
        "name": "get_stock_price",
        "props": [
            {
                "p": "query",
                "v": "What is the price of Tesla?",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 300,
        "y": 720,
        "wires": [
            [
                "d00af331777b95a2"
            ]
        ]
    },
    {
        "id": "cc48e66e78d92b55",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "search_web",
        "func": "console.log(\"search_web\"); return msg;",
        "outputs": 1,
        "x": 1090,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "bcfe456e8a0db1e6",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "tell_joke",
        "func": "console.log(\"tell_joke\"); return msg;",
        "outputs": 1,
        "x": 1080,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "d96cc42e06af1f99",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "get_weather",
        "func": "console.log(\"get_weather\"); return msg;",
        "outputs": 1,
        "x": 1090,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "58d61aa5986d18bc",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "convert_currency",
        "func": "console.log(\"convert_currency\"); return msg;",
        "outputs": 1,
        "x": 1110,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "77b34ba6d5c27199",
        "type": "function",
        "z": "a18fd0a91e07848d",
        "name": "summarize_text",
        "func": "console.log(\"summarize_text\"); return msg;",
        "outputs": 1,
        "x": 1100,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "9a51dd7724ef42d8",
        "type": "inject",
        "z": "9ee40a31254c5a6a",
        "name": "üöÄ Start PRD",
        "props": [
            {
                "p": "query",
                "v": "Project: Basic Task Tracker. Tech Stack: React, Ant Design.",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 350,
        "y": 200,
        "wires": [
            [
                "34dd365f68fc4ebf"
            ]
        ]
    },
    {
        "id": "34dd365f68fc4ebf",
        "type": "function",
        "z": "9ee40a31254c5a6a",
        "name": "üìã Create TODO Tasks",
        "func": "const { ChatOllama } = global.get('lcOllama');\nconst { z } = global.get('zod');\n\n// Model constants\nconst MODEL_EMBEDDING = \"mxbai-embed-large\";\nconst MODEL_AGENT = \"llama3.2:3b\";\nconst MODEL_GENERATION = \"deepseek-r1:8b\";\nconst MODEL_GEMMA_3_4b = \"gemma3:4b\";\nconst MODEL_GEMMA_3_27b_CLOUD = \"gemma3:27b-cloud\";\nconst MODEL_MINISTRAL3 = \"ministral-3:8b\";\nconst MODEL_MINISTRAL_3_14B_CLOUD = \"ministral-3:14b-cloud\";\nconst MODEL_QWEN = \"qwen2.5:7b\";\nconst MODEL_QWEN_2_5_CODER_7b = \"qwen2.5-coder:7b\";\nconst MODEL_QWEN3_CODER_480b_CLOUD = \"qwen3-coder:480b-cloud\";\n\nconst model = MODEL_MINISTRAL3;\n\nconst TaskSchema = z.object({\n    id: z.number(),\n    title: z.string(),\n    description: z.string(),\n    details: z.string(),\n    testStrategy: z.string(),\n    priority: z.enum([\"high\", \"medium\", \"low\"]),\n    dependencies: z.array(z.number()),\n    status: z.literal(\"pending\"),\n    subtasks: z.array(z.number()).default([]),\n    updatedAt: z.string()\n});\n\nconst TaskListSchema = z.object({\n    tasks: z.array(TaskSchema)\n});\n\nconst llm = new ChatOllama({ model: \"qwen2.5:7b\", temperature: 0 });\nconst structuredLlm = llm.withStructuredOutput(TaskListSchema);\n\nconst currentTimestamp = new Date().toISOString();\n\nconst systemPrompt = `\nYou are an expert Project Manager and Technical Architect. \nYour goal is to take a PRD (Product Requirements Document) and break it down into a logical sequence of development tasks.\n\nRules:\n1. Tasks must be sequential and atomic.\n2. Include dependencies (numeric IDs).\n3. Each task must include a detailed 'testStrategy' and implementation 'details'.\n4. All tasks must have the status 'pending'.\n5. Set 'updatedAt' for every task to exactly: ${currentTimestamp}\n`;\n\nconst { query } = msg;\nconst userPrompt = `\nConvert the following PRD into a JSON array of development tasks:\n\nPRD CONTENT:\n${query}\n`;\n\n(async () => {\n    try {\n        const response = await structuredLlm.invoke([\n            [\"system\", systemPrompt],\n            [\"human\", userPrompt]\n        ]);\n        msg.tasks = response.tasks;\n     \n        node.send(msg);\n    } catch (e) {\n        node.error(\"LLM Error: \" + e.message);\n    }\n})();\n\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 240,
        "wires": [
            [
                "80ddcf0c9477c584"
            ]
        ]
    },
    {
        "id": "80ddcf0c9477c584",
        "type": "split",
        "z": "9ee40a31254c5a6a",
        "name": "‚úÇÔ∏è Split tasks",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "property": "tasks",
        "x": 490,
        "y": 280,
        "wires": [
            [
                "af92c236426f30e1",
                "9f1c5aa9f13a2307"
            ]
        ]
    },
    {
        "id": "7a43c25eefee3663",
        "type": "join",
        "z": "9ee40a31254c5a6a",
        "name": "üîó Join tasks",
        "mode": "auto",
        "build": "string",
        "property": "tasks",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "useparts": true,
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 420,
        "y": 420,
        "wires": [
            [
                "081e58f456ef014b"
            ]
        ]
    },
    {
        "id": "081e58f456ef014b",
        "type": "debug",
        "z": "9ee40a31254c5a6a",
        "name": "‚úÖ Final tasks List",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "tasks",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 510,
        "y": 480,
        "wires": []
    },
    {
        "id": "9f1c5aa9f13a2307",
        "type": "function",
        "z": "9ee40a31254c5a6a",
        "name": "üî® Work on task",
        "func": "// Access individual task from msg.tasks (set by Split)\nconst task = msg.tasks;\n\nconsole.log(task);\nconsole.log(\"=========\");\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 360,
        "wires": [
            [
                "7a43c25eefee3663",
                "ac05ea23b4019a22"
            ]
        ]
    },
    {
        "id": "ac05ea23b4019a22",
        "type": "debug",
        "z": "9ee40a31254c5a6a",
        "name": "üêû debug 11",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "tasks",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 550,
        "y": 360,
        "wires": []
    },
    {
        "id": "af92c236426f30e1",
        "type": "function",
        "z": "9ee40a31254c5a6a",
        "g": "386155bf4cb25dcc",
        "name": "üß† Orchestrator Agent",
        "func": "const { ChatOllama } = global.get('lcOllama');\nconst { z } = global.get('zod');\n\n// Tool Constants\nconst SEARCH_WEB = \"search_web\";\nconst TELL_JOKE = \"tell_joke\";\nconst GET_WEATHER = \"get_weather\";\nconst CONVERT_CURRENCY = \"convert_currency\";\nconst DEBUG_CODE = \"debug_code\";\nconst SUMMARIZE_TEXT = \"summarize_text\";\nconst CALCULATE_MATH = \"calculate_math\";\nconst GET_STOCK = \"get_stock_price\";\nconst TRANSLATE = \"translate_text\";\n\nconst ToolSchema = z.object({\n    tool: z.enum([\n        SEARCH_WEB,\n        TELL_JOKE,\n        GET_WEATHER,\n        CONVERT_CURRENCY,\n        DEBUG_CODE,\n        SUMMARIZE_TEXT,\n        CALCULATE_MATH,\n        GET_STOCK,\n        TRANSLATE\n    ]),\n    reasoning: z.string().describe(\"Brief explanation of why this tool was chosen\")\n})\n\nconst llm = new ChatOllama({ model: \"qwen2.5:7b\", temperature: 0 });\nconst structuredLlm = llm.withStructuredOutput(ToolSchema);\n\n(async () => {\n    try {\n        const state = {\n            query: msg.query || \"\",            \n        };\n\n        const task = msg.tasks;\n        const classification = await structuredLlm.invoke(task.description);\n\n        msg.state = {\n            ...state,\n            classification\n        };\n        node.send(msg);\n    } catch (e) {\n        node.error(e);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 360,
        "wires": [
            [
                "a03243f9f4ced371"
            ]
        ]
    },
    {
        "id": "a03243f9f4ced371",
        "type": "switch",
        "z": "9ee40a31254c5a6a",
        "g": "386155bf4cb25dcc",
        "name": "‚öñÔ∏è Action Switch",
        "property": "state.classification.tool",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "search_web",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "tell_joke",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "get_weather",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "convert_currency",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "summarize_text",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "calculate_math",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "get_stock_price",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "translate_text",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 8,
        "x": 1010,
        "y": 360,
        "wires": [
            [
                "f86d798b98c1f791"
            ],
            [
                "26a3990f8c090c8e"
            ],
            [
                "d899c9620964f91a"
            ],
            [
                "1a50cf2a0b424f29"
            ],
            [
                "699dc0641af943f1"
            ],
            [
                "57b404056be20e97"
            ],
            [
                "9a53b08aff574db6"
            ],
            [
                "d707fbdf4168c6e9"
            ]
        ]
    },
    {
        "id": "57b404056be20e97",
        "type": "function",
        "z": "9ee40a31254c5a6a",
        "g": "386155bf4cb25dcc",
        "name": "üî¢ calculate_math",
        "func": "console.log(\"math\"); return msg;",
        "outputs": 1,
        "x": 1260,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "9a53b08aff574db6",
        "type": "function",
        "z": "9ee40a31254c5a6a",
        "g": "386155bf4cb25dcc",
        "name": "üìà get_stock_price",
        "func": "console.log(\"stocks\"); return msg;",
        "outputs": 1,
        "x": 1260,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "d707fbdf4168c6e9",
        "type": "function",
        "z": "9ee40a31254c5a6a",
        "g": "386155bf4cb25dcc",
        "name": "üåé translate_text",
        "func": "console.log(\"translate\"); return msg;",
        "outputs": 1,
        "x": 1260,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "f86d798b98c1f791",
        "type": "function",
        "z": "9ee40a31254c5a6a",
        "g": "386155bf4cb25dcc",
        "name": "üîç search_web",
        "func": "console.log(\"search_web\"); return msg;",
        "outputs": 1,
        "x": 1250,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "26a3990f8c090c8e",
        "type": "function",
        "z": "9ee40a31254c5a6a",
        "g": "386155bf4cb25dcc",
        "name": "ü§° tell_joke",
        "func": "console.log(\"tell_joke\"); return msg;",
        "outputs": 1,
        "x": 1240,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "d899c9620964f91a",
        "type": "function",
        "z": "9ee40a31254c5a6a",
        "g": "386155bf4cb25dcc",
        "name": "‚òÅÔ∏è get_weather",
        "func": "console.log(\"get_weather\"); return msg;",
        "outputs": 1,
        "x": 1250,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "1a50cf2a0b424f29",
        "type": "function",
        "z": "9ee40a31254c5a6a",
        "g": "386155bf4cb25dcc",
        "name": "üí± convert_currency",
        "func": "console.log(\"convert_currency\"); return msg;",
        "outputs": 1,
        "x": 1270,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "699dc0641af943f1",
        "type": "function",
        "z": "9ee40a31254c5a6a",
        "g": "386155bf4cb25dcc",
        "name": "üìù summarize_text",
        "func": "console.log(\"summarize_text\"); return msg;",
        "outputs": 1,
        "x": 1260,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "aaeb232b3fceb58e",
        "type": "inject",
        "z": "067e10d1acb5ae55",
        "name": "",
        "props": [
            {
                "p": "query",
                "v": "Give me latest news from Iran",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 110,
        "y": 100,
        "wires": [
            [
                "37c7938ad1f0c4e3",
                "938f01f2f11a1833"
            ]
        ]
    },
    {
        "id": "989f1d55af9197a9",
        "type": "function",
        "z": "067e10d1acb5ae55",
        "name": "üß† AI Agent",
        "func": "const { ChatOllama } = global.get('lcOllama');\nconst { z } = global.get('zod');\n\n// Model constants\nconst MODEL_EMBEDDING = \"mxbai-embed-large\";\nconst MODEL_AGENT = \"llama3.2:3b\";\nconst MODEL_GENERATION = \"deepseek-r1:8b\";\nconst MODEL_GEMMA_3_4b = \"gemma3:4b\";\nconst MODEL_GEMMA_3_27b_CLOUD = \"gemma3:27b-cloud\";\nconst MODEL_MINISTRAL3 = \"ministral-3:8b\";\nconst MODEL_MINISTRAL_3_14B_CLOUD = \"ministral-3:14b-cloud\";\nconst MODEL_QWEN = \"qwen2.5:7b\";\nconst MODEL_QWEN_2_5_CODER_7b = \"qwen2.5-coder:7b\";\nconst MODEL_QWEN3_CODER_480b_CLOUD = \"qwen3-coder:480b-cloud\";\n\nconst model = MODEL_QWEN;\n\nconst llm = new ChatOllama({ model: model, temperature: 0 });\n\nconst currentTimestamp = new Date().toISOString();\n\nconst { payload } = msg;\n\nconst systemPrompt = `\nYou are an expert report generator with extensive experience in creating well-structured, professional markdown reports from JSON data. Your primary objective is to transform the provided JSON data into a comprehensive, well-organized markdown report that follows best practices for readability and clarity.\n\nYour report should:\n1. Include a clear title based on the content\n2. Use appropriate markdown headings (##, ###) to structure the content logically\n3. Format lists, tables, and other elements properly\n4. Maintain all important information from the original JSON\n5. Present the information in a professional, easy-to-read format\n6. Ensure the report is well-organized and coherent\n`;\n\n\nconst userPrompt = `\nPlease convert the following JSON data into a well-structured markdown report. The JSON contains search results and research data that should be formatted into a professional report with appropriate headings, subheadings, and content organization.\n\nJSON Data:\n${JSON.stringify(payload)}\n\nCreate a comprehensive report that presents this information in a clear, organized manner using proper markdown formatting.\n`;\n\n(async () => {\n    try {        \n        const response = await llm.invoke([\n            [\"system\", systemPrompt],\n            [\"human\", userPrompt]\n        ]);        \n        msg.payload = response.content;\n     \n        node.send(msg);\n    } catch (e) {\n        node.error(\"LLM Error: \" + e.message);\n    }\n})();\n\nreturn null;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 220,
        "wires": [
            [
                "f1d00f5e6f362817"
            ]
        ]
    },
    {
        "id": "938f01f2f11a1833",
        "type": "function",
        "z": "067e10d1acb5ae55",
        "d": true,
        "name": "üîç search_web",
        "func": "node.status({fill:\"yellow\", shape:\"dot\", text:\"üîç Searching...\"});\n\nconst { TavilySearch } = global.get('lcTavily');\nconst TAVILY_API_KEY = global.get('TAVILY_API_KEY');\n\nconst searchTool = new TavilySearch({\n    maxResults: 5,\n    tavilyApiKey: TAVILY_API_KEY,\n    includeRawContent: false,\n    topic: \"general\"\n});\n\n(async () => {\n    try {\n        const { query } = msg;        \n        const results = await searchTool.invoke({ query: query });\n        \n        msg.payload = results;\n        node.status({fill:\"green\", shape:\"dot\", text:\"‚úÖ Search complete\"});\n        node.send(msg);\n    } catch (error) {\n        msg.payload = { error: `Search failed: ${error.message}` };\n        node.status({fill:\"red\", shape:\"ring\", text:\"‚ùå Search failed\"});\n        node.error(error);\n        node.send(msg);\n    }\n})();\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "39d74aa220109903",
        "type": "debug",
        "z": "067e10d1acb5ae55",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 530,
        "y": 340,
        "wires": []
    },
    {
        "id": "37c7938ad1f0c4e3",
        "type": "function",
        "z": "067e10d1acb5ae55",
        "name": "search_web_mock",
        "func": "const payload = {\n    query: 'Give me latest news from Iran',\n    follow_up_questions: null,\n    answer: null,\n    images: [],\n    results: [\n        {\n            url: 'https://www.newsnow.com/us/World/Middle+East/Iran',\n            title: 'Iran News | Iran Latest Updates - NewsNow',\n            content: 'Latest news on Iran, providing comprehensive coverage of nuclear talks, sanctions, protests, human rights, economy, regional tensions, and political',\n            score: 0.9992792,\n            raw_content: null\n        },\n        {\n            url: 'https://apnews.com/hub/iran',\n            title: 'Iran | Latest News from Iran Today | AP News',\n            content: 'Iran ¬∑ Trump and top Iranian officials exchange threats over protests roiling Iran ¬∑ At least 7 reported killed during widening protests in Iran sparked by',\n            score: 0.9988121,\n            raw_content: null\n        },\n        {\n            url: 'https://www.youtube.com/watch?v=MCEg-pnJXL8',\n            title: \"Iran Shuts Down As Protesters Storm Governor's Office ... - YouTube\",\n            content: '... Latest News | Global News ... Iran: Several people killed as protest across the country escalate | DW News. DW News New 21K views.',\n            score: 0.9964064,\n            raw_content: null\n        },\n        {\n            url: 'https://www.aljazeera.com/where/iran/',\n            title: \"Iran | Today's latest from Al Jazeera\",\n            content: \"Iran urges UN to respond to Trump's 'reckless' threats over protests ¬∑ Iran faces growing protests amid deepening economic crisis ¬∑ Five things you need to know\",\n            score: 0.9932025,\n            raw_content: null\n        },\n        {\n            url: 'https://www.reuters.com/world/iran/',\n            title: 'Iran News | Latest Headlines & Stories - Reuters',\n            content: \"Protests over Iran's soaring cost of living spread to several universities on Tuesday, with students joining shopkeepers and bazaar merchants, semi-official\",\n            score: 0.9931496,\n            raw_content: null\n        }\n    ],\n    response_time: 0.69,\n    request_id: '8d0013f6-6ea3-441a-9425-e7442831fb75'\n};\n\nmsg = {\n    ...msg,\n    payload\n}\n\nreturn msg;\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 160,
        "wires": [
            [
                "989f1d55af9197a9"
            ]
        ]
    },
    {
        "id": "f1d00f5e6f362817",
        "type": "file",
        "z": "067e10d1acb5ae55",
        "name": "save_report",
        "filename": "C:\\\\Users\\\\4artu\\\\.node-red\\\\projects\\\\node-red\\\\ai\\\\agent-report.md",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 450,
        "y": 280,
        "wires": [
            [
                "39d74aa220109903"
            ]
        ]
    },
    {
        "id": "5e0ddaade57f14fe",
        "type": "inject",
        "z": "d9c88a0a246ec309",
        "name": "Situacija",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 260,
        "wires": [
            [
                "8341a933b165eceb"
            ]
        ]
    },
    {
        "id": "8341a933b165eceb",
        "type": "change",
        "z": "d9c88a0a246ec309",
        "name": "Motyvacija",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 260,
        "wires": [
            [
                "886151dd6f39346c"
            ]
        ]
    },
    {
        "id": "886151dd6f39346c",
        "type": "debug",
        "z": "d9c88a0a246ec309",
        "name": "Rezultatas",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 670,
        "y": 260,
        "wires": []
    },
    {
        "id": "69688b15eb0d1015",
        "type": "inject",
        "z": "d9c88a0a246ec309",
        "name": "When...",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 230,
        "y": 400,
        "wires": [
            [
                "213ae8abae4ea3b3"
            ]
        ]
    },
    {
        "id": "213ae8abae4ea3b3",
        "type": "switch",
        "z": "d9c88a0a246ec309",
        "name": "I want to...",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 450,
        "y": 400,
        "wires": [
            [
                "1106b568bf2064d0"
            ]
        ]
    },
    {
        "id": "1106b568bf2064d0",
        "type": "debug",
        "z": "d9c88a0a246ec309",
        "name": "So I can...",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 680,
        "y": 400,
        "wires": []
    },
    {
        "id": "eb86f27a56533232",
        "type": "inject",
        "z": "d9c88a0a246ec309",
        "name": "Situation",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 320,
        "wires": [
            [
                "0def639bf5173b3d"
            ]
        ]
    },
    {
        "id": "0def639bf5173b3d",
        "type": "change",
        "z": "d9c88a0a246ec309",
        "name": "Motivation",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 320,
        "wires": [
            [
                "43819c375eb57831"
            ]
        ]
    },
    {
        "id": "43819c375eb57831",
        "type": "debug",
        "z": "d9c88a0a246ec309",
        "name": "Expected outcome",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 320,
        "wires": []
    },
    {
        "id": "9804ae9eb68137ee",
        "type": "inject",
        "z": "b70b82bf8d00eb8a",
        "name": "ctx = 0",
        "props": [
            {
                "p": "ctx",
                "v": "0",
                "vt": "num"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 410,
        "y": 280,
        "wires": [
            [
                "b82bdc1deb8ef509"
            ]
        ]
    },
    {
        "id": "b82bdc1deb8ef509",
        "type": "change",
        "z": "b70b82bf8d00eb8a",
        "name": "ctx++",
        "rules": [
            {
                "t": "set",
                "p": "ctx",
                "pt": "msg",
                "to": "ctx+1",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 360,
        "wires": [
            [
                "7855f2d23e2157f5",
                "7a6d9d05e5d9bf8a"
            ]
        ]
    },
    {
        "id": "7855f2d23e2157f5",
        "type": "debug",
        "z": "b70b82bf8d00eb8a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "ctx",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 860,
        "y": 280,
        "wires": []
    },
    {
        "id": "7a6d9d05e5d9bf8a",
        "type": "switch",
        "z": "b70b82bf8d00eb8a",
        "name": "while ( ctx < 10 )",
        "property": "ctx",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "10",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 640,
        "y": 220,
        "wires": [
            [
                "b82bdc1deb8ef509"
            ]
        ]
    },
    {
        "id": "db0c792680c91dc6",
        "type": "inject",
        "z": "b70b82bf8d00eb8a",
        "name": "[1,2,3,4,5,6]",
        "props": [
            {
                "p": "payload.array",
                "v": "[1,2,3,4,5,6]",
                "vt": "json"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 370,
        "y": 520,
        "wires": [
            [
                "65d3bdb48885b420"
            ]
        ]
    },
    {
        "id": "65d3bdb48885b420",
        "type": "function",
        "z": "b70b82bf8d00eb8a",
        "name": "Pop item from the array",
        "func": "const val = msg.payload.array.pop();\n//console.log(val);\nmsg.payload = {\n    ...msg.payload,\n    'val': val\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 520,
        "wires": [
            [
                "48a2f59561eb8d74"
            ]
        ]
    },
    {
        "id": "8da682fac1a35894",
        "type": "switch",
        "z": "b70b82bf8d00eb8a",
        "name": "",
        "property": "payload.array.length",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 830,
        "y": 620,
        "wires": [
            [
                "65d3bdb48885b420"
            ],
            [
                "23fd320f9c895f4c"
            ]
        ]
    },
    {
        "id": "23fd320f9c895f4c",
        "type": "debug",
        "z": "b70b82bf8d00eb8a",
        "name": "debug 15",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 740,
        "wires": []
    },
    {
        "id": "48a2f59561eb8d74",
        "type": "function",
        "z": "b70b82bf8d00eb8a",
        "name": "Print value",
        "func": "console.log( 'val', msg.payload.val );\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 520,
        "wires": [
            [
                "8da682fac1a35894",
                "a467bbb1688a0f53"
            ]
        ]
    },
    {
        "id": "a467bbb1688a0f53",
        "type": "debug",
        "z": "b70b82bf8d00eb8a",
        "name": "debug 16",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload.val",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1120,
        "y": 460,
        "wires": []
    },
    {
        "id": "59ff2a1.fa600d4",
        "type": "http in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "url": "/react",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 40,
        "wires": [
            [
                "7e73aef5e421cf29"
            ]
        ]
    },
    {
        "id": "266c286f.d993d8",
        "type": "http response",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "x": 1050,
        "y": 240,
        "wires": []
    },
    {
        "id": "7e73aef5e421cf29",
        "type": "file in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "filename": ".node-red/projects/node-red/react/index.html",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 610,
        "y": 40,
        "wires": [
            [
                "266c286f.d993d8"
            ]
        ]
    },
    {
        "id": "68572dadaaea1467",
        "type": "file in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "filename": ".node-red/projects/node-red/react/test.js",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 600,
        "y": 120,
        "wires": [
            [
                "266c286f.d993d8"
            ]
        ]
    },
    {
        "id": "77ac86f8d9cda0e5",
        "type": "http in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "url": "/react/test.js",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 120,
        "wires": [
            [
                "68572dadaaea1467"
            ]
        ]
    },
    {
        "id": "f5280916e3560f07",
        "type": "file in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "filename": ".node-red/projects/node-red/react/ImageModal.js",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 620,
        "y": 200,
        "wires": [
            [
                "266c286f.d993d8"
            ]
        ]
    },
    {
        "id": "5fdb6b26612b3512",
        "type": "http in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "url": "/react/ImageModal.js",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 200,
        "wires": [
            [
                "f5280916e3560f07"
            ]
        ]
    },
    {
        "id": "8d9a7d7eef29e155",
        "type": "http in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "url": "/react/WebSocketTest.js",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 280,
        "wires": [
            [
                "aba8749fd67bf0c3"
            ]
        ]
    },
    {
        "id": "aba8749fd67bf0c3",
        "type": "file in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "filename": ".node-red/projects/node-red/react/WebSocketTest.js",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 630,
        "y": 280,
        "wires": [
            [
                "266c286f.d993d8"
            ]
        ]
    },
    {
        "id": "ce6adba5081d840f",
        "type": "websocket out",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "server": "65fccb54d6cf3d7f",
        "client": "",
        "x": 1100,
        "y": 700,
        "wires": []
    },
    {
        "id": "c3bca1cfd22180d1",
        "type": "inject",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Hello",
        "payloadType": "str",
        "x": 1090,
        "y": 600,
        "wires": [
            [
                "ce6adba5081d840f"
            ]
        ]
    },
    {
        "id": "2a63a69f0a893163",
        "type": "websocket in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "server": "65fccb54d6cf3d7f",
        "client": "",
        "x": 110,
        "y": 520,
        "wires": [
            [
                "7b32b19d64d48a84"
            ]
        ]
    },
    {
        "id": "8e34fbd988384994",
        "type": "debug",
        "z": "f03d232b4fcc4b3e",
        "name": "otherwise",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 560,
        "y": 740,
        "wires": []
    },
    {
        "id": "866c93fbcc3ce222",
        "type": "http in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "url": "/react/Traverse.js",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 360,
        "wires": [
            [
                "c7975da2f90be921"
            ]
        ]
    },
    {
        "id": "c7975da2f90be921",
        "type": "file in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "filename": ".node-red/projects/node-red/react/Traverse.js",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 610,
        "y": 360,
        "wires": [
            [
                "266c286f.d993d8"
            ]
        ]
    },
    {
        "id": "8384341326434dfa",
        "type": "http in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "url": "/react/P27.js",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 440,
        "wires": [
            [
                "b085d72ffa8c6b0b"
            ]
        ]
    },
    {
        "id": "b085d72ffa8c6b0b",
        "type": "file in",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "filename": ".node-red/projects/node-red/react/P27.js",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 600,
        "y": 440,
        "wires": [
            [
                "266c286f.d993d8"
            ]
        ]
    },
    {
        "id": "15e54e6e2251c4f9",
        "type": "switch",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "property": "payload.action",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 210,
        "y": 660,
        "wires": [
            [
                "0648de1adc9bb5ce"
            ],
            [
                "9bd6cc45287fc9e6"
            ],
            [
                "2f7ffb0a5faef15c"
            ],
            [
                "8e34fbd988384994"
            ]
        ]
    },
    {
        "id": "7b32b19d64d48a84",
        "type": "json",
        "z": "f03d232b4fcc4b3e",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": true,
        "x": 170,
        "y": 580,
        "wires": [
            [
                "15e54e6e2251c4f9"
            ]
        ]
    },
    {
        "id": "0648de1adc9bb5ce",
        "type": "function",
        "z": "f03d232b4fcc4b3e",
        "name": "insert",
        "func": "const jSonFromFrontend = msg.payload.data;\n\nconst jSon1 = [\n    { \"clien_id\": 1, \"amount\": jSonFromFrontend.traceId },\n    { \"clien_id\": 2, \"amount\": 3 },\n    { \"clien_id\": 3, \"amount\": 3 }\n];\n\nconst jSon2 = jSon1;\n\nconst jSonP27 = jSon1;\n\nconst jSonResponse = {\n    action: 0,\n    jSon1: jSon1,\n    jSon2: jSon2,\n    jSon3: jSonP27,\n};\nmsg.payload = jSonResponse;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 560,
        "wires": [
            [
                "ce6adba5081d840f"
            ]
        ]
    },
    {
        "id": "9bd6cc45287fc9e6",
        "type": "function",
        "z": "f03d232b4fcc4b3e",
        "name": "refresh",
        "func": "\nconst jSon1 = [\n    { \"clien_id\": 1, \"amount\": 3 },\n    { \"clien_id\": 2, \"amount\": 3 },\n    { \"clien_id\": 3, \"amount\": 3 }\n];\n\nconst jSon2 = jSon1;\n\nconst jSonP27 = jSon1;\n\nconst jSonResponse = {\n    action: 0,\n    jSon1: jSon1,\n    jSon2: jSon2,\n    jSon3: jSonP27,\n};\nmsg.payload = jSonResponse;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 620,
        "wires": [
            [
                "ce6adba5081d840f"
            ]
        ]
    },
    {
        "id": "2f7ffb0a5faef15c",
        "type": "function",
        "z": "f03d232b4fcc4b3e",
        "name": "delete",
        "func": "\nconst jSon1 = [\n    { \"clien_id\": 1, \"amount\": 7 },\n    { \"clien_id\": 2, \"amount\": 8 },\n    { \"clien_id\": 3, \"amount\": 9 }\n];\n\nconst jSon2 = jSon1;\n\nconst jSonP27 = jSon1;\n\nconst jSonResponse = {\n    action: 0,\n    jSon1: jSon1,\n    jSon2: jSon2,\n    jSon3: jSonP27,\n};\nmsg.payload = jSonResponse;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 680,
        "wires": [
            [
                "ce6adba5081d840f"
            ]
        ]
    },
    {
        "id": "83e0257de19abd28",
        "type": "http in",
        "z": "7184d5a8972f1fe0",
        "name": "",
        "url": "/web",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 380,
        "y": 360,
        "wires": [
            [
                "da7d2b952a3c8df0"
            ]
        ]
    },
    {
        "id": "8cf3deb298512f66",
        "type": "http response",
        "z": "7184d5a8972f1fe0",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1030,
        "y": 360,
        "wires": []
    },
    {
        "id": "6248cd7fd679aa6e",
        "type": "template",
        "z": "7184d5a8972f1fe0",
        "name": "HTML",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Title</title>\n    <script>\n        {{{payload.websocket}}}\n    </script>\n</head>\n<body>\nHello\n</body>\n</html>",
        "output": "str",
        "x": 850,
        "y": 360,
        "wires": [
            [
                "8cf3deb298512f66"
            ]
        ]
    },
    {
        "id": "d42f9d0712bcedbb",
        "type": "websocket in",
        "z": "7184d5a8972f1fe0",
        "name": "",
        "server": "b79df368d7aaac79",
        "client": "",
        "x": 420,
        "y": 520,
        "wires": [
            [
                "dbf524f28cfd16cf"
            ]
        ]
    },
    {
        "id": "dbf524f28cfd16cf",
        "type": "debug",
        "z": "7184d5a8972f1fe0",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 520,
        "wires": []
    },
    {
        "id": "aaf7e06cd66dfdea",
        "type": "websocket out",
        "z": "7184d5a8972f1fe0",
        "name": "",
        "server": "b79df368d7aaac79",
        "client": "",
        "x": 650,
        "y": 580,
        "wires": []
    },
    {
        "id": "58f3d52ede958831",
        "type": "inject",
        "z": "7184d5a8972f1fe0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 450,
        "y": 580,
        "wires": [
            [
                "aaf7e06cd66dfdea"
            ]
        ]
    },
    {
        "id": "da7d2b952a3c8df0",
        "type": "template",
        "z": "7184d5a8972f1fe0",
        "name": "",
        "field": "payload.websocket",
        "fieldType": "msg",
        "format": "javascript",
        "syntax": "mustache",
        "template": "const ws = new WebSocket('ws://127.0.0.1:1880/ws/machine');\nws.onmessage = function (e) {\n    console.log(e);\n}\nws.onopen = function () {\n    console.log('A client connected!');\n    ws.send('A client connected');\n}",
        "output": "str",
        "x": 640,
        "y": 360,
        "wires": [
            [
                "6248cd7fd679aa6e"
            ]
        ]
    },
    {
        "id": "2b5433c167f34753",
        "type": "file in",
        "z": "a6828adb58c9e145",
        "name": "",
        "filename": ".node-red/test.js",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 520,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "1b165353165d655c",
        "type": "debug",
        "z": "a6828adb58c9e145",
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1040,
        "y": 240,
        "wires": []
    },
    {
        "id": "062954a5539c3bb2",
        "type": "inject",
        "z": "a6828adb58c9e145",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 240,
        "wires": [
            [
                "4bf000224b3781e9",
                "ca0f3c96b1cb87eb"
            ]
        ]
    },
    {
        "id": "7dec678a28fa7e37",
        "type": "function",
        "z": "a6828adb58c9e145",
        "name": "function 4",
        "func": "\nvar func = new Function(\"return \" + msg.payload)();\nconst num = func();\nconsole.log( num );\n//fn.x = 10;\nmsg.payload = num;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 180,
        "wires": [
            [
                "1b165353165d655c"
            ]
        ]
    },
    {
        "id": "4bf000224b3781e9",
        "type": "template",
        "z": "a6828adb58c9e145",
        "name": "function without parameters",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "function test()\n{\n    return 5;\n}",
        "output": "str",
        "x": 500,
        "y": 180,
        "wires": [
            [
                "7dec678a28fa7e37"
            ]
        ]
    },
    {
        "id": "ca0f3c96b1cb87eb",
        "type": "template",
        "z": "a6828adb58c9e145",
        "name": "function with parameters",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "function test(a)\n{\n    return a + a;\n}",
        "output": "str",
        "x": 490,
        "y": 320,
        "wires": [
            [
                "5d43e2110c584d64"
            ]
        ]
    },
    {
        "id": "5d43e2110c584d64",
        "type": "function",
        "z": "a6828adb58c9e145",
        "name": "function 5",
        "func": "var func = new Function(\"return \" + msg.payload)();\nconst num = func(3);\nmsg.payload = num;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 320,
        "wires": [
            [
                "1b165353165d655c"
            ]
        ]
    },
    {
        "id": "6232921449696c56",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Ordinary World",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 140,
        "y": 960,
        "wires": [
            [
                "1f343e6bb8519a2a"
            ]
        ],
        "info": "# Ordinary world\n\nWho is the hero? What is world like at the beginning?\n\nthe hero is still in his familiar environment‚Äì Neo is an unsatisfied hacker looking for an answer;"
    },
    {
        "id": "1f343e6bb8519a2a",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Call to Action",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 880,
        "wires": [
            [
                "9e75bf06577706e9"
            ]
        ],
        "info": "# Call to action\n\n... Laks the balance? Who is the Messanger?\n\nsomething happens to change the balance ‚Äì He follows the \"white rabbit\";"
    },
    {
        "id": "9e75bf06577706e9",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Refusal of the Call",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 800,
        "wires": [
            [
                "b2ca9f43bddaa235"
            ]
        ],
        "info": "# Refusal of the call\n\nWhat is he fear? What happens to change his mind?\n\nthe hero is hesitant‚Äì He should climb the roof but he's afraid;"
    },
    {
        "id": "b2ca9f43bddaa235",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Meeting the Mentor",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 740,
        "wires": [
            [
                "31062ff062e78a4c"
            ]
        ],
        "info": "# Meeting the mentor\n\nWho guides the hero? How does the mentor help him?\n\nhe meets a mentor who guides him ‚Äì He sees Morpheus and he's offered the two pills;"
    },
    {
        "id": "31062ff062e78a4c",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Crossing the First Threshold",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 660,
        "wires": [
            [
                "956c40cef8e47e16"
            ]
        ],
        "info": "# Crossing the first threshold\n\n... he lose? What is he hoping to gain?\n\nhe finally decides to enter the new world ‚Äì He chooses the right pill and the real action begins!"
    },
    {
        "id": "956c40cef8e47e16",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Trials",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 600,
        "wires": [
            [
                "9c2190e83394516c"
            ]
        ],
        "info": "# Trials\n\n... he learning? How is he doing in the world?"
    },
    {
        "id": "9c2190e83394516c",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Allies",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 540,
        "wires": [
            [
                "b039c4e842373e09"
            ]
        ],
        "info": "# Allies\n\n.. ey? How do they complete the hero?"
    },
    {
        "id": "b039c4e842373e09",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Enemies",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 480,
        "wires": [
            [
                "4ec78c120bf42a3a"
            ]
        ],
        "info": "# Enemies\n\nWho/What is he fighting? Are the enemies similar to the hero?"
    },
    {
        "id": "4ec78c120bf42a3a",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Fulfillment",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 500,
        "wires": [
            [
                "7ec885efd16abb92"
            ]
        ],
        "info": "# Fulfillment\n\n... completed. Hero ready. What has he learnt/loss?"
    },
    {
        "id": "7ec885efd16abb92",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "To the Inner Cave",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 540,
        "wires": [
            [
                "1617e8e2bb86329c"
            ]
        ],
        "info": "# To the inner cave\n\n... face? How is he getting ready for the ordeal?"
    },
    {
        "id": "1617e8e2bb86329c",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "The Ordeal",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 600,
        "wires": [
            [
                "08ef5b1f843038b6"
            ]
        ],
        "info": "# The Ordeal\n\n... face-off with the enemy. How does it go?"
    },
    {
        "id": "08ef5b1f843038b6",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Reward",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1180,
        "y": 660,
        "wires": [
            [
                "32b82980b91dd3de"
            ]
        ],
        "info": "# Reward\n\nWhat does he gain? How has he changed?"
    },
    {
        "id": "32b82980b91dd3de",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "The Road Back",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 720,
        "wires": [
            [
                "2e2873a7e8944fdb"
            ]
        ],
        "info": "# The Road Back\n\n... What consequences does he have to face?"
    },
    {
        "id": "2e2873a7e8944fdb",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Resurection",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "bb01eee731d3a898"
            ]
        ],
        "info": "# Resurection\n\n... the last trial? How he is purified by that?"
    },
    {
        "id": "bb01eee731d3a898",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "c080735c3b2e661f",
        "name": "Conclusion",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 860,
        "wires": [
            []
        ],
        "info": "# Conclusion\n\n... the consequences of the Journey?"
    },
    {
        "id": "4e4ab2c54b9fa073",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "Prologue",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 1620,
        "wires": [
            [
                "347d2ac42e821b50"
            ]
        ],
        "info": "To tell something before beginning?"
    },
    {
        "id": "347d2ac42e821b50",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "TheSet-Up",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 1540,
        "wires": [
            [
                "eb5b0fd191b9821a"
            ]
        ],
        "info": "...ce the characters and give the preliminary info."
    },
    {
        "id": "eb5b0fd191b9821a",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "The Ctalyst",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 1480,
        "wires": [
            [
                "f529fc5432ae8155"
            ]
        ],
        "info": "...ting incident that makes the plot move on."
    },
    {
        "id": "f529fc5432ae8155",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "The Rising Action",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1420,
        "wires": [
            [
                "ab29fb87ea4c06f9"
            ]
        ],
        "info": "ACT TWO: Introduce changes, enemies, new characters."
    },
    {
        "id": "ab29fb87ea4c06f9",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "The Mid-Point",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 1360,
        "wires": [
            [
                "7ad1a0c99ee13c67"
            ]
        ],
        "info": "... turning point half way through."
    },
    {
        "id": "7ad1a0c99ee13c67",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "The Crisis",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 1300,
        "wires": [
            [
                "2661ded7866de731"
            ]
        ],
        "info": "The \"all is lost\" moment."
    },
    {
        "id": "2661ded7866de731",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "The Climax",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 1380,
        "wires": [
            [
                "7824525e71dd688d"
            ]
        ],
        "info": "... the most exciting moment, the keystone."
    },
    {
        "id": "7824525e71dd688d",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "The Solution",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 1540,
        "wires": [
            [
                "f3182786fe1f2a17"
            ]
        ],
        "info": "ACT THREE: The stakes are higher and the conflicts are solved."
    },
    {
        "id": "f3182786fe1f2a17",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "Epilogue",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1210,
        "y": 1600,
        "wires": [
            []
        ],
        "info": "To tell something after the end."
    },
    {
        "id": "4d3e0d5042a1385f",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "87285eca5226e916",
        "name": "Order of the events",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 1560,
        "wires": [
            []
        ],
        "info": "How do you want to tell your story? In which order?"
    },
    {
        "id": "624534cad709b4a2",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "87285eca5226e916",
        "name": "Conflicts Evolution",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 1560,
        "wires": [
            []
        ],
        "info": "The development of external or internal movements."
    },
    {
        "id": "bc861751a1b19d27",
        "type": "comment",
        "z": "35a4f5ffd108afaa",
        "g": "00862118b435a1a7",
        "name": "",
        "info": " - Which part of the story should I tell at the beginning?\n - Which part of which character is the event that catalyses the whole plot?\n - When do I want the audience to reach its most emotional moment?",
        "x": 210,
        "y": 1360,
        "wires": []
    },
    {
        "id": "32173120e2685e90",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "9b29753bae23ff6b",
        "name": "Hero #1",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 100,
        "y": 1140,
        "wires": [
            []
        ],
        "info": "Write on this row what happens to the main charcter."
    },
    {
        "id": "9e45477dfac653d7",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "9b29753bae23ff6b",
        "name": "Hero #2",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 1140,
        "wires": [
            []
        ],
        "info": "Write on this row what happens to the 2nd main charcter."
    },
    {
        "id": "1e0a9ff4a3ef4b56",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "9b29753bae23ff6b",
        "name": "Narrator",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 1140,
        "wires": [
            []
        ],
        "info": "Does he have his own story? (Or use this card as a 3rd Hero)"
    },
    {
        "id": "3381474b63847bed",
        "type": "comment",
        "z": "35a4f5ffd108afaa",
        "g": "9b29753bae23ff6b",
        "name": "",
        "info": "Although most stories have just one hero, you will have three **CHARACTERS** cards. By placing them on the left of your **HERO‚ÄôS** STEPS cards, you will be able to manage the development of three different characters.",
        "x": 270,
        "y": 1080,
        "wires": []
    },
    {
        "id": "25741aebae9499a1",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Heroes",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 140,
        "wires": [
            [
                "68531779796741a5"
            ]
        ],
        "info": "...m. What are they needs? What are they weaknesses?"
    },
    {
        "id": "68531779796741a5",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Allies",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 140,
        "wires": [
            [
                "3edc5a908bee516c"
            ]
        ],
        "info": "Do the have a side story you need to refer to?"
    },
    {
        "id": "3edc5a908bee516c",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Enemies",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 140,
        "wires": [
            [
                "b4cdc2c98b547f95"
            ]
        ],
        "info": "...? Do the have a side story you need to refer to?"
    },
    {
        "id": "e106990e59bdd880",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "function 6",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 140,
        "wires": [
            [
                "25741aebae9499a1"
            ]
        ],
        "info": "Place the Asset cards wherever you want."
    },
    {
        "id": "b4cdc2c98b547f95",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Narrator",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 130,
        "y": 260,
        "wires": [
            [
                "64bace815e13bcac"
            ]
        ],
        "info": "Who is the Narrator? Does he have his own story?"
    },
    {
        "id": "64bace815e13bcac",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "SubPlot #1",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 260,
        "wires": [
            [
                "958fa39261f90af4"
            ]
        ],
        "info": "Is there a side story you need to refer to?"
    },
    {
        "id": "958fa39261f90af4",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "SubPlot #2",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 260,
        "wires": [
            [
                "6cf696a89b208cd9"
            ]
        ],
        "info": "Is there a side story you need to refer to?"
    },
    {
        "id": "6cf696a89b208cd9",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Concept and Theme",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 260,
        "wires": [
            [
                "f3010bb0dc0867cf"
            ]
        ],
        "info": "What is the general idea of your story?"
    },
    {
        "id": "f3010bb0dc0867cf",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Form",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 100,
        "y": 360,
        "wires": [
            [
                "3e46630bcdad778f"
            ]
        ],
        "info": "Which techniques/styles are you using?"
    },
    {
        "id": "3e46630bcdad778f",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "MoodBoard",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 240,
        "y": 360,
        "wires": [
            [
                "54e631b8713f7276"
            ]
        ],
        "info": "..a some inspirational pictures around this card."
    },
    {
        "id": "54e631b8713f7276",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "Space",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 360,
        "wires": [
            [
                "7c4e3bdfb934f2b1"
            ]
        ],
        "info": "...d of the story like? Add drawings, pics, maps!"
    },
    {
        "id": "7c4e3bdfb934f2b1",
        "type": "function",
        "z": "35a4f5ffd108afaa",
        "g": "33fb1e68903c32d8",
        "name": "\"Magical\" Objects",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 360,
        "wires": [
            []
        ],
        "info": "... important objects? How do the propel the story?"
    },
    {
        "id": "aa8901bd31893658",
        "type": "comment",
        "z": "35a4f5ffd108afaa",
        "name": "https://www.fabuladeck.com/",
        "info": "[Fabuladec](https://www.fabuladeck.com/)",
        "x": 160,
        "y": 40,
        "wires": []
    },
    {
        "id": "10ecc36acd18b528",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you  know why you need a story?",
        "func": "msg.payload = 'https://thumbs.dreamstime.com/b/knowledge-icon-vector-sign-symbol-isolated-white-backgrou-background-your-web-mobile-app-design-logo-concept-133746781.jpg'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 240,
        "wires": [
            [
                "18ad6b73a137a3e9"
            ]
        ]
    },
    {
        "id": "18ad6b73a137a3e9",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you know where to find your story?",
        "func": "msg.payload = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT9iii7x-Nl4Lr2vhKMAIuU_7Ihvufz7IpHkTQHF8JjIDgQ24s7DYixP5U-2U-nbhnbm5U&usqp=CAU'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 300,
        "wires": [
            [
                "6805cc5038232aba"
            ]
        ]
    },
    {
        "id": "6805cc5038232aba",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you know your role in the story?",
        "func": "msg.payload = 'https://www.shutterstock.com/shutterstock/photos/1468802948/display_1500/stock-vector-superhero-line-icon-hero-symbol-color-superman-mockup-super-dad-template-vector-illustration-1468802948.jpg'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 360,
        "wires": [
            [
                "dc49740613b266c8"
            ]
        ]
    },
    {
        "id": "dc49740613b266c8",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you know what your story needs to do?",
        "func": "msg.payload = 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Function_machine2.svg/1200px-Function_machine2.svg.png'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 420,
        "wires": [
            [
                "4ecee58dcc75b3dd"
            ]
        ]
    },
    {
        "id": "4ecee58dcc75b3dd",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you know how to plan your story?",
        "func": "msg.payload = 'https://www.shutterstock.com/image-vector/hierarchy-icon-isolated-structure-line-260nw-776432704.jpg';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 480,
        "wires": [
            [
                "b7b4cc80c8e04e98"
            ]
        ]
    },
    {
        "id": "b7b4cc80c8e04e98",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you know how to tell your story?",
        "func": "msg.payload = 'https://thumbs.dreamstime.com/b/creative-fashion-style-logo-design-vector-sign-lettering-hanger-symbol-logotype-calligraphy-creative-fashion-style-logo-148836793.jpg'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 540,
        "wires": [
            [
                "6b79b7565b6f052a"
            ]
        ]
    },
    {
        "id": "6b79b7565b6f052a",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Do you know how to share your story?",
        "func": "msg.payload = 'https://cdn-icons-png.flaticon.com/128/1693/1693056.png';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 600,
        "wires": [
            [
                "30cccb3dc02a54d3"
            ]
        ]
    },
    {
        "id": "30cccb3dc02a54d3",
        "type": "function",
        "z": "1d45200c9172f37f",
        "name": "Recipe",
        "func": "msg.payload = 'https://cdn-icons-png.flaticon.com/512/2388/2388956.png';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 700,
        "wires": [
            []
        ],
        "info": "Stories can change the world. See which problems you can solve by combining different story tactics."
    },
    {
        "id": "cde43a7535dcf280",
        "type": "inject",
        "z": "1d45200c9172f37f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 100,
        "y": 160,
        "wires": [
            [
                "10ecc36acd18b528"
            ]
        ]
    },
    {
        "id": "2cfca6c0f1e77435",
        "type": "inject",
        "z": "5451c5648a7ae7eb",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 340,
        "y": 320,
        "wires": [
            [
                "d3bab26f8ac33880"
            ]
        ]
    },
    {
        "id": "7a9dcc421561c59b",
        "type": "function",
        "z": "5451c5648a7ae7eb",
        "name": "Thread 1",
        "func": "this.status({ fill: \"green\", shape: \"dot\", text: \"connected\" });\n//node.status({ fill: \"green\", shape: \"ring\", text: \"done\" });\nreturn {\"t1\": \"t1\"};",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 220,
        "wires": [
            [
                "4703b9b1133a8a85"
            ]
        ]
    },
    {
        "id": "9493456b59dc7fd4",
        "type": "function",
        "z": "5451c5648a7ae7eb",
        "name": "Thread 2",
        "func": "node.status({ fill: \"green\", shape: \"ring\", text: \"done\" });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 320,
        "wires": [
            [
                "4703b9b1133a8a85"
            ]
        ]
    },
    {
        "id": "22e1177b811c8e84",
        "type": "function",
        "z": "5451c5648a7ae7eb",
        "name": "Thread 3",
        "func": "function sleep(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nnode.status({ fill: \"red\", shape: \"ring\", text: \"disconnected\" });\nawait sleep(1000);\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"connected\" });\nawait sleep(1000);\n\nnode.status({ text: \"Just text status\" });\nawait sleep(1000);\n//node.status({});   // to clear the status\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 420,
        "wires": [
            [
                "4703b9b1133a8a85"
            ]
        ]
    },
    {
        "id": "7879dc596cf24518",
        "type": "function",
        "z": "5451c5648a7ae7eb",
        "name": "Wait for all Threads",
        "func": "node.status({ fill: \"green\", shape: \"ring\", text: \"done\" });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "a662866adf899949",
        "type": "comment",
        "z": "5451c5648a7ae7eb",
        "name": "https://nodered.org/blog/2019/08/16/going-async",
        "info": "",
        "x": 500,
        "y": 100,
        "wires": []
    },
    {
        "id": "04e996ecc22bfb1b",
        "type": "comment",
        "z": "5451c5648a7ae7eb",
        "name": "https://nodered.org/docs/user-guide/writing-functions",
        "info": "",
        "x": 610,
        "y": 520,
        "wires": []
    },
    {
        "id": "fbce8910d509b1f3",
        "type": "inject",
        "z": "050b98cdec0fb136",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 580,
        "y": 500,
        "wires": [
            [
                "3bac0584b8df8ef3"
            ]
        ]
    },
    {
        "id": "1d2c0e0ad8db2121",
        "type": "function",
        "z": "050b98cdec0fb136",
        "name": "Thread 1",
        "func": "node.status({ fill: \"green\", shape: \"dot\", text: \"connected\" });\nmsg.topic = \"thread1\";\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 400,
        "wires": [
            [
                "f0b48f4542db6b9b"
            ]
        ]
    },
    {
        "id": "4fea8efc486e60b5",
        "type": "function",
        "z": "050b98cdec0fb136",
        "name": "Thread 2",
        "func": "node.status({ fill: \"green\", shape: \"ring\", text: \"done\" });\nmsg.topic = \"thread2\";\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 500,
        "wires": [
            [
                "f0b48f4542db6b9b"
            ]
        ]
    },
    {
        "id": "dbb12a0d022402c1",
        "type": "function",
        "z": "050b98cdec0fb136",
        "name": "Thread 3",
        "func": "function sleep(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nnode.status({ fill: \"red\", shape: \"ring\", text: \"disconnected\" });\nawait sleep(1000);\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"connected\" });\nawait sleep(1000);\n\nnode.status({ text: \"Just text status\" });\nawait sleep(1000);\n\nmsg.topic = \"thread3\";\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 600,
        "wires": [
            [
                "f0b48f4542db6b9b"
            ]
        ]
    },
    {
        "id": "606e8561e6607d49",
        "type": "join",
        "z": "050b98cdec0fb136",
        "name": "Wait for all Threads",
        "mode": "manual",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "useparts": true,
        "count": "3",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1050,
        "y": 500,
        "wires": [
            [
                "27442d39302431a5"
            ]
        ]
    },
    {
        "id": "27442d39302431a5",
        "type": "debug",
        "z": "050b98cdec0fb136",
        "name": "Combined Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1270,
        "y": 500,
        "wires": []
    },
    {
        "id": "fce178ac60258926",
        "type": "inject",
        "z": "debd584ef029526b",
        "name": "Prompt",
        "props": [
            {
                "p": "payload_",
                "v": "Could you write a very short poem about coffee.",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Could you tell me a joke",
        "payloadType": "str",
        "x": 350,
        "y": 200,
        "wires": [
            [
                "d4a9847836377a3c"
            ]
        ]
    },
    {
        "id": "53acc0e3283d1e5b",
        "type": "debug",
        "z": "debd584ef029526b",
        "name": "Copilot Response",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 830,
        "y": 200,
        "wires": []
    },
    {
        "id": "d4a9847836377a3c",
        "type": "function",
        "z": "debd584ef029526b",
        "name": "Copilot Automation",
        "func": "const { chromium } = global.get('playwright');\nconst { exec, execSync } = global.get('child_process');\nconst progPath = global.get('path');\nconst nodeProcess = global.get('process');\n\nconst REQUEST_COUNT = 20;\nconst port = 9222;\n\nconst request = msg.payload || \"Could you write a very short poem about coffee.\";\n\nlet requestCount = context.get('requestCount') || 0;\nrequestCount++;\ncontext.set('requestCount', requestCount);\n\nfunction stopCopilotProcess(force = false) {\n¬† ¬† if (force || requestCount >= REQUEST_COUNT) {\n¬† ¬† ¬† ¬† try {¬† ¬† ¬† ¬† ¬† ¬† \n¬† ¬† ¬† ¬† ¬† ¬† execSync('powershell -Command \"Stop-Process -Name M365Copilot -Force -ErrorAction SilentlyContinue\"');\n¬† ¬† ¬† ¬† ¬† ¬† context.set('requestCount', 0);\n¬† ¬† ¬† ¬† } catch (err) {}\n¬† ¬† }\n}\n\nfunction getCopilotExePath() {\n¬† ¬† try {\n¬† ¬† ¬† ¬† const command = `powershell -Command \"(Get-AppxPackage Microsoft.MicrosoftOfficeHub).InstallLocation\"`;\n¬† ¬† ¬† ¬† const installLocation = execSync(command).toString().trim();\n¬† ¬† ¬† ¬† return installLocation ? progPath.join(installLocation, 'M365Copilot.exe') : null;\n¬† ¬† } catch (err) { return null; }\n}\n\nasync function isCopilotRunning() {\n¬† ¬† try {\n¬† ¬† ¬† ¬† const check = execSync(`powershell -Command \"Get-Process M365Copilot -ErrorAction SilentlyContinue\"`).toString().trim();\n¬† ¬† ¬† ¬† return check.length > 0;\n¬† ¬† } catch (e) {\n¬† ¬† ¬† ¬† return false;\n¬† ¬† }\n}\n\n(async () => {\n¬† ¬† try {\n¬† ¬† ¬† ¬† const exePath = getCopilotExePath();\n¬† ¬† ¬† ¬† if (!exePath) {\n¬† ¬† ¬† ¬† ¬† ¬† node.error(\"Copilot executable not found.\");\n¬† ¬† ¬† ¬† ¬† ¬† return;\n¬† ¬† ¬† ¬† }\n¬† ¬† ¬† ¬† \n¬† ¬† ¬† ¬† nodeProcess.env.NO_PROXY = \"127.0.0.1,localhost\";\n¬† ¬† ¬† ¬† nodeProcess.env.no_proxy = \"127.0.0.1,localhost\";\n\n¬† ¬† ¬† ¬† const alreadyRunning = await isCopilotRunning();\n¬† ¬† ¬† ¬† \n¬† ¬† ¬† ¬† node.status({ fill: \"blue\", shape: \"dot\", text: `Request ${requestCount}/${REQUEST_COUNT}`});\n¬† ¬† ¬† ¬† \n¬† ¬† ¬† ¬† const launchCmd = `powershell -Command \"$env:WEBVIEW2_ADDITIONAL_BROWSER_ARGUMENTS='--remote-debugging-port=${port}'; Start-Process -FilePath '${exePath}'\"`;\n¬† ¬† ¬† ¬† exec(launchCmd);\n\n¬† ¬† ¬† ¬† if (!alreadyRunning) {\n¬† ¬† ¬† ¬† ¬† ¬† await new Promise(r => setTimeout(r, 10000));\n¬† ¬† ¬† ¬† } else {\n¬† ¬† ¬† ¬† ¬† ¬† await new Promise(r => setTimeout(r, 2000));\n¬† ¬† ¬† ¬† }\n\n¬† ¬† ¬† ¬† node.status({fill:\"yellow\", shape:\"dot\", text:\"Connecting CDP...\"});\n¬† ¬† ¬† ¬† \n¬† ¬† ¬† ¬† const browser = await chromium.connectOverCDP(`http://127.0.0.1:${port}`);\n¬† ¬† ¬† ¬† const contextPage = browser.contexts()[0];\n¬† ¬† ¬† ¬† const page = contextPage.pages()[0] || await contextPage.newPage();\n\n¬† ¬† ¬† ¬† const inputSelector = 'textarea[placeholder*=\"Ask\"], [contenteditable=\"true\"], [role=\"textbox\"]';\n¬† ¬† ¬† ¬† await page.waitForSelector(inputSelector, { state: 'visible', timeout: 15000 });\n\n¬† ¬† ¬† ¬† const prompt = `Forget about previous conversation.\nTask: ${request}\nNo conversational filler. No markdown code blocks.\nConstraint Format:\n---START---\n{\n¬† ¬† \"content\": \"{response}\"\n}\n---END---`;\n\n¬† ¬† ¬† ¬† await page.fill(inputSelector, prompt);\n¬† ¬† ¬† ¬† await page.keyboard.press('Enter');\n\n¬† ¬† ¬† ¬† node.status({fill:\"green\", shape:\"dot\", text:\"Generating...\"});\n\n¬† ¬† ¬† ¬† const lastMessageLocator = page.locator('[data-testid=\"lastChatMessage\"]').last();\n¬† ¬† ¬† ¬† let responseContent = \"\";\n¬† ¬† ¬† ¬† let isFinished = false;\n¬† ¬† ¬† ¬† let attempts = 0;\n\n¬† ¬† ¬† ¬† while (!isFinished && attempts < 40) {\n¬† ¬† ¬† ¬† ¬† ¬† try {\n¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† responseContent = await lastMessageLocator.innerText();\n¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† if (responseContent.includes(\"---END---\")) {\n¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† isFinished = true;\n¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† } else {\n¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† node.status({fill:\"green\", shape:\"dot\", text:`Generating... (${attempts})`});\n¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† await page.waitForTimeout(2000);\n¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† attempts++;\n¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† }\n¬† ¬† ¬† ¬† ¬† ¬† } catch (e) {\n¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† await page.waitForTimeout(2000);\n¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† attempts++;\n¬† ¬† ¬† ¬† ¬† ¬† }\n¬† ¬† ¬† ¬† }\n\n¬† ¬† ¬† ¬† const regex = /---START---([\\s\\S]*?)---END---/;\n¬† ¬† ¬† ¬† const match = responseContent.match(regex);\n\n¬† ¬† ¬† ¬† if (match && match[1]) {\n¬† ¬† ¬† ¬† ¬† ¬† try {\n¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† const jsonString = match[1].replace(/```json|```/g, \"\").trim();\n¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† msg.payload = JSON.parse(jsonString);\n¬† ¬† ¬† ¬† ¬† ¬† } catch (e) {\n¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† msg.payload = { error: \"JSON Parse Error\", raw: match[1] };\n¬† ¬† ¬† ¬† ¬† ¬† }\n¬† ¬† ¬† ¬† } else {\n¬† ¬† ¬† ¬† ¬† ¬† msg.payload = { error: \"Markers not found\", raw: responseContent };\n¬† ¬† ¬† ¬† }\n\n¬† ¬† ¬† ¬† await browser.close();\n\n¬† ¬† ¬† ¬† node.status({fill:\"green\", shape:\"ring\", text:`Done (${requestCount}/${REQUEST_COUNT})`});\n¬† ¬† ¬† ¬† node.send(msg);\n\n¬† ¬† ¬† ¬† if (requestCount >= REQUEST_COUNT) {\n¬† ¬† ¬† ¬† ¬† ¬† stopCopilotProcess(true); \n¬† ¬† ¬† ¬† }\n\n¬† ¬† } catch (err) {\n¬† ¬† ¬† ¬† node.status({fill:\"red\", shape:\"ring\", text: err.message});\n¬† ¬† ¬† ¬† node.error(err.message);\n¬† ¬† }\n})();\n\nreturn;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "playwright",
                "module": "playwright"
            },
            {
                "var": "node:child_process",
                "module": "node:child_process"
            },
            {
                "var": "path",
                "module": "path"
            }
        ],
        "x": 590,
        "y": 200,
        "wires": [
            [
                "53acc0e3283d1e5b"
            ]
        ]
    },
    {
        "id": "bc46f6d8c2d0458d",
        "type": "chat-ollama",
        "z": "95ea89fbd4e794bd",
        "g": "c6e47ecd49d89909",
        "name": "",
        "baseUrl": "http://localhost:11434",
        "modelName": "qwen2.5:7b",
        "temperature": 0,
        "x": 750,
        "y": 100,
        "wires": [
            [
                "99f39e8b147faa21"
            ]
        ]
    },
    {
        "id": "3e08b8ba3b949b86",
        "type": "inject",
        "z": "95ea89fbd4e794bd",
        "name": "Research Query",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Human: I want to research coffee shops in San Francisco.",
        "payloadType": "str",
        "x": 200,
        "y": 60,
        "wires": [
            [
                "f77ece145312e5ce"
            ]
        ]
    },
    {
        "id": "e8b56a2e586eb1a7",
        "type": "debug",
        "z": "95ea89fbd4e794bd",
        "name": "debug 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1460,
        "y": 540,
        "wires": []
    },
    {
        "id": "9907219b25e66484",
        "type": "template",
        "z": "95ea89fbd4e794bd",
        "g": "c6e47ecd49d89909",
        "name": "Clarification Prompt",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "These are the messages that have been exchanged so far from the user asking for the report:\n<Messages>\n{{payload}}\n</Messages>\n\nToday's date is {{date}}.\n\nAssess whether you need to ask a clarifying question, or if the user has already provided enough information for you to start research.\nIMPORTANT: If you can see in the messages history that you have already asked a clarifying question, you almost always do not need to ask another one. Only ask another question if ABSOLUTELY NECESSARY.\n\nIf there are acronyms, abbreviations, or unknown terms, ask the user to clarify.\nIf you need to ask a question, follow these guidelines:\n- Be concise while gathering all necessary information\n- Make sure to gather all the information needed to carry out the research task in a concise, well-structured manner.\n- Use bullet points or numbered lists if appropriate for clarity. Make sure that this uses markdown formatting and will be rendered correctly if the string output is passed to a markdown renderer.\n- Don't ask for unnecessary information, or information that the user has already provided. If you can see that the user has already provided the information, do not ask for it again.\n\nRespond in valid JSON format with these exact keys:\n\"need_clarification\": boolean,\n\"question\": \"<question to ask the user to clarify the report scope>\",\n\"verification\": \"<verification message that we will start research>\"\n\nIf you need to ask a clarifying question, return:\n\"need_clarification\": true,\n\"question\": \"<your clarifying question>\",\n\"verification\": \"\"\n\nIf you do not need to ask a clarifying question, return:\n\"need_clarification\": false,\n\"question\": \"\",\n\"verification\": \"<acknowledgement message that you will now start research based on the provided information>\"\n\nFor the verification message when no clarification is needed:\n- Acknowledge that you have sufficient information to proceed\n- Briefly summarize the key aspects of what you understand from their request\n- Confirm that you will now begin the research process\n- Keep the message concise and professional\n\n\n!!! IMPORTANT !!!\nDo not wrap response into\n```json\n```",
        "output": "str",
        "x": 630,
        "y": 160,
        "wires": [
            [
                "bc46f6d8c2d0458d"
            ]
        ]
    },
    {
        "id": "09160d1ad63d5294",
        "type": "switch",
        "z": "95ea89fbd4e794bd",
        "g": "c6e47ecd49d89909",
        "name": "Need Clarification?",
        "property": "payload.need_clarification",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1070,
        "y": 100,
        "wires": [
            [
                "03da7db91a34ebde"
            ],
            [
                "0a6c9f7210e9f4e7"
            ]
        ]
    },
    {
        "id": "d1fb7a5c64761da4",
        "type": "inject",
        "z": "95ea89fbd4e794bd",
        "name": "Research Query Clarification",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Human: I want to konw what is ko ko ko",
        "payloadType": "str",
        "x": 160,
        "y": 100,
        "wires": [
            [
                "f77ece145312e5ce"
            ]
        ]
    },
    {
        "id": "99f39e8b147faa21",
        "type": "json",
        "z": "95ea89fbd4e794bd",
        "g": "c6e47ecd49d89909",
        "name": "Convert Response To JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 900,
        "y": 160,
        "wires": [
            [
                "09160d1ad63d5294"
            ]
        ]
    },
    {
        "id": "050d6463c944477a",
        "type": "function",
        "z": "95ea89fbd4e794bd",
        "g": "c6e47ecd49d89909",
        "name": "AI Question",
        "func": "if(context.get(\"busy\")) return;\ncontext.set(\"busy\",true);\nnode.status({\"fill\":\"red\",\"text\":\"BUSY\"});\n\nconsole.log(\"AI: \", msg.payload.question);\n\nvar cmdline = readline.createInterface({\n    input: process.stdin,\n    output: process.stdout\n});\n \n\ncmdline.question('Human: ', name => {\n    //console.log(`Hey there ${name}!`);\n    msg.payload = name;\n    node.send(msg);\n    cmdline.close();\n    context.set(\"busy\",false);\n    node.status({});\n});\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"busy\",false);",
        "finalize": "",
        "libs": [
            {
                "var": "readline",
                "module": "readline"
            },
            {
                "var": "process",
                "module": "process"
            }
        ],
        "x": 1510,
        "y": 60,
        "wires": [
            [
                "a1e167c0b88c507b"
            ]
        ]
    },
    {
        "id": "143dce5a1905effe",
        "type": "link in",
        "z": "95ea89fbd4e794bd",
        "name": "link in 1",
        "links": [
            "9e131fcc5cd55995"
        ],
        "x": 265,
        "y": 140,
        "wires": [
            [
                "f77ece145312e5ce"
            ]
        ]
    },
    {
        "id": "9e131fcc5cd55995",
        "type": "link out",
        "z": "95ea89fbd4e794bd",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "143dce5a1905effe"
        ],
        "x": 1955,
        "y": 60,
        "wires": []
    },
    {
        "id": "f77ece145312e5ce",
        "type": "change",
        "z": "95ea89fbd4e794bd",
        "g": "c6e47ecd49d89909",
        "name": "Set Date & Request",
        "rules": [
            {
                "t": "set",
                "p": "date",
                "pt": "msg",
                "to": "$now().$substring(0,10)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "researchQuery",
                "pt": "msg",
                "to": "payload",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 480,
        "y": 100,
        "wires": [
            [
                "9907219b25e66484"
            ]
        ]
    },
    {
        "id": "03da7db91a34ebde",
        "type": "change",
        "z": "95ea89fbd4e794bd",
        "g": "c6e47ecd49d89909",
        "name": "Append AI Question",
        "rules": [
            {
                "t": "set",
                "p": "researchQuery",
                "pt": "msg",
                "to": "researchQuery & \"\\nAI: \" & payload.question",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1300,
        "y": 60,
        "wires": [
            [
                "050d6463c944477a"
            ]
        ]
    },
    {
        "id": "a1e167c0b88c507b",
        "type": "change",
        "z": "95ea89fbd4e794bd",
        "g": "c6e47ecd49d89909",
        "name": "Append Human Response",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "researchQuery & \"\\nHuman: \" & payload",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1740,
        "y": 60,
        "wires": [
            [
                "9e131fcc5cd55995"
            ]
        ]
    },
    {
        "id": "a0ea78801fc87328",
        "type": "template",
        "z": "95ea89fbd4e794bd",
        "g": "61e9d40ae4ed73c3",
        "name": "Brief Prompt",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "You will be given a set of messages that have been exchanged so far between yourself and the user. \nYour job is to translate these messages into a more detailed and concrete research question that will be used to guide the research.\n\nThe messages that have been exchanged so far between yourself and the user are:\n<Messages>\n{{researchQuery}}\n</Messages>\n\nToday's date is {{date}}.\n\nYou will return a single research question that will be used to guide the research.\n\nGuidelines:\n1. Maximize Specificity and Detail\n- Include all known user preferences and explicitly list key attributes or dimensions to consider.\n- It is important that all details from the user are included in the instructions.\n\n2. Handle Unstated Dimensions Carefully\n- When research quality requires considering additional dimensions that the user hasn't specified, acknowledge them as open considerations rather than assumed preferences.\n- Example: Instead of assuming \"budget-friendly options,\" say \"consider all price ranges unless cost constraints are specified.\"\n- Only mention dimensions that are genuinely necessary for comprehensive research in that domain.\n\n3. Avoid Unwarranted Assumptions\n- Never invent specific user preferences, constraints, or requirements that weren't stated.\n- If the user hasn't provided a particular detail, explicitly note this lack of specification.\n- Guide the researcher to treat unspecified aspects as flexible rather than making assumptions.\n\n4. Distinguish Between Research Scope and User Preferences\n- Research scope: What topics/dimensions should be investigated (can be broader than user's explicit mentions)\n- User preferences: Specific constraints, requirements, or preferences (must only include what user stated)\n- Example: \"Research coffee quality factors (including bean sourcing, roasting methods, brewing techniques) for San Francisco coffee shops, with primary focus on taste as specified by the user.\"\n\n5. Use the First Person\n- Phrase the request from the perspective of the user.\n\n6. Sources\n- If specific sources should be prioritized, specify them in the research question.\n- For product and travel research, prefer linking directly to official or primary websites (e.g., official brand sites, manufacturer pages, or reputable e-commerce platforms like Amazon for user reviews) rather than aggregator sites or SEO-heavy blogs.\n- For academic or scientific queries, prefer linking directly to the original paper or official journal publication rather than survey papers or secondary summaries.\n- For people, try linking directly to their LinkedIn profile, or their personal website if they have one.\n- If the query is in a specific language, prioritize sources published in that language.",
        "output": "str",
        "x": 1450,
        "y": 300,
        "wires": [
            [
                "c48b03fc96c92bfc"
            ]
        ]
    },
    {
        "id": "c48b03fc96c92bfc",
        "type": "change",
        "z": "95ea89fbd4e794bd",
        "g": "61e9d40ae4ed73c3",
        "name": "Delete researchQuery",
        "rules": [
            {
                "t": "delete",
                "p": "researchQuery",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1460,
        "y": 360,
        "wires": [
            [
                "70ca190b6917284f"
            ]
        ]
    },
    {
        "id": "0a6c9f7210e9f4e7",
        "type": "change",
        "z": "95ea89fbd4e794bd",
        "g": "c6e47ecd49d89909",
        "name": "Append Human Response",
        "rules": [
            {
                "t": "set",
                "p": "researchQuery",
                "pt": "msg",
                "to": "researchQuery & \"\\nAI: \" & payload.verification",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1320,
        "y": 140,
        "wires": [
            [
                "a0ea78801fc87328"
            ]
        ]
    },
    {
        "id": "70ca190b6917284f",
        "type": "chat-ollama",
        "z": "95ea89fbd4e794bd",
        "g": "61e9d40ae4ed73c3",
        "name": "",
        "baseUrl": "http://localhost:11434",
        "modelName": "qwen2.5:7b",
        "temperature": 0,
        "x": 1450,
        "y": 420,
        "wires": [
            [
                "e8b56a2e586eb1a7"
            ]
        ]
    },
    {
        "id": "25d6e2ab48395b99",
        "type": "template",
        "z": "95ea89fbd4e794bd",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "You are a research supervisor. Your job is to conduct research by calling the \"ConductResearch\" tool. For context, today's date is {{date}}. \nCurrent iteration: {{iteration}}.\n<Task> \nYour focus is to call the \"ConductResearch\" tool to conduct research against the overall research question passed in by the user. \nWhen you are completely satisfied with the research findings returned from the tool calls, then you should call the \"ResearchComplete\" tool to indicate that you are done with your research. \n</Task> \n<Available Tools> \nYou have access to three main tools: \n1. **ConductResearch**: Delegate research tasks to specialized sub-agents \n2. **ResearchComplete**: Indicate that research is complete \n3. **think_tool**: For reflection and strategic planning during research \n**CRITICAL: Use think_tool before calling ConductResearch to plan your approach, and after each ConductResearch to assess progress** \n**PARALLEL RESEARCH**: When you identify multiple independent sub-topics that can be explored simultaneously, make multiple ConductResearch tool calls in a single response to enable parallel research execution. This is more efficient than sequential research for comparative or multi-faceted questions. Use at most {{max_concurrent_research_units}} parallel agents per iteration. \n</Available Tools> \n<Instructions> \nThink like a research manager with limited time and resources. Follow these steps: \n1. **Read the question carefully** - What specific information does the user need? \n2. **Decide how to delegate the research** - Carefully consider the question and decide how to delegate the research. Are there multiple independent directions that can be explored simultaneously? \n3. **After each call to ConductResearch, pause and assess** - Do I have enough to answer? What's still missing? \n</Instructions> \n<Hard Limits> \n**Task Delegation Budgets** (Prevent excessive delegation): \n- **Bias towards single agent** - Use single agent for simplicity unless the user request has clear opportunity for parallelization \n- **Stop when you can answer confidently** - Don't keep delegating research for perfection \n- **Limit tool calls** - Always stop after {{max_researcher_iterations}} tool calls to think_tool and ConductResearch if you cannot find the right sources \n</Hard Limits> \n<Show Your Thinking> \nBefore you call ConductResearch tool call, use think_tool to plan your approach: \n- Can the task be broken down into smaller sub-tasks? \nAfter each ConductResearch tool call, use think_tool to analyze the results: \n- What key information did I find? \n- What's missing? \n- Do I have enough to answer the question comprehensively? \n- Should I delegate more research or call ResearchComplete? \n</Show Your Thinking> \n<Scaling Rules> \n**Simple fact-finding, lists, and rankings** can use a single sub-agent: \n- *Example*: List the top 10 coffee shops in San Francisco ‚Üí Use 1 sub-agent \n**Comparisons presented in the user request** can use a sub-agent for each element of the comparison: \n- *Example*: Compare OpenAI vs. Anthropic vs. DeepMind approaches to AI safety ‚Üí Use 3 sub-agents \n- Delegate clear, distinct, non-overlapping subtopics \n**Important Reminders:** \n- Each ConductResearch call spawns a dedicated research agent for that specific topic \n- A separate agent will write the final report - you just need to gather information \n- When calling ConductResearch, provide complete standalone instructions - sub-agents can't see other agents' work \n- Do NOT use acronyms or abbreviations in your research questions, be very clear and specific \n</Scaling Rules>\n<Response>\n    {\n        \"tool\": \"ConductResearch\" or \"ResearchComplete\" or \"think_tool\",\n        \"args\": \"arguments for the tool always string\",\n        \"iteration\": \n    }    \n</Response>",
        "output": "str",
        "x": 540,
        "y": 500,
        "wires": [
            [
                "5a0437445976bc45"
            ]
        ]
    },
    {
        "id": "5226c0c3fcd75509",
        "type": "change",
        "z": "95ea89fbd4e794bd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "max_researcher_iterations",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "max_concurrent_research_units",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "iteration",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 440,
        "wires": [
            [
                "25d6e2ab48395b99"
            ]
        ]
    },
    {
        "id": "5a0437445976bc45",
        "type": "debug",
        "z": "95ea89fbd4e794bd",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 570,
        "y": 560,
        "wires": []
    },
    {
        "id": "9040e79c944a3004",
        "type": "inject",
        "z": "95ea89fbd4e794bd",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 420,
        "wires": [
            [
                "5226c0c3fcd75509"
            ]
        ]
    },
    {
        "id": "c509a2b7c658cb81",
        "type": "function",
        "z": "5da98edae7a210d0",
        "name": "",
        "func": "if(context.get(\"busy\")) return;\ncontext.set(\"busy\",true);\nnode.status({\"fill\":\"red\",\"text\":\"BUSY\"});\n\nvar cmdline = readline.createInterface({\n    input: process.stdin,\n    output: process.stdout\n});\n \ncmdline.question('Who are you?', name => {\n    console.log(`Hey there ${name}!`);\n    msg.payload = name;\n    node.send(msg);\n    cmdline.close();\n    context.set(\"busy\",false);\n    node.status({});\n});\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"busy\",false);",
        "finalize": "",
        "libs": [
            {
                "var": "readline",
                "module": "readline"
            },
            {
                "var": "process",
                "module": "process"
            }
        ],
        "x": 360,
        "y": 120,
        "wires": [
            [
                "799e33757c87386e"
            ]
        ]
    },
    {
        "id": "3b470373578a6274",
        "type": "inject",
        "z": "5da98edae7a210d0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 120,
        "wires": [
            [
                "c509a2b7c658cb81"
            ]
        ]
    },
    {
        "id": "799e33757c87386e",
        "type": "debug",
        "z": "5da98edae7a210d0",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 550,
        "y": 120,
        "wires": []
    },
    {
        "id": "59dd53e2fe2513a9",
        "type": "inject",
        "z": "691e8727dfaad640",
        "name": "Research Query",
        "props": [
            {
                "p": "messagesHistory",
                "v": "I want to research coffee shops in San Francisco.",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 200,
        "y": 180,
        "wires": [
            [
                "5b82c838b6f89e97"
            ]
        ]
    },
    {
        "id": "8a6f0694f2ca6dc5",
        "type": "inject",
        "z": "691e8727dfaad640",
        "name": "Research Query Clarification",
        "props": [
            {
                "p": "messagesHistory",
                "v": "I want to konw what is ko ko ko",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 160,
        "y": 220,
        "wires": [
            [
                "5b82c838b6f89e97"
            ]
        ]
    },
    {
        "id": "5b82c838b6f89e97",
        "type": "change",
        "z": "691e8727dfaad640",
        "g": "e37ab38944e89543",
        "name": "Set User Request & Date",
        "rules": [
            {
                "t": "set",
                "p": "messagesHistory",
                "pt": "msg",
                "to": "$substring($trim(messagesHistory), 0, 7) = \"Human: \" ? messagesHistory: \"Human: \" & $trim(messagesHistory)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "date",
                "pt": "msg",
                "to": "$now().$substring(0,10)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 220,
        "wires": [
            [
                "0b1d9c53be80ec13"
            ]
        ]
    },
    {
        "id": "e308f275ae4a3cc7",
        "type": "file in",
        "z": "691e8727dfaad640",
        "name": "",
        "filename": "C:\\Users\\4artu\\.node-red\\projects\\node-red\\react\\deep-research.html",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 930,
        "y": 60,
        "wires": [
            [
                "fe0b8021f5de5ab9"
            ]
        ]
    },
    {
        "id": "86e628adab35ec7e",
        "type": "http in",
        "z": "691e8727dfaad640",
        "name": "",
        "url": "/deep-research",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 490,
        "y": 60,
        "wires": [
            [
                "e308f275ae4a3cc7"
            ]
        ]
    },
    {
        "id": "fe0b8021f5de5ab9",
        "type": "http response",
        "z": "691e8727dfaad640",
        "name": "",
        "x": 1310,
        "y": 60,
        "wires": []
    },
    {
        "id": "c305ffb410c4f1ae",
        "type": "websocket out",
        "z": "691e8727dfaad640",
        "name": "",
        "server": "8a9b6c5d4e3f2a10",
        "client": "",
        "x": 1810,
        "y": 60,
        "wires": []
    },
    {
        "id": "547a62f4e296f8c2",
        "type": "complete",
        "z": "691e8727dfaad640",
        "name": "",
        "scope": [
            "1e84395e17694747"
        ],
        "uncaught": false,
        "x": 1550,
        "y": 60,
        "wires": [
            [
                "c305ffb410c4f1ae"
            ]
        ]
    },
    {
        "id": "0b1d9c53be80ec13",
        "type": "template",
        "z": "691e8727dfaad640",
        "g": "e37ab38944e89543",
        "name": "Clarification Prompt",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "These are the messages that have been exchanged so far from the user asking for the report:\n<Messages>\n{{messagesHistory}}\n</Messages>\n\nToday's date is {{date}}.\n\nAssess whether you need to ask a clarifying question, or if the user has already provided enough information for you to start research.\nIMPORTANT: If you can see in the messages history that you have already asked a clarifying question, you almost always do not need to ask another one. Only ask another question if ABSOLUTELY NECESSARY.\n\nIf there are acronyms, abbreviations, or unknown terms, ask the user to clarify.\nIf you need to ask a question, follow these guidelines:\n- Be concise while gathering all necessary information\n- Make sure to gather all the information needed to carry out the research task in a concise, well-structured manner.\n- Use bullet points or numbered lists if appropriate for clarity. Make sure that this uses markdown formatting and will be rendered correctly if the string output is passed to a markdown renderer.\n- Don't ask for unnecessary information, or information that the user has already provided. If you can see that the user has already provided the information, do not ask for it again.\n\nRespond in valid JSON format with these exact keys:\n\"need_clarification\": boolean,\n\"question\": \"<question to ask the user to clarify the report scope>\",\n\"verification\": \"<verification message that we will start research>\"\n\nIf you need to ask a clarifying question, return:\n\"need_clarification\": true,\n\"question\": \"<your clarifying question>\",\n\"verification\": \"\"\n\nIf you do not need to ask a clarifying question, return:\n\"need_clarification\": false,\n\"question\": \"\",\n\"verification\": \"<acknowledgement message that you will now start research based on the provided information>\"\n\nFor the verification message when no clarification is needed:\n- Acknowledge that you have sufficient information to proceed\n- Briefly summarize the key aspects of what you understand from their request\n- Confirm that you will now begin the research process\n- Keep the message concise and professional\n\n!!! IMPORTANT !!!\nGive plain json response. Do not wrap response into \n```json\n```\n\n<ResponseZodSchema>\n    z.object({\n        need_clarification: z.boolean(),\n        question: z.string().optional(),\n        verification: z.string().optional()\n    })\n</ResponseZodSchema>    ",
        "output": "str",
        "x": 730,
        "y": 280,
        "wires": [
            [
                "1e439042ab46cfda"
            ]
        ]
    },
    {
        "id": "1e439042ab46cfda",
        "type": "chat-ollama",
        "z": "691e8727dfaad640",
        "g": "e37ab38944e89543",
        "name": "",
        "baseUrl": "http://localhost:11434",
        "modelName": "qwen2.5:7b",
        "temperature": 0,
        "x": 850,
        "y": 220,
        "wires": [
            [
                "889ce1eabb89b997"
            ]
        ]
    },
    {
        "id": "889ce1eabb89b997",
        "type": "json",
        "z": "691e8727dfaad640",
        "g": "e37ab38944e89543",
        "name": "Convert JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 960,
        "y": 280,
        "wires": [
            [
                "85c344f627c79d37"
            ]
        ]
    },
    {
        "id": "85c344f627c79d37",
        "type": "switch",
        "z": "691e8727dfaad640",
        "g": "e37ab38944e89543",
        "name": "Need Clarification?",
        "property": "payload.need_clarification",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1090,
        "y": 220,
        "wires": [
            [
                "dd40650fd866a58d"
            ],
            [
                "fce0f1d065a8b548"
            ]
        ]
    },
    {
        "id": "dd40650fd866a58d",
        "type": "change",
        "z": "691e8727dfaad640",
        "g": "e37ab38944e89543",
        "name": "Append AI Question",
        "rules": [
            {
                "t": "set",
                "p": "messagesHistory",
                "pt": "msg",
                "to": "messagesHistory & \"\\nAI: \" & payload.question",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1320,
        "y": 180,
        "wires": [
            [
                "c754e41cbcc1b7b2"
            ]
        ]
    },
    {
        "id": "fce0f1d065a8b548",
        "type": "change",
        "z": "691e8727dfaad640",
        "g": "e37ab38944e89543",
        "name": "Append AI Response",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "messagesHistory & \"\\nAI: \" & payload.verification",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1320,
        "y": 260,
        "wires": [
            [
                "51a182e1d7ed9d1d"
            ]
        ]
    },
    {
        "id": "d91149e2fab95821",
        "type": "websocket in",
        "z": "691e8727dfaad640",
        "name": "",
        "server": "8a9b6c5d4e3f2a10",
        "client": "",
        "x": 1720,
        "y": 140,
        "wires": [
            [
                "5e93022084f012b1"
            ]
        ]
    },
    {
        "id": "dd661dcc4b4793c8",
        "type": "link in",
        "z": "691e8727dfaad640",
        "name": "User Query IN",
        "links": [
            "5e93022084f012b1"
        ],
        "x": 265,
        "y": 260,
        "wires": [
            [
                "5b82c838b6f89e97"
            ]
        ]
    },
    {
        "id": "5e93022084f012b1",
        "type": "link out",
        "z": "691e8727dfaad640",
        "name": "Clarify User Query OUT",
        "mode": "link",
        "links": [
            "dd661dcc4b4793c8"
        ],
        "x": 1935,
        "y": 160,
        "wires": []
    },
    {
        "id": "c754e41cbcc1b7b2",
        "type": "function",
        "z": "691e8727dfaad640",
        "g": "e37ab38944e89543",
        "name": "AI Question",
        "func": "if(context.get(\"busy\")) return;\ncontext.set(\"busy\",true);\nnode.status({\"fill\":\"red\",\"text\":\"BUSY\"});\n\nconsole.log(\"AI: \", msg.payload.question);\n\nvar cmdline = readline.createInterface({\n    input: process.stdin,\n    output: process.stdout\n});\n \n\ncmdline.question('Human: ', name => {\n    //console.log(`Hey there ${name}!`);\n    msg.payload = name;\n    node.send(msg);\n    cmdline.close();\n    context.set(\"busy\",false);\n    node.status({});\n});\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"busy\",false);",
        "finalize": "",
        "libs": [
            {
                "var": "readline",
                "module": "readline"
            },
            {
                "var": "process",
                "module": "process"
            }
        ],
        "x": 1450,
        "y": 140,
        "wires": [
            [
                "9ed4365548e0afac"
            ]
        ]
    },
    {
        "id": "9ed4365548e0afac",
        "type": "change",
        "z": "691e8727dfaad640",
        "g": "e37ab38944e89543",
        "name": "Append Human Response",
        "rules": [
            {
                "t": "set",
                "p": "messagesHistory",
                "pt": "msg",
                "to": "messagesHistory & \"\\nHuman: \" & payload",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1600,
        "y": 180,
        "wires": [
            [
                "5e93022084f012b1"
            ]
        ]
    },
    {
        "id": "51a182e1d7ed9d1d",
        "type": "template",
        "z": "691e8727dfaad640",
        "g": "7d28253b765b8e27",
        "name": "Brief Prompt",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "You will be given a set of messages that have been exchanged so far between yourself and the user. \nYour job is to translate these messages into a more detailed and concrete research question that will be used to guide the research.\n\nThe messages that have been exchanged so far between yourself and the user are:\n<Messages>\n{{payload}}\n</Messages>\n\nToday's date is {{date}}.\n\nYou will return a single research question that will be used to guide the research.\n\nGuidelines:\n1. Maximize Specificity and Detail\n- Include all known user preferences and explicitly list key attributes or dimensions to consider.\n- It is important that all details from the user are included in the instructions.\n\n2. Handle Unstated Dimensions Carefully\n- When research quality requires considering additional dimensions that the user hasn't specified, acknowledge them as open considerations rather than assumed preferences.\n- Example: Instead of assuming \"budget-friendly options,\" say \"consider all price ranges unless cost constraints are specified.\"\n- Only mention dimensions that are genuinely necessary for comprehensive research in that domain.\n\n3. Avoid Unwarranted Assumptions\n- Never invent specific user preferences, constraints, or requirements that weren't stated.\n- If the user hasn't provided a particular detail, explicitly note this lack of specification.\n- Guide the researcher to treat unspecified aspects as flexible rather than making assumptions.\n\n4. Distinguish Between Research Scope and User Preferences\n- Research scope: What topics/dimensions should be investigated (can be broader than user's explicit mentions)\n- User preferences: Specific constraints, requirements, or preferences (must only include what user stated)\n\n5. Use the First Person\n- Phrase the request from the perspective of the user.\n\n6. Sources\n- If specific sources should be prioritized, specify them in the research question.\n- For product and travel research, prefer linking directly to official or primary websites (e.g., official brand sites, manufacturer pages, or reputable e-commerce platforms like Amazon for user reviews) rather than aggregator sites or SEO-heavy blogs.\n- For academic or scientific queries, prefer linking directly to the original paper or official journal publication rather than survey papers or secondary summaries.\n- For people, try linking directly to their LinkedIn profile, or their personal website if they have one.\n- If the query is in a specific language, prioritize sources published in that language.",
        "output": "str",
        "x": 1610,
        "y": 400,
        "wires": [
            [
                "d018a22df72f545e"
            ]
        ]
    },
    {
        "id": "d018a22df72f545e",
        "type": "chat-ollama",
        "z": "691e8727dfaad640",
        "g": "7d28253b765b8e27",
        "name": "",
        "baseUrl": "http://localhost:11434",
        "modelName": "qwen2.5:7b",
        "temperature": 0,
        "x": 1610,
        "y": 460,
        "wires": [
            [
                "352d89f6fa3e5170"
            ]
        ]
    },
    {
        "id": "ff675697911b64ea",
        "type": "template",
        "z": "691e8727dfaad640",
        "name": "Research Prompt",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "You are a research supervisor. Your job is to conduct research by calling the \"ConductResearch\" tool. For context, today's date is {{date}}. \nCurrent iteration: {{iteration}}.\n<Messages>\n    {{messagesHistory}}\n</Messages>\n<Task> \nYour focus is to call the \"ConductResearch\" tool to conduct research against the overall research question passed in by the user. \nWhen you are completely satisfied with the research findings returned from the tool calls, then you should call the \"ResearchComplete\" tool to indicate that you are done with your research. \n</Task> \n<Available Tools> \nYou have access to three main tools: \n1. **ConductResearch**: Delegate research tasks to specialized sub-agents \n2. **ResearchComplete**: Indicate that research is complete \n3. **think_tool**: For reflection and strategic planning during research \n**CRITICAL: Use think_tool before calling ConductResearch to plan your approach, and after each ConductResearch to assess progress** \n**PARALLEL RESEARCH**: When you identify multiple independent sub-topics that can be explored simultaneously, make multiple ConductResearch tool calls in a single response to enable parallel research execution. This is more efficient than sequential research for comparative or multi-faceted questions. Use at most {{max_concurrent_research_units}} parallel agents per iteration. \n</Available Tools> \n<Instructions> \nThink like a research manager with limited time and resources. Follow these steps: \n1. **Read the question carefully** - What specific information does the user need? \n2. **Decide how to delegate the research** - Carefully consider the question and decide how to delegate the research. Are there multiple independent directions that can be explored simultaneously? \n3. **After each call to ConductResearch, pause and assess** - Do I have enough to answer? What's still missing? \n</Instructions> \n<Hard Limits> \n**Task Delegation Budgets** (Prevent excessive delegation): \n- **Bias towards single agent** - Use single agent for simplicity unless the user request has clear opportunity for parallelization \n- **Stop when you can answer confidently** - Don't keep delegating research for perfection \n- **Limit tool calls** - Always stop after {{max_researcher_iterations}} tool calls to think_tool and ConductResearch if you cannot find the right sources \n</Hard Limits> \n<Show Your Thinking> \nBefore you call ConductResearch tool call, use think_tool to plan your approach: \n- Can the task be broken down into smaller sub-tasks? \nAfter each ConductResearch tool call, use think_tool to analyze the results: \n- What key information did I find? \n- What's missing? \n- Do I have enough to answer the question comprehensively? \n- Should I delegate more research or call ResearchComplete? \n</Show Your Thinking> \n<Scaling Rules> \n**Simple fact-finding, lists, and rankings** can use a single sub-agent: \n- *Example*: List the top 10 coffee shops in San Francisco ‚Üí Use 1 sub-agent \n**Comparisons presented in the user request** can use a sub-agent for each element of the comparison: \n- *Example*: Compare OpenAI vs. Anthropic vs. DeepMind approaches to AI safety ‚Üí Use 3 sub-agents \n- Delegate clear, distinct, non-overlapping subtopics \n**Important Reminders:** \n- Each ConductResearch call spawns a dedicated research agent for that specific topic \n- A separate agent will write the final report - you just need to gather information \n- When calling ConductResearch, provide complete standalone instructions - sub-agents can't see other agents' work \n- Do NOT use acronyms or abbreviations in your research questions, be very clear and specific \n</Scaling Rules>\n<Response Must Comply This zod schema>\n    z.object({\n        tools: z.array({\n            tool: z.enum([\"ConductResearch\", \"ResearchComplete\", \"think_tool\"]),\n            arg: z.string().describe(\"Argument which is passed to tool\")\n        }),\n        aiChaintOfThougt: z.string().describe(\"AI chain of thought explanation\")\n    }    \n</Response>\n\n!!! IMPORTANT !!!\nGive plain json response. Do not wrap response into \n```json\n```",
        "output": "str",
        "x": 530,
        "y": 760,
        "wires": [
            [
                "1e84395e17694747"
            ]
        ]
    },
    {
        "id": "5d14a62978ce04de",
        "type": "change",
        "z": "691e8727dfaad640",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "iteration",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "max_concurrent_research_units",
                "pt": "msg",
                "to": "3",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "max_researcher_iterations",
                "pt": "msg",
                "to": "10",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 400,
        "y": 820,
        "wires": [
            [
                "ff675697911b64ea"
            ]
        ]
    },
    {
        "id": "90b13b4fb33862cf",
        "type": "change",
        "z": "691e8727dfaad640",
        "name": "Set Research Prompt",
        "rules": [
            {
                "t": "set",
                "p": "messagesHistory",
                "pt": "msg",
                "to": "\"Human: \" & payload",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 260,
        "y": 760,
        "wires": [
            [
                "5d14a62978ce04de"
            ]
        ]
    },
    {
        "id": "1e84395e17694747",
        "type": "chat-ollama",
        "z": "691e8727dfaad640",
        "name": "Supervisor Agent",
        "baseUrl": "http://localhost:11434",
        "modelName": "qwen2.5:7b",
        "temperature": 0,
        "x": 710,
        "y": 820,
        "wires": [
            [
                "52edc7a877bcd8cc"
            ]
        ]
    },
    {
        "id": "f3860bee1d5827d4",
        "type": "inject",
        "z": "691e8727dfaad640",
        "name": "Inject Tools",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"tools\":[{\"tool\":\"ConductResearch\",\"arg\":\"Mission District analysis...\"},{\"tool\":\"ConductResearch\",\"arg\":\"Hayes Valley analysis...\"},{\"tool\":\"ConductResearch\",\"arg\":\"Other neighborhoods analysis...\"}],\"aiChaintOfThougt\":\"\",\"timestamp\":\"2026-02-08 07:24:06\",\"id\":1770528246988}",
        "payloadType": "json",
        "x": 660,
        "y": 1060,
        "wires": [
            [
                "4f63c880ec326372"
            ]
        ]
    },
    {
        "id": "4f63c880ec326372",
        "type": "split",
        "z": "691e8727dfaad640",
        "name": "Split into individual tools",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "payload",
        "property": "payload.tools",
        "x": 1010,
        "y": 820,
        "wires": [
            [
                "709bed3647df570d"
            ]
        ]
    },
    {
        "id": "5ee74dc41262493a",
        "type": "debug",
        "z": "691e8727dfaad640",
        "name": "debug 6",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload.tools",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1800,
        "y": 740,
        "wires": []
    },
    {
        "id": "52edc7a877bcd8cc",
        "type": "json",
        "z": "691e8727dfaad640",
        "name": "Convert To JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 850,
        "y": 760,
        "wires": [
            [
                "4f63c880ec326372"
            ]
        ]
    },
    {
        "id": "fb6e9782fd48e15e",
        "type": "link out",
        "z": "691e8727dfaad640",
        "name": "Brief Research OUT",
        "mode": "link",
        "links": [
            "828f7113f031fec6"
        ],
        "x": 1785,
        "y": 520,
        "wires": []
    },
    {
        "id": "828f7113f031fec6",
        "type": "link in",
        "z": "691e8727dfaad640",
        "name": "Deep Research IN",
        "links": [
            "fb6e9782fd48e15e"
        ],
        "x": 85,
        "y": 760,
        "wires": [
            [
                "90b13b4fb33862cf"
            ]
        ]
    },
    {
        "id": "352d89f6fa3e5170",
        "type": "change",
        "z": "691e8727dfaad640",
        "g": "7d28253b765b8e27",
        "name": "Set Research Prompt",
        "rules": [
            {
                "t": "set",
                "p": "messagesHistory",
                "pt": "msg",
                "to": "\"Human: \" & payload",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1620,
        "y": 520,
        "wires": [
            [
                "fb6e9782fd48e15e"
            ]
        ]
    },
    {
        "id": "709bed3647df570d",
        "type": "switch",
        "z": "691e8727dfaad640",
        "name": "üîÄ Route to Tool",
        "property": "payload.tool",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "think_tool",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ConductResearch",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ResearchComplete",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1170,
        "y": 760,
        "wires": [
            [
                "7096b4168fe0de80"
            ],
            [
                "0a0fae12acde2978"
            ],
            [
                "9d02af3741d8429f"
            ]
        ]
    },
    {
        "id": "7096b4168fe0de80",
        "type": "template",
        "z": "691e8727dfaad640",
        "name": "Conduct Research Prompt",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Conduct Research Prompt: {{payload.tool}} !",
        "output": "str",
        "x": 1580,
        "y": 640,
        "wires": [
            [
                "5ee74dc41262493a"
            ]
        ]
    },
    {
        "id": "0a0fae12acde2978",
        "type": "template",
        "z": "691e8727dfaad640",
        "name": "Think Research Prompt",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Think Research Prompt: {{payload.tool}} !",
        "output": "str",
        "x": 1510,
        "y": 860,
        "wires": [
            [
                "5ee74dc41262493a"
            ]
        ]
    },
    {
        "id": "9d02af3741d8429f",
        "type": "template",
        "z": "691e8727dfaad640",
        "name": "Research Complete Prompt",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Research Complete Prompt: {{payload.tool}} !",
        "output": "str",
        "x": 1540,
        "y": 980,
        "wires": [
            [
                "5ee74dc41262493a"
            ]
        ]
    }
]